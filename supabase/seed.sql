-- ============================================================================
-- マスターデータ投入（seed.sql）- 2026年度版
-- ============================================================================
-- 作成日: 2026-02-06
-- 説明: 2026年度上半期（2/9 - 7/19）のマスターデータ
--      学習回、科目、学習内容、テスト日程などを投入
--      ※ 問題数データ（problem_counts）はシードで別途投入
--        → supabase/seeds/problem_counts_2026.sql

-- ----------------------------------------------------------------------------
-- 1. 科目マスタ
-- ----------------------------------------------------------------------------
INSERT INTO public.subjects (name, display_order, color_code) VALUES
('算数', 1, '#3B82F6'),  -- 青
('国語', 2, '#EF4444'),  -- 赤
('理科', 3, '#F97316'),  -- オレンジ
('社会', 4, '#10B981')   -- 緑
ON CONFLICT (name) DO NOTHING;

-- ----------------------------------------------------------------------------
-- 2. 学習回マスタ
-- ----------------------------------------------------------------------------

-- 小学5年生: 20回（2/9 - 7/19）
INSERT INTO public.study_sessions (grade, session_number, start_date, end_date) VALUES
(5, 1, '2026-02-09', '2026-02-15'),
(5, 2, '2026-02-16', '2026-02-22'),
(5, 3, '2026-02-23', '2026-03-01'),
(5, 4, '2026-03-02', '2026-03-08'),
(5, 5, '2026-03-09', '2026-03-15'),
(5, 6, '2026-03-16', '2026-03-22'),
(5, 7, '2026-04-06', '2026-04-12'),
(5, 8, '2026-04-13', '2026-04-19'),
(5, 9, '2026-04-20', '2026-04-26'),
(5, 10, '2026-05-04', '2026-05-10'),
(5, 11, '2026-05-11', '2026-05-17'),
(5, 12, '2026-05-18', '2026-05-24'),
(5, 13, '2026-05-25', '2026-05-31'),
(5, 14, '2026-06-01', '2026-06-07'),
(5, 15, '2026-06-08', '2026-06-14'),
(5, 16, '2026-06-15', '2026-06-21'),
(5, 17, '2026-06-22', '2026-06-28'),
(5, 18, '2026-06-29', '2026-07-05'),
(5, 19, '2026-07-06', '2026-07-12'),
(5, 20, '2026-07-13', '2026-07-19')
ON CONFLICT (grade, session_number) DO NOTHING;

-- 小学6年生: 18回（2/9 - 7/19）
INSERT INTO public.study_sessions (grade, session_number, start_date, end_date) VALUES
(6, 1, '2026-02-09', '2026-02-15'),
(6, 2, '2026-02-16', '2026-02-22'),
(6, 3, '2026-02-23', '2026-03-01'),
(6, 4, '2026-03-02', '2026-03-08'),
(6, 5, '2026-03-09', '2026-03-15'),
(6, 6, '2026-03-16', '2026-03-22'),
(6, 7, '2026-04-13', '2026-04-19'),
(6, 8, '2026-04-20', '2026-04-26'),
(6, 9, '2026-05-04', '2026-05-10'),
(6, 10, '2026-05-11', '2026-05-17'),
(6, 11, '2026-05-18', '2026-05-24'),
(6, 12, '2026-05-25', '2026-05-31'),
(6, 13, '2026-06-01', '2026-06-07'),
(6, 14, '2026-06-08', '2026-06-14'),
(6, 15, '2026-06-15', '2026-06-21'),
(6, 16, '2026-06-22', '2026-06-28'),
(6, 17, '2026-07-06', '2026-07-12'),
(6, 18, '2026-07-13', '2026-07-19')
ON CONFLICT (grade, session_number) DO NOTHING;

-- ----------------------------------------------------------------------------
-- 3. 学習内容タイプマスタ
-- ----------------------------------------------------------------------------

-- 科目IDを取得
DO $$
DECLARE
  v_math_id BIGINT;
  v_japanese_id BIGINT;
  v_science_id BIGINT;
  v_social_id BIGINT;
BEGIN
  SELECT id INTO v_math_id FROM public.subjects WHERE name = '算数';
  SELECT id INTO v_japanese_id FROM public.subjects WHERE name = '国語';
  SELECT id INTO v_science_id FROM public.subjects WHERE name = '理科';
  SELECT id INTO v_social_id FROM public.subjects WHERE name = '社会';

  -- 2026年度 study_content_types（109件）
  -- 生成元: scripts/generate-problem-counts-sql.py + 2026年四谷大塚DB.xlsx
  -- ※ 同一データが migration/20260206000002 にも存在（既存DBアップグレード用）
  --   新規DB構築時はこの seed.sql が source of truth
  INSERT INTO public.study_content_types (grade, subject_id, course, content_name, display_order) VALUES
  -- 小5 算数
  (5, v_math_id, 'A', '類題', 1),
  (5, v_math_id, 'B', '類題', 1),
  (5, v_math_id, 'C', '類題', 1),
  (5, v_math_id, 'S', '類題', 1),
  (5, v_math_id, 'A', '基本問題', 2),
  (5, v_math_id, 'B', '基本問題', 2),
  (5, v_math_id, 'C', '基本問題', 2),
  (5, v_math_id, 'S', '基本問題', 2),
  (5, v_math_id, 'B', '練習問題', 3),
  (5, v_math_id, 'C', '練習問題', 3),
  (5, v_math_id, 'S', '練習問題', 3),
  (5, v_math_id, 'C', '実戦演習', 4),
  (5, v_math_id, 'S', '実戦演習', 4),
  -- 小6 算数
  (6, v_math_id, 'A', '重要問題', 1),
  (6, v_math_id, 'B', '重要問題', 1),
  (6, v_math_id, 'C', '重要問題', 1),
  (6, v_math_id, 'S', '重要問題', 1),
  (6, v_math_id, 'B', '類題', 2),
  (6, v_math_id, 'C', '類題', 2),
  (6, v_math_id, 'S', '類題', 2),
  (6, v_math_id, 'C', 'ステップアップ演習', 3),
  (6, v_math_id, 'S', 'ステップアップ演習', 3),
  (6, v_math_id, 'A', '基本問題', 4),
  (6, v_math_id, 'B', '基本問題', 4),
  (6, v_math_id, 'C', '基本問題', 4),
  (6, v_math_id, 'S', '基本問題', 4),
  (6, v_math_id, 'C', '練習問題', 5),
  (6, v_math_id, 'S', '練習問題', 5),
  (6, v_math_id, 'S', 'ステップ③（難関校対策）', 6),
  -- 小5 国語
  (5, v_japanese_id, 'A', '漢字', 1),
  (5, v_japanese_id, 'B', '漢字', 1),
  (5, v_japanese_id, 'C', '漢字', 1),
  (5, v_japanese_id, 'S', '漢字', 1),
  -- 小6 国語
  (6, v_japanese_id, 'A', '漢字', 1),
  (6, v_japanese_id, 'B', '漢字', 1),
  (6, v_japanese_id, 'C', '漢字', 1),
  (6, v_japanese_id, 'S', '漢字', 1),
  -- 小5 理科（予習 / 演習で名前が重複するため接頭辞付き）
  (5, v_science_id, 'A', '予習：要点チェック', 1),
  (5, v_science_id, 'B', '予習：要点チェック', 1),
  (5, v_science_id, 'C', '予習：要点チェック', 1),
  (5, v_science_id, 'S', '予習：要点チェック', 1),
  (5, v_science_id, 'A', '予習：練習問題', 2),
  (5, v_science_id, 'B', '予習：練習問題', 2),
  (5, v_science_id, 'C', '予習：練習問題', 2),
  (5, v_science_id, 'S', '予習：練習問題', 2),
  (5, v_science_id, 'A', '演習：基本問題', 3),
  (5, v_science_id, 'B', '演習：基本問題', 3),
  (5, v_science_id, 'C', '演習：基本問題', 3),
  (5, v_science_id, 'S', '演習：基本問題', 3),
  (5, v_science_id, 'B', '演習：練習問題', 4),
  (5, v_science_id, 'C', '演習：練習問題', 4),
  (5, v_science_id, 'S', '演習：練習問題', 4),
  (5, v_science_id, 'C', '演習：発展問題', 5),
  (5, v_science_id, 'S', '演習：発展問題', 5),
  (5, v_science_id, 'S', '演習：応用問題', 6),
  (5, v_science_id, 'S', '演習：チャレンジ問題', 7),
  -- 小6 理科（予習 / 演習で名前が重複するため接頭辞付き）
  (6, v_science_id, 'A', '予習：練習問題', 1),
  (6, v_science_id, 'B', '予習：練習問題', 1),
  (6, v_science_id, 'C', '予習：練習問題', 1),
  (6, v_science_id, 'S', '予習：練習問題', 1),
  (6, v_science_id, 'C', '予習：応用問題', 2),
  (6, v_science_id, 'S', '予習：応用問題', 2),
  (6, v_science_id, 'A', '演習：基本問題', 3),
  (6, v_science_id, 'B', '演習：基本問題', 3),
  (6, v_science_id, 'C', '演習：基本問題', 3),
  (6, v_science_id, 'S', '演習：基本問題', 3),
  (6, v_science_id, 'B', '演習：練習問題', 4),
  (6, v_science_id, 'C', '演習：練習問題', 4),
  (6, v_science_id, 'S', '演習：練習問題', 4),
  (6, v_science_id, 'C', '演習：発展問題', 5),
  (6, v_science_id, 'S', '演習：発展問題', 5),
  (6, v_science_id, 'S', '演習：応用問題', 6),
  (6, v_science_id, 'S', '演習：チャレンジ問題', 7),
  -- 小5 社会（予習と演習で名前が異なるため接頭辞なし）
  (5, v_social_id, 'A', '要点チェック', 1),
  (5, v_social_id, 'B', '要点チェック', 1),
  (5, v_social_id, 'C', '要点チェック', 1),
  (5, v_social_id, 'S', '要点チェック', 1),
  (5, v_social_id, 'A', '練習', 2),
  (5, v_social_id, 'B', '練習', 2),
  (5, v_social_id, 'C', '練習', 2),
  (5, v_social_id, 'S', '練習', 2),
  (5, v_social_id, 'A', '練習問題', 3),
  (5, v_social_id, 'B', '練習問題', 3),
  (5, v_social_id, 'C', '練習問題', 3),
  (5, v_social_id, 'S', '練習問題', 3),
  (5, v_social_id, 'B', '発展問題', 4),
  (5, v_social_id, 'C', '発展問題', 4),
  (5, v_social_id, 'S', '発展問題', 4),
  (5, v_social_id, 'C', '応用', 5),
  (5, v_social_id, 'S', '応用', 5),
  (5, v_social_id, 'S', 'チャレンジ', 6),
  -- 小6 社会（予習 / 演習で名前が重複するため接頭辞付き）
  (6, v_social_id, 'A', '予習：要点チェック', 1),
  (6, v_social_id, 'B', '予習：要点チェック', 1),
  (6, v_social_id, 'C', '予習：要点チェック', 1),
  (6, v_social_id, 'S', '予習：要点チェック', 1),
  (6, v_social_id, 'A', '予習：練習問題', 2),
  (6, v_social_id, 'B', '予習：練習問題', 2),
  (6, v_social_id, 'C', '予習：練習問題', 2),
  (6, v_social_id, 'S', '予習：練習問題', 2),
  (6, v_social_id, 'A', '演習：練習問題', 3),
  (6, v_social_id, 'B', '演習：練習問題', 3),
  (6, v_social_id, 'C', '演習：練習問題', 3),
  (6, v_social_id, 'S', '演習：練習問題', 3),
  (6, v_social_id, 'B', '演習：応用', 4),
  (6, v_social_id, 'C', '演習：応用', 4),
  (6, v_social_id, 'S', '演習：応用', 4),
  (6, v_social_id, 'C', '演習：チャレンジ', 5),
  (6, v_social_id, 'S', '演習：チャレンジ', 5),
  (6, v_social_id, 'S', '演習：発展', 6)
  ON CONFLICT (grade, subject_id, course, content_name) DO NOTHING;

END $$;

-- ----------------------------------------------------------------------------
-- 4. テストタイプマスタ
-- ----------------------------------------------------------------------------
INSERT INTO public.test_types (grade, name, type_category, display_order) VALUES
(5, '組分けテスト', 'kumibun', 1),
(6, '組分けテスト', 'kumibun', 1),
(6, '合不合判定テスト', 'goufugou', 2)
ON CONFLICT (grade, name) DO NOTHING;

-- ----------------------------------------------------------------------------
-- 5. テスト日程マスタ
-- ----------------------------------------------------------------------------

-- 小学5年生 - 組分けテスト（第1回〜第8回 + 新6年）
DO $$
DECLARE
  v_test_type_id BIGINT;
BEGIN
  SELECT id INTO v_test_type_id FROM public.test_types WHERE grade = 5 AND name = '組分けテスト';

  INSERT INTO public.test_schedules (
    test_type_id,
    test_number,
    test_date,
    goal_setting_start_date,
    goal_setting_end_date,
    result_entry_start_date,
    result_entry_end_date
  ) VALUES
  -- 第１回公開組分けテスト: 実施日 3月15日, 目標設定 2/1 - 3/15, 結果入力 3/15 - 4/30
  (v_test_type_id, 1, '2026-03-15', '2026-02-01', '2026-03-15', '2026-03-15', '2026-04-30'),
  -- 第２回公開組分けテスト: 実施日 5月15日, 目標設定 4/1 - 5/15, 結果入力 5/15 - 6/30
  (v_test_type_id, 2, '2026-05-15', '2026-04-01', '2026-05-15', '2026-05-15', '2026-06-30'),
  -- 第３回公開組分けテスト: 実施日 6月14日, 目標設定 5/1 - 6/14, 結果入力 6/14 - 7/31
  (v_test_type_id, 3, '2026-06-14', '2026-05-01', '2026-06-14', '2026-06-14', '2026-07-31'),
  -- 第４回公開組分けテスト: 実施日 7月19日, 目標設定 6/1 - 7/19, 結果入力 7/19 - 8/31
  (v_test_type_id, 4, '2026-07-19', '2026-06-01', '2026-07-19', '2026-07-19', '2026-08-31'),
  -- 第５回公開組分けテスト: 実施日 8月30日, 目標設定 7/1 - 8/30, 結果入力 8/30 - 9/30
  (v_test_type_id, 5, '2026-08-30', '2026-07-01', '2026-08-30', '2026-08-30', '2026-09-30'),
  -- 第６回公開組分けテスト: 実施日 10月4日, 目標設定 9/1 - 10/4, 結果入力 10/4 - 11/30
  (v_test_type_id, 6, '2026-10-04', '2026-09-01', '2026-10-04', '2026-10-04', '2026-11-30'),
  -- 第７回公開組分けテスト: 実施日 11月8日, 目標設定 10/1 - 11/8, 結果入力 11/8 - 12/31
  (v_test_type_id, 7, '2026-11-08', '2026-10-01', '2026-11-08', '2026-11-08', '2026-12-31'),
  -- 第８回公開組分けテスト: 実施日 12月13日, 目標設定 11/1 - 12/13, 結果入力 12/13 - 1/31
  (v_test_type_id, 8, '2026-12-13', '2026-11-01', '2026-12-13', '2026-12-13', '2027-01-31'),
  -- 新６年公開組分けテスト: 実施日 1月24日, 目標設定 12/1 - 1/24, 結果入力 1/24 - 2/28
  (v_test_type_id, 9, '2027-01-24', '2026-12-01', '2027-01-24', '2027-01-24', '2027-02-28')
  ON CONFLICT (test_type_id, test_number) DO NOTHING;

END $$;

-- 小学6年生 - 組分けテスト（第1回〜第3回）
DO $$
DECLARE
  v_test_type_id BIGINT;
BEGIN
  SELECT id INTO v_test_type_id FROM public.test_types WHERE grade = 6 AND name = '組分けテスト';

  INSERT INTO public.test_schedules (
    test_type_id,
    test_number,
    test_date,
    goal_setting_start_date,
    goal_setting_end_date,
    result_entry_start_date,
    result_entry_end_date
  ) VALUES
  -- 第１回公開組分けテスト: 実施日 3月15日, 目標設定 2/1 - 3/15, 結果入力 3/15 - 4/30
  (v_test_type_id, 1, '2026-03-15', '2026-02-01', '2026-03-15', '2026-03-15', '2026-04-30'),
  -- 第２回公開組分けテスト: 実施日 5月10日, 目標設定 4/1 - 5/10, 結果入力 5/10 - 6/30
  (v_test_type_id, 2, '2026-05-10', '2026-04-01', '2026-05-10', '2026-05-10', '2026-06-30'),
  -- 第３回公開組分けテスト: 実施日 6月14日, 目標設定 5/1 - 6/14, 結果入力 6/14 - 7/31
  (v_test_type_id, 3, '2026-06-14', '2026-05-01', '2026-06-14', '2026-06-14', '2026-07-31')
  ON CONFLICT (test_type_id, test_number) DO NOTHING;

END $$;

-- 小学6年生 - 合不合判定テスト（第2回〜第6回）
DO $$
DECLARE
  v_test_type_id BIGINT;
BEGIN
  SELECT id INTO v_test_type_id FROM public.test_types WHERE grade = 6 AND name = '合不合判定テスト';

  INSERT INTO public.test_schedules (
    test_type_id,
    test_number,
    test_date,
    goal_setting_start_date,
    goal_setting_end_date,
    result_entry_start_date,
    result_entry_end_date
  ) VALUES
  -- 第２回合不合判定テスト: 実施日 7月5日, 目標設定 6/1 - 7/5, 結果入力 7/5 - 8/31
  (v_test_type_id, 2, '2026-07-05', '2026-06-01', '2026-07-05', '2026-07-05', '2026-08-31'),
  -- 第３回合不合判定テスト: 実施日 9月6日, 目標設定 8/1 - 9/6, 結果入力 9/6 - 10/31
  (v_test_type_id, 3, '2026-09-06', '2026-08-01', '2026-09-06', '2026-09-06', '2026-10-31'),
  -- 第４回合不合判定テスト: 実施日 10月11日, 目標設定 9/1 - 10/11, 結果入力 10/11 - 11/30
  (v_test_type_id, 4, '2026-10-11', '2026-09-01', '2026-10-11', '2026-10-11', '2026-11-30'),
  -- 第５回合不合判定テスト: 実施日 11月15日, 目標設定 10/1 - 11/15, 結果入力 11/15 - 12/31
  (v_test_type_id, 5, '2026-11-15', '2026-10-01', '2026-11-15', '2026-11-15', '2026-12-31'),
  -- 第６回合不合判定テスト: 実施日 12月6日, 目標設定 11/1 - 12/6, 結果入力 12/6 - 1/31
  (v_test_type_id, 6, '2026-12-06', '2026-11-01', '2026-12-06', '2026-12-06', '2027-01-31')
  ON CONFLICT (test_type_id, test_number) DO NOTHING;

END $$;

-- ----------------------------------------------------------------------------
-- 完了メッセージ
-- ----------------------------------------------------------------------------
DO $$
BEGIN
  RAISE NOTICE 'マスターデータ投入完了（2026年度版）';
  RAISE NOTICE '- 科目: 4件 (算数, 国語, 理科, 社会)';
  RAISE NOTICE '- 学習回: 小5=20回, 小6=18回 (2026年2月〜7月)';
  RAISE NOTICE '- 学習内容タイプ: 109件 (2026年度カリキュラム対応)';
  RAISE NOTICE '- テストタイプ: 3件 (組分け×2, 合不合×1)';
  RAISE NOTICE '- テスト日程: 小5組分け=9回, 小6組分け=3回, 小6合不合=5回';
  RAISE NOTICE '- ※ problem_counts はシードで別途投入 → seeds/problem_counts_2026.sql';
END $$;
