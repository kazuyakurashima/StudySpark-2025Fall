# Phase 1 総合テスト手順

## 前提条件
- Supabase ローカル環境が起動している
- テストユーザーが作成されている (student1, parent1)
- 開発サーバーが起動している (`npm run dev`)

## テストケース

### 1. スパーク機能（学習記録入力）E2Eテスト

#### 1.1 ログインと初期表示
- [ ] student1 でログイン
- [ ] スパーク画面に遷移
- [ ] 学習回が正しく表示される（小6: 15回、小5: 19回）
- [ ] 4科目タブが表示される（算数・国語・理科・社会）

#### 1.2 学習記録入力
- [ ] 算数タブを選択
- [ ] 第5回を選択（10/6〜10/12期間内）
- [ ] 学習内容チェックボックスが表示される
- [ ] 「１行問題」にチェック
- [ ] 正答数スライダーで 18/21 を入力
- [ ] 「今日の振り返り」に「計算問題がスムーズに解けました」と入力
- [ ] 保存ボタンをクリック
- [ ] 成功メッセージが表示される

#### 1.3 再入力（更新）
- [ ] 同じ第5回・算数を再度選択
- [ ] 「１行問題」の正答数が 18/21 で表示される（既存データ）
- [ ] 振り返りが「計算問題がスムーズに解けました」で表示される
- [ ] 正答数を 20/21 に変更
- [ ] 保存して成功確認

#### 1.4 別科目の入力
- [ ] 国語タブを選択
- [ ] 第5回を選択
- [ ] 「中学入試頻出漢字」にチェック
- [ ] 正答数 35/40 を入力
- [ ] 保存して成功確認

### 2. 生徒ダッシュボード表示テスト

#### 2.1 ヘッダー・基本情報
- [ ] ダッシュボードに遷移
- [ ] ユーザー名が表示される（student1のdisplay_name）
- [ ] アバターが表示される
- [ ] あいさつメッセージが表示される
  - 初回: "はじめまして"
  - 24時間以内: "おかえりなさい"
  - 24時間以上: "お久しぶり"
- [ ] 連続学習日数が表示される

#### 2.2 AIコーチメッセージ
- [ ] 時間帯別メッセージが表示される
  - 朝（0:00-11:59）: "おはよう、{name}！今日も一緒に頑張ろう✨"
  - 昼（12:00-17:59）: "おかえり、{name}！今日も学習を続けよう！"
  - 夕（18:00-23:59）: "今日もお疲れさま、{name}！明日も一緒に頑張ろう！"

#### 2.3 今日のミッション（曜日別ロジック）
**月曜日（入力促進モード・ブロックA）:**
- [ ] 3科目表示: 算数・国語・社会
- [ ] 未入力科目: "未入力" 表示
- [ ] 入力済み科目: "進捗率XX%" 表示
- [ ] 完了状況: "X/3完了" 表示

**火曜日（復習促進モード・ブロックA）:**
- [ ] 3科目表示: 算数・国語・社会
- [ ] 正答率80%以上: 完了扱い
- [ ] 正答率80%未満: 再入力促進
- [ ] 完了状況: "X/3完了" 表示

**土曜12時以降（特別モード）:**
- [ ] リフレクト促進カード表示
- [ ] 低正答率科目表示（80%未満の2科目）

**日曜日:**
- [ ] リフレクト促進カード表示
- [ ] 「週間振り返りを記録しよう」メッセージ

#### 2.4 学習カレンダー（GitHub風）
- [ ] 過去6週間分が表示される
- [ ] 今日の日付が含まれている
- [ ] 色の濃淡が正しい
  - 無色: データなし
  - 薄: 1科目入力 or 正答率80%が1科目
  - 中: 2科目入力 or 正答率80%が2科目
  - 濃: 3科目以上入力 or 正答率80%が3科目以上
- [ ] ホバーでツールチップ表示（日付・データ）

#### 2.5 今週の科目別進捗バー
- [ ] 4科目（算数・国語・理科・社会）表示
- [ ] 正答率が計算されている
- [ ] 色分けが正しい
  - 0-50%: 薄（進行中）
  - 50-80%: 中（あと少し）
  - 80-100%: 濃（達成）
- [ ] 詳細展開で学習内容ごとの正答数/問題数表示

#### 2.6 直近の学習履歴
- [ ] 昨日0:00〜今日23:59のデータ表示
- [ ] 最新5件まで表示
- [ ] 記録時刻が「今日 XX:XX」「昨日 XX:XX」形式
- [ ] 学習回番号（session_number）が表示される
- [ ] 科目・学習内容・正答率が表示される
- [ ] 振り返りテキストが表示される（あれば）

#### 2.7 直近の応援メッセージ
- [ ] 昨日0:00〜今日23:59のデータ表示
- [ ] 最新3件まで表示
- [ ] 送信者名・アバターが表示される
- [ ] 応援メッセージが表示される
- [ ] 送信時刻が表示される

### 3. 保護者ダッシュボード表示テスト

#### 3.1 ログインと基本表示
- [ ] parent1 でログイン
- [ ] 保護者ダッシュボードに遷移
- [ ] 保護者名が表示される
- [ ] アバターが表示される
- [ ] あいさつメッセージが表示される

#### 3.2 子ども選択タブ
- [ ] 子どもが複数いる場合、タブが表示される
- [ ] 子どもが1人の場合、タブが非表示
- [ ] タブクリックで子どもを切り替え
- [ ] 切り替え時に全データが更新される

#### 3.3 今日の様子
- [ ] AIコーチアバター表示
- [ ] 子どもの名前入りメッセージ表示
- [ ] 直近3日データがある場合: "この3日間で{n}問に取り組み、正答率{x}%です"
- [ ] データがない場合: "今日も{name}さんは頑張っています！"

#### 3.4 保護者版今日のミッション
**未完了タスク:**
- [ ] "未完了" ボタンが表示される
- [ ] ボタンがグレーアウト（disabled）
- [ ] クリックできない

**完了タスク:**
- [ ] "応援" ボタンが表示される（ピンク）
- [ ] "AI応援" ボタンが表示される（パープル）
- [ ] "詳細を見る" ボタンが表示される
- [ ] 詳細展開で学習ログが表示される
  - 記録時刻
  - 学習回
  - 科目
  - 学習内容
  - 正答率
  - 振り返りテキスト

#### 3.5 共通カード
- [ ] 学習カレンダーが生徒と同じデータで表示される
- [ ] 今週の科目別進捗バーが生徒と同じデータで表示される
- [ ] 直近の学習履歴が生徒と同じデータで表示される
- [ ] 直近の応援メッセージが生徒と同じデータで表示される

### 4. データ永続性テスト

#### 4.1 リロード後の表示
- [ ] ブラウザをリロード
- [ ] データが保持されている
- [ ] ダッシュボードが正しく表示される

#### 4.2 別ブラウザ/シークレットモードでのログイン
- [ ] 別ブラウザで同じユーザーでログイン
- [ ] 同じデータが表示される

#### 4.3 RLS（Row Level Security）テスト
- [ ] student1 は自分のログのみ閲覧・編集可能
- [ ] parent1 は子どものログを閲覧可能（編集不可）
- [ ] 他の生徒のデータは表示されない

### 5. エッジケーステスト

#### 5.1 データなしの状態
- [ ] 学習記録が0件の新規ユーザーでログイン
- [ ] ダッシュボードが正しく表示される
- [ ] "まだ学習記録がありません" などの適切なメッセージ表示

#### 5.2 境界値テスト
- [ ] 正答数 = 0 のケース
- [ ] 正答数 = 問題数（100%）のケース
- [ ] 学習回の開始日・終了日境界でのデータ表示

#### 5.3 タイムゾーンテスト
- [ ] 週の境界（日曜23:59 → 月曜0:00）でのデータ集計
- [ ] 日付変更（23:59 → 0:00）でのデータ表示

## 判定基準

### ✅ 合格条件
- すべてのテストケースがPASS
- エラーが発生しない
- データが正しく保存・表示される
- UI/UXが要件通りに動作する

### ❌ 不合格条件
- 重大なエラーが発生する
- データが保存されない
- データが正しく表示されない
- 要件と異なる動作をする

## テスト実施記録

**実施日:** ____年__月__日
**実施者:** ___________
**結果:** ☐ 合格 / ☐ 不合格

**不具合メモ:**
```
（発見された不具合を記載）
```
