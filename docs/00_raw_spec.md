## コンセプト

このアプリを使うことによって、**中学受験を通じて「その人の可能性を最大限開花させること」が目的**です。

中学受験は保護者の理解と応援があって初めて行えるもの。一方、保護者の意思が強いなりすぎると、主体的な取り組みにならないこともあり得る。なぜ目標を達成するのかを常に意識して、主体的に中学受験に向かうこと。挫けそうになった時に、自分を励ますセルフコンパッションを活用しながら、その人なりの成長を後押しするアプリにします。

応援する保護者が子供学習進捗をリアルタイムに把握することで安心を与えることができる。また、忙しい中、状況に応じて子供を応援できるようにする。

同時に、指導者はこのアプリを使うことで、担当生徒を一覧できて、効率的に個別具体的に応援しやすくなることを目指す。

## 設計方針

以下の方針に基づいた設計とする

- **指導方針**：
    - **7つの習慣＋アドラー心理学**（主体性・目的意識・重要事項優先）
    - **セルフコンパッション**（自分へのやさしい声かけ）
        - 精神的未熟なユーザーを下支え
        - 結果の良し悪しに関わらず、できたこと・感謝したいことを常に意識して自分を承認する習慣形成をする
    - **GROWモデル**（Goal → Reality → Options → Will）
        - コーチングサービスのフレームワークに適用
        - データが貯まれば、より効果的なO,Wをaiが提示できるようになる
    - **SMART目標**（具体的・測定可能・達成可能・関連性・期限）
        - 行動目標などを効果的に作る指針
        - 成長を主体に置くので、結果目標だけではなく、行動目標を置くことが重要
        - 義務ではない目標、why。目的意識を常に持たせて目標設定を行う
- UI方針
    - デザイン、UI,UXはvercel社のv0が作成済み。そのデザインと要件定義が合わない時があれば、適宜協議して開発を進める。

## 基本要求

中学受験を目指す小学6年生向けの学習支援Webアプリ「StudySpark」を作成します。シンプルで美しく、上品上質なアプリです。子供たちが毎日使いたくなるような魅力的なデザインにします。スマートフォンをメインターゲットとしながら、タブレットやPCでも快適に使えるレスポンシブデザインで実装とします。

## 前提条件

- **対象**：中学受験を目指す小学生（志望校確定済み）
- **最終目的**：人間的成長。可能性の最大化（長期ゴール）
- **短期結果目標KPI**：毎週のテスト（週テスト）の成果確認
- **中期結果目標KPI**：毎月の模試（合不合テスト）で成果確認
- 行動目標KPI:

## 技術スタック

| レイヤー | 技術 | バージョン |
| --- | --- | --- |
| フロントエンド | Next.js (App Router) | 14.2.x |
|  | React | 18.3.x |
|  | TypeScript | 5.5.x |
| バックエンド | Supabase (PostgreSQL) | 最新 |
|  | Edge Functions | - |
| 認証 | Supabase Auth | - |
| UI/UX | Tailwind CSS | 最新 |
|  | Framer Motion | 最新 |
| AI | ChatGPT API | GPT-5-mini |

## デザイン要件

- **メインデバイス**: スマートフォン（iPhone/Android）
- **対応デバイス**: iPad等のタブレット、デスクトップPC
- **カラースキーム**:
    - ベースカラー：ホワイト、ライトグレー、グレー
    - アクセントカラー：ブルー系
- **ナビゲーション**:
    - スマホ：画面下部に4つのタブ
    - タブレット/PC：サイドバーまたは上部ナビゲーション選択可
- **デザイン方針**: シンプルかつ美しく、上品・上質、洗練されたデザイン

## 認証システム

## 1. 認証システム概要

### 1.1 基本方針

- **家族単位**でのアカウント管理を基本とする
- 保護者と生徒で**異なる認証方式**を採用（ハイブリッド認証）
- 段階的なオンボーディングで摩擦を最小化
- プロフィール情報と認証情報を分離した設計

### 1.2 ユーザー種別と役割

| 役割(role) | 説明 | アバター選択肢 | 認証方式 | 必要な招待 |
| --- | --- | --- | --- | --- |
| **student** | 生徒アカウント | student1〜6 | ID/パスワード | 不要（保護者が作成） |
| **parent** | 保護者アカウント | parent1〜6 | メール+パスワード | 不要（自由登録可） |
| **coach** | 指導者アカウント | coach1〜6 | メール+パスワード | **必須（招待のみ）** |
| **admin** | 管理者アカウント | なし | メール+パスワード | 必須 |

※AIコーチ（ai_coach）はシステム内部キャラクターであり、ユーザーアカウントではない

---

## 2. 認証方式詳細

### 2.1 役割別認証方式

### 保護者・指導者（共通基盤）

```yaml
認証方式: メールアドレス + パスワード
実装: Supabase Auth
メール確認: 必須（確認メール送信）
パスワードリセット: メールによる自動リセット
セッション管理: JWT/Cookie（App RouterのSSR対応）
特記事項:
  - 指導者は招待リンクまたは招待コードが必須
  - 保護者は自由登録可能

```

### 生徒（カスタム実装）

```yaml
認証方式: ログインID + パスワード
実装: Edge Functions によるカスタム認証
パスワードリセット: 保護者が管理画面から再設定
セッション管理: カスタムトークン
特記事項:
  - メールアドレス不要
  - 保護者がアカウント作成・管理

```

### 2.2 セッション管理

| 設定項目 | 記憶する選択時 | 記憶しない選択時 |
| --- | --- | --- |
| 有効期限 | 30日 | 7日 |
| 更新方式 | 自動更新 | 手動ログイン必要 |
| 保存場所 | Cookie（httpOnly, secure） | SessionStorage |

---

## 3. 登録フロー

### 3.1 ユニバーサルJoin画面（/join）

### 3.1.1 画面構成

```yaml
入力フィールド:
  1. メールアドレス:
     - 必須
     - バリデーション: RFC5322準拠
     - 重複チェック: リアルタイム

  2. パスワード:
     - 必須
     - 最小8文字、英数字混在
     - 強度インジケーター表示

  3. 招待コード入力:
     - 任意（デフォルト非表示）
     - 「指導者コード/招待リンクをお持ちの方」リンクで展開
     - プレースホルダー: "COA-XXXX または FAM-XXXX"

```

### 3.1.2 ロール確定ロジック（優先順位）

| 優先度 | 条件 | 確定ロール | 処理 |
| --- | --- | --- | --- |
| 1 | URLに`token`パラメータ | tokenに紐づくrole | 自動でcoach確定、UIで通知 |
| 2 | 招待コード`COA-`プレフィックス | coach | 指導者として登録確定 |
| 2 | 招待コード`FAM-`プレフィックス | parent | 既存familyに参加 |
| 3 | invitesテーブルに該当メール | 招待のrole | 保留中招待を適用 |
| 4 | 上記いずれもなし | parent | 新規family作成 |

### 3.1.3 UI表示フロー

```mermaid
graph TD
    A[/join アクセス] --> B{token付き?}
    B -->|Yes| C[指導者バッジ表示]
    B -->|No| D[メール入力]
    D --> E[招待コード入力?]
    E -->|Yes| F[コード検証]
    F --> G[ロールバッジ表示]
    E -->|No| H[保護者バッジ表示]
    G --> I[パスワード入力]
    H --> I
    C --> I
    I --> J[登録完了]

```

---

## 4. 各ロールの詳細登録フロー

### 4.1 保護者の初回登録

| Step | 画面 | 処理 | 次画面への条件 |
| --- | --- | --- | --- |
| 1 | /join | メール/パスワード入力 | バリデーション通過 |
| 2 | メール確認待ち | 確認メール送信 | メール内リンククリック |
| 3 | プロフィール設定 | アバター/表示名（任意） | 保存完了 |
| 4 | 生徒追加 | 「生徒を追加」ボタン表示 | クリックで生徒追加画面へ |

**データ処理**:

- 新規`family_id`を自動発行
- `users`テーブルに保護者アカウント作成
- `memberships`に`scope_type='family'`, `role='parent'`で登録

### 4.2 生徒アカウントの追加

### 入力項目

| 項目 | 必須/任意 | バリデーション | 備考 |
| --- | --- | --- | --- |
| ログインID | 必須 | 英数字4-20文字、ユニーク | 自動生成ボタンあり |
| パスワード | 必須 | 6文字以上 | 自動生成ボタンあり |
| 氏名（漢字） | 必須 | 50文字以内 | 本名 |
| 氏名（かな） | 必須 | ひらがなのみ | 読み仮名 |
| 学年 | 必須 | 4-6年から選択 | プルダウン |

**データ処理**:

- `users`テーブルに生徒アカウント作成（Edge Functionsで処理）
- `parent_student_relations`に親子関係を登録
- `profiles`に生徒プロフィール作成

### 4.3 指導者の初回登録

### 方法A: 招待リンク（推奨）

| Step | 処理 | 備考 |
| --- | --- | --- |
| 1 | 管理者が招待リンク生成 | `/join?token=xxx` 形式 |
| 2 | メールで招待リンク送付 | 有効期限72時間 |
| 3 | リンクから/joinアクセス | tokenを自動検証 |
| 4 | パスワード設定のみ | メールは自動入力済み |
| 5 | メール確認 | 確認メール送信 |
| 6 | coach権限付与 | membershipsに登録 |

### 方法B: 招待コード

| Step | 処理 | 備考 |
| --- | --- | --- |
| 1 | 管理者が招待コード発行 | `COA-XXXX-XXXX`形式 |
| 2 | /joinで通常登録 | メール/パスワード入力 |
| 3 | 招待コード入力 | 折りたたみ欄を展開 |
| 4 | コード検証 | 5回失敗でロック |
| 5 | coach権限付与 | membershipsに登録 |

**重複アカウント処理**:

- 同一メールで既にparentアカウントが存在する場合
- 新規アカウントは作成せず、`memberships`に新規行を追加
- `scope_type='org'`, `role='coach'`として登録

### 4.4 追加保護者の参加

| Step | 画面/処理 | 実行者 | 備考 |
| --- | --- | --- | --- |
| 1 | 家族管理画面 | 既存保護者 | 招待ボタンクリック |
| 2 | 招待コード発行 | システム | `FAM-XXXX-XXXX`形式 |
| 3 | コード共有 | 既存保護者 | メール/メッセージで共有 |
| 4 | /joinアクセス | 新規保護者 | 通常の登録フロー |
| 5 | コード入力 | 新規保護者 | 招待コード欄に入力 |
| 6 | family参加 | システム | 既存family_idに紐付け |

### 4.5 生徒の初回ログイン時設定

| 画面 | 設定項目 | 必須/任意 | 仕様 |
| --- | --- | --- | --- |
| 1 | アバター選択 | 必須 | student1〜6から選択 |
| 2 | ニックネーム | 必須 | 10文字以内、絵文字可 |
| 3 | 完了確認 | - | 「始める」ボタンでホームへ |

---

## 5. データ構造

### 5.1 テーブル設計

### users（認証情報）

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY,
  email VARCHAR(255) UNIQUE,  -- 保護者/指導者用
  login_id VARCHAR(50) UNIQUE, -- 生徒用
  password_hash TEXT NOT NULL,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

```

### profiles（プロフィール）

```sql
CREATE TABLE profiles (
  user_id UUID PRIMARY KEY REFERENCES users(id),
  real_name VARCHAR(100),
  real_name_kana VARCHAR(100),
  nickname VARCHAR(50),
  avatar VARCHAR(20),
  grade INTEGER,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

```

### memberships（所属関係）

```sql
CREATE TABLE memberships (
  membership_id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  scope_type ENUM('family', 'org'),
  scope_id UUID NOT NULL, -- family_id or organization_id
  role ENUM('parent', 'coach', 'admin', 'student'),
  status ENUM('active', 'invited', 'revoked'),
  invited_by UUID REFERENCES users(id),
  invite_id UUID REFERENCES invites(invite_id),
  created_at TIMESTAMP,
  UNIQUE(user_id, scope_type, scope_id, role)
);

```

### invites（招待管理）

```sql
CREATE TABLE invites (
  invite_id UUID PRIMARY KEY,
  code_hash TEXT NOT NULL, -- ハッシュ化して保存
  token TEXT UNIQUE,
  role ENUM('parent', 'coach', 'admin'),
  scope_type ENUM('family', 'org'),
  scope_id UUID,
  target_email VARCHAR(255),
  expires_at TIMESTAMP NOT NULL,
  max_uses INTEGER DEFAULT 1,
  used_count INTEGER DEFAULT 0,
  created_by UUID REFERENCES users(id),
  revoked_at TIMESTAMP,
  created_at TIMESTAMP
);

```

### parent_student_relations（親子関係）

```sql
CREATE TABLE parent_student_relations (
  id UUID PRIMARY KEY,
  parent_id UUID REFERENCES users(id),
  student_id UUID REFERENCES users(id),
  family_id UUID NOT NULL,
  created_at TIMESTAMP,
  UNIQUE(parent_id, student_id)
);

```

### 5.2 表示ルール

| 閲覧者 | 対象 | 表示内容 |
| --- | --- | --- |
| 生徒 | 友達 | ニックネームのみ |
| 保護者 | 自分の子 | 本名＋ニックネーム |
| 指導者 | 担当生徒 | 本名（ニックネーム併記） |
| 管理者 | 全ユーザー | 全情報 |

---

## 6. セキュリティ要件

### 6.1 多層防御

### 第1層: 認証レベル

| 対象 | 方式 | 強度 |
| --- | --- | --- |
| 保護者/指導者 | メール認証＋パスワード | 高（メール確認必須） |
| 指導者追加要件 | 招待必須 | 最高（完全招待制） |
| 生徒 | ID/パスワード | 中（保護者管理） |

### 第2層: アプリケーションレベル

```yaml
ミドルウェア処理:
  - ロール検証
  - 不正URLアクセス時のリダイレクト
  - CSRFトークン検証
  - レート制限（1分間10回まで）

```

### 第3層: データベースレベル

```yaml
RLS（Row Level Security）:
  基点テーブル:
    - memberships（所属確認）
    - parent_student_relations（親子関係）

  アクセス制御:
    - family_id/organization_idベースの制御
    - roleに基づく権限管理

```

### 6.2 招待セキュリティ

### 招待リンク（token）仕様

| 項目 | 仕様 | 備考 |
| --- | --- | --- |
| 生成方式 | 128bit相当のランダム文字列 | crypto.randomBytes(16) |
| 使用回数 | 1回限り | 使用後即無効化 |
| 有効期限 | 24-72時間 | 役割により調整 |
| メール固定 | target_emailと一致必須 | なりすまし防止 |

### 招待コード（code）仕様

| 項目 | 仕様 | 備考 |
| --- | --- | --- |
| 形式 | `[PREFIX]-XXXX-XXXX` | PREFIX: COA/FAM |
| 文字種 | 英数字（紛らわしい文字除外） | 0,O,1,I,l除外 |
| 保存方式 | bcryptハッシュ化 | プレーンテキスト保存禁止 |
| 失敗制限 | 5回連続失敗でロック | IPアドレス単位 |
| レート制限 | 1分間3回まで | DDoS対策 |

### 6.3 パスワード管理

| ユーザー種別 | リセット方法 | 実行者 | 備考 |
| --- | --- | --- | --- |
| 保護者/指導者 | メールリセット | 本人 | トークン有効期限1時間 |
| 生徒 | 管理画面から再設定 | 保護者 | 履歴記録あり |

### 6.4 監査ログ

記録対象イベント:

- ログイン成功/失敗
- パスワード変更
- 招待コード発行/使用/失効
- 権限変更
- アカウント作成/削除

---

---

## 8. エラーハンドリング

### 8.1 エラーメッセージ一覧

| エラー種別 | メッセージ | 対処法の表示 |
| --- | --- | --- |
| メール重複 | このメールアドレスは既に登録されています | ログインリンクを表示 |
| コード無効 | 招待コードが無効です | 管理者への連絡方法 |
| コード期限切れ | 招待コードの有効期限が切れています | 再発行依頼リンク |
| パスワード弱 | パスワードが条件を満たしていません | 具体的な条件を表示 |
| メール未確認 | メールアドレスの確認が必要です | 再送信ボタン表示 |

### 8.2 フェイルセーフ

- トランザクション処理によるデータ整合性保証
- 部分的な登録状態の自動クリーンアップ（24時間後）
- 重複登録試行時の既存アカウントへの誘導

---

この認証システム要件定義により、セキュアで使いやすく、各ユーザー種別に最適化された認証フローを実現します。全体のシステムとの整合性を保ちながら、詳細な実装仕様を網羅しています。

### 3.1 ユニバーサルJoin画面（/join）

単一の登録画面で保護者・指導者の両方に対応する設計。

### 入力フィールド

- メールアドレス（必須）
- パスワード（必須）
- 招待コード入力欄（任意・折りたたみ式）

### ロール確定ロジック（優先順位）

1. **招待リンクのトークン付きアクセス**（/join?token=...）→ role=coach自動確定
2. **招待コード入力**: COA-xxxx（指導者）、FAM-xxxx（家族）で判定
3. **保留中招待の照合**: invitesテーブルに同メールの招待があればそのroleで確定
4. **デフォルト**: parent として登録

### 3.2 データ構造

### テーブル設計

```yaml
users:
  - id
  - email/login_id
  - password_hash

profiles:
  - user_id
  - real_name
  - nickname
  - avatar
  - grade

memberships:
  - membership_id
  - user_id
  - scope_type (family|org)
  - scope_id
  - role (parent|coach|admin)
  - status (active|invited|revoked)

invites:
  - invite_id
  - code (ハッシュ保存)
  - token
  - role
  - expires_at
  - max_uses

```

### 3.3 セキュリティ要件

| レイヤー | 対策 |
| --- | --- |
| 認証 | メール認証必須、bcryptハッシュ化 |
| セッション | JWT/Cookie、有効期限30日（記憶ON）/7日（OFF） |
| 招待リンク | 128bit相当、1回限り、期限24-72時間 |
| RLS | membershipsベースのアクセス制御 |

## 4. 生徒機能

### 4.1 ナビゲーション構成

ボトムナビゲーションとする。

| タブ |  | 機能 |
| --- | --- | --- |
| ホーム |  | ダッシュボード |
| ゴールナビ |  | 目標管理 |
| スパーク |  | 学習記録 |
| リフレクト |  | 振り返り |

ホームナビを以下のようにしたいと思います。

・AIコーチメッセージ

・今日のミッション！

・学習カレンダー

・今週の目標
・学習ダッシュボード
・応援メッセージ
・友達のがんばり

（詳細）

・AIコーチメッセージ

トップ画面に表示される一言メッセージは、生徒がアプリを開いた瞬間に「今日も見守られている」という安心感と、「今日の自分」に合った励ましを受け取る最初のタッチポイントである。単なる定型文ではなく、その生徒の歩みを知っている存在からの個別メッセージとして機能する。１日1回生成して、2回目以降は同じものを表示する。

### 4.2.2.2 メッセージ生成の基本構造

| 要素 | 文字数 | 役割 | 具体例 |
| --- | --- | --- | --- |
| **状況認識部分** | 10-20字 | 現状への言及 | 「今日で23日目」「算数の調子が上がってきた」 |
| **メインメッセージ** | 20-40字 | その日の励ましや気づきの促し | 「この調子で今日も一歩ずつ前へ進もう」 |
| **全体** | 30-60字 | 簡潔さと個別性のバランス | 上記の組み合わせ |

### 4.2.2.3 参照データと優先順位

| 優先度 | データ種別 | 反映方法 | 更新頻度 | データソース |
| --- | --- | --- | --- | --- |
| 1 | 連続記録日数 | 節目での特別な承認 | 毎日 | 学習記録DB |
| 2 | 直近3日の学習傾向 | 変化や継続への言及 | 毎日 | 学習記録DB |
| 3 | 週目標（ゴールナビ） | 目標を意識した応援 | 週1回反映 | 目標設定DB |
| 4 | 曜日特性 | 週のリズムに合わせた内容 | 毎日 | システム日時 |
| 5 | 前回の振り返り内容 | 生徒の言葉を引用 | 記録時 | 振り返りDB |
| 6 | 季節・時期 | 受験までの時間軸 | 月1回更新 | カレンダー設定 |

### 4.2.2.4 表現の多様性を確保する仕組み

### メッセージタイプの日替わりローテーション

| タイプ | 出現頻度 | 目的 | 例文 |
| --- | --- | --- | --- |
| **承認型** | 30% | 努力の可視化 | 「3日連続の記録、着実に習慣になってきたね」 |
| **応援型** | 25% | モチベーション維持 | 「今日も一歩ずつ前へ。君のペースで大丈夫」 |
| **気づき促進型** | 20% | メタ認知の促進 | 「算数の理解度が上がってきた。何か変えた？」 |
| **目標リマインド型** | 15% | 目的意識の維持 | 「週目標まであと2つ。今日はどれに取り組む？」 |
| **純粋な挨拶型** | 10% | 温かい関係性 | 「おはよう！今日はどんな発見があるかな」 |

### 語尾・表現のバリエーション

```yaml
応援の表現パターン:
  - がんばって
  - 応援してる
  - ファイト
  - 今日も一緒に
  - 君ならできる

承認の表現パターン:
  - すごいね
  - いいペース
  - その調子
  - 着実だね
  - 成長してる

問いかけの表現パターン:
  - 〜かな？
  - 〜？
  - 〜してみる？
  - 〜はどう？

```

### 4.2.2.5 特別な状況への対応

| 状況 | 判定条件 | メッセージ方針 | 例文 |
| --- | --- | --- | --- |
| **初回ログイン** | first_login = true | 歓迎と期待 | 「ようこそ！今日から一緒に成長していこう」 |
| **1週間連続** | 連続記録 = 7 | 大きな承認 | 「1週間毎日！習慣の第一歩が完成したね」 |
| **月曜日** | 曜日 = 月 | 新しい週への期待 | 「新しい週の始まり。今週の目標を確認してみよう」 |
| **土曜日** | 曜日 = 土 | 週テストへの励まし | 「週テストの日。今週の努力を発揮してきて！」 |
| **記録が途切れた後** | 前日記録なし & 2日前記録あり | 温かい再開 | 「おかえり！また今日から一緒に進もう」 |
| **目標達成時** | 週目標達成フラグ = true | 称賛と次への期待 | 「週目標クリア！自分で決めてやり遂げたね」 |

### 4.2.2.6 個別性を高める要素の組み込み

| 個別化要素 | 実装方法 | データ参照 | 効果 |
| --- | --- | --- | --- |
| **科目名の具体的言及** | 最頻出科目を特定 | 直近7日の学習記録 | 見守られている実感 |
| **数値の具体性** | 実数値を挿入 | 連続日数、目標まで日数 | 正確な把握の証明 |
| **前日との比較** | 差分を計算 | 前日の記録時刻、正答率 | 継続的な観察の表現 |
| **過去の成功体験の引用** | 類似パターンを検索 | 過去30日の成功記録 | 成長の積み重ねの可視化 |

### 4.2.2.7 マンネリ防止のアルゴリズム

```yaml
メッセージ生成ロジック:
  step1_タイプ除外:
    - 過去7日間で使用したメッセージタイプを除外リストに追加
    - 残りのタイプから重み付けランダム選択

  step2_フレーズ除外:
    - 同じフレーズは14日間再利用しない
    - フレーズDBに使用日時を記録

  step3_パターン回避:
    - 曜日固定パターンを避ける
    - 例: 月曜日でも3回に1回は「新しい週」以外の表現

  step4_変化球投入:
    - 3日に1回は「いつもと違う視点」のメッセージ
    - 例: 学習以外の要素（天気、季節）への言及

  step5_サプライズ:
    - 1%の確率でメッセージなし、アイコンのみ表示
    - 特別感の演出

```

### 4.2.2.8 時期による調整

| 時期 | 期間 | メッセージの特徴 | 重点キーワード |
| --- | --- | --- | --- |
| **新学期** | 4-6月 | 新しい始まりの勢い | 習慣、スタート、基礎 |
| **夏期** | 7-8月 | 暑さに負けない持続力 | 継続、ペース、体調 |
| **本格期** | 9-11月 | 実力向上の実感 | 成長、積み重ね、深まり |
| **直前期** | 12-1月 | 自信と冷静さのバランス | 仕上げ、確認、落ち着き |
| **本番期** | 2月 | シンプルで力強い応援 | 大丈夫、信じる、力 |

### 4.2.2.9 禁止事項・制約

| 禁止事項 | 具体例 | 理由 |
| --- | --- | --- |
| **プレッシャー表現** | 「もっと」「まだ」「遅れてる」「急いで」 | 焦りや不安を誘発 |
| **他者との比較** | 「みんなは」「平均より」「○○君は」 | 劣等感や競争意識の過度な刺激 |
| **長すぎるメッセージ** | 60字超過 | 読了率の低下、印象の希薄化 |
| **同一メッセージ連続** | 2日連続で同じ文言 | 機械的印象、特別感の喪失 |
| **ネガティブな指摘** | 「できていない」「ダメ」「失敗」 | 朝のモチベーション低下 |

### 4.2.2.10 技術実装仕様

### 生成タイミング

```yaml
生成契機:
  - 日付変更時（0:00）に翌日分を事前生成
  - 初回アクセス時にキャッシュから取得

キャッシュ戦略:
  - 生成済みメッセージを24時間保持
  - user_id + 日付をキーとして保存

再生成条件:
  - 学習記録の大幅な更新時（正答率20%以上の変化）
  - 目標達成時の即時反映

```

### API仕様

```yaml
エンドポイント: /api/daily-message
メソッド: GET
パラメータ:
  - user_id: string (必須)
  - date: string (任意、デフォルト=今日)

レスポンス:
  - message: string (生成されたメッセージ)
  - type: string (メッセージタイプ)
  - cached: boolean (キャッシュ使用有無)
  - generated_at: timestamp

使用モデルは、GPT5-mini
```

# 今日のミッション！

対象: **ホームナビ > 今日のミッション！**

前提: タイムゾーン **Asia/Tokyo**、週は **月曜開始〜日曜終了**。

用語: 「入力のみ」= 実施/提出の**記録はある**が理解度が未選択。

（※「復讐」は誤記のため、以降「**復習**」に統一）

---

## 1. 目的

- その日やるべきことを**6枚のパネル**で明確化し、**1タップ導線**で入力/復習/確認へ遷移。
- 月〜土は**教科×（授業/宿題）の行動促進、日曜は目標設定/週間リフレクト**の習慣化。

---

## 2. 曜日ルール（教科割 × 行動モード）

### 2.1 教科割

| ブロック | 対象曜日 | 教科 |
| --- | --- | --- |
| ブロックA | 月・火 | 算数 / 理科 / 社会 |
| ブロックB | 水・木 | 算数 / 国語 / 社会 |
| ブロックC | 金・土 | 算数 / 国語 / 理科 |

各ブロックは **3教科 × 2（授業/宿題）= 6パネル** を表示。

### 2.2 行動モード

- **入力促進モード（収集）**：**月 / 水 / 金**
    - 6パネルで**未入力**を検知 → 入力/実施を促す
- **復習促進モード（定着）**：**火 / 木 / 土**
    - 6パネルで**「できた/バッチリ理解」未達**を検知 → 解き直し/理解度入力を促す
- **日曜特別モード**：**日**
    - **ゴールナビ（目標設定）**・**リフレクト（週間振り返り）**の促し

---

## 3. パネル仕様（共通）

### 3.1 パネル構造（6枚共通）

- **ヘッダ**：`<教科> - 授業 / 宿題`
- **ステータスピル**：`未入力 / 入力のみ / できた / バッチリ理解`
- **主要CTA**（曜日モードで変化）：
    - 入力促進：`入力する` / `授業をやる` / `宿題をやる`
    - 復習促進：`解き直す` / `理解度チェック`
- **補助CTA**：`メモを残す`（任意）
- **進捗アイコン**：状態に応じた色とアイコン（未=灰、入=青、できた=黄、バッチリ=緑）
- **遷移先**：対象の**入力フォーム**または**復習チェック画面**

### 3.2 ステートマシン

```
未入力 ──(入力保存)──> 入力のみ ──(理解度=できた)──> できた ──(理解度=バッチリ理解)──> バッチリ理解

```

- いずれも**逆遷移**可（誤入力修正のため）。監査ログに履歴保存。

### 3.3 完了判定

- **入力促進モード**：各パネルが**未入力でない状態**（= 少なくとも「入力のみ」）になればOK
- **復習促進モード**：各パネルが**「できた」以上**になればOK
    - 6枚中**全達成で「今日のミッション達成！」**バナー表示

---

## 4. 曜日別の表示・動作

### 4.1 月曜日（ブロックA / 入力促進）

- 教科：**算数・理科・社会** × 授業/宿題 = 6パネル
- パネル条件：**未入力**を目立たせ、`入力する` を主要CTAに
- サマリー：`未入力 4 / 6` などの**残数バッジ**

### 4.2 火曜日（ブロックA / 復習促進）

- 教科：**算数・理科・社会**
- 条件：**「できた/バッチリ理解」未達**のパネルを優先表示
- CTA：`解き直す` / `理解度チェック`
- サマリー：`定着未達 3 / 6` の進捗

### 4.3 水曜日（ブロックB / 入力促進）

- 教科：**算数・国語・社会**
- 以降、月曜同様のロジック（対象教科のみ差し替え）

### 4.4 木曜日（ブロックB / 復習促進）

- 教科：**算数・国語・理科**
- 以降、火曜同様のロジック（対象教科のみ差し替え）

### 4.5 金曜日（ブロックC / 入力促進）

- 教科：**算数・国語・理科**
- 以降、月曜同様のロジック

### 4.6 土曜日（ブロックC / 復習促進）

- 教科：**算数・国語・理科**
- 以降、火曜同様のロジック

### 4.7 日曜日（特別モード）

- **ゴールナビ**：次回テストの**目標設定**（未設定時は優先表示）
- **リフレクト**：**週間振り返り**（土曜 or 日曜の入力で「完了」バッジ）
- 表示：
    - 完了時：`✓ ゴール設定 完了` / `✓ 週間リフレクト 完了`
    - 未完時：`目標を設定する` / `今週を振り返る`（主要CTA）

---

## 5. ロジック仕様

### 5.1 曜日→教科・モードマッピング

```
weekday = MON..SUN
if weekday in [MON, WED, FRI]: mode = INPUT
elif weekday in [TUE, THU, SAT]: mode = REVIEW
else: mode = SUNDAY

subjects = {
  MON|TUE: [算数, 理科, 社会],
  WED|THU: [算数, 国語, 社会],
  FRI|SAT: [算数, 国語, 理科],
}

```

### 5.2 ミッション対象の抽出

```
targets = []
for subj in subjects[today]:
  for kind in [授業, 宿題]:
    rec = getStudyInput(date=today, subject=subj, kind=kind) // その日の記録
    state = rec.status // 未入力/入力のみ/できた/バッチリ理解

    if mode == INPUT and state == 未入力:
        targets.append(panel(subj, kind, state))
    if mode == REVIEW and state in [未入力, 入力のみ]:
        targets.append(panel(subj, kind, state))  // 定着未達

```

### 5.3 達成条件の評価

```
if mode == INPUT:
  complete = count(state != 未入力 for 6パネル) == 6
if mode == REVIEW:
  complete = count(state in [できた, バッチリ理解] for 6パネル) == 6

```

---

## 6. UI/UX 仕様

- **優先並び**：要対応（未入力/未達）→ 進捗済 の順
- **空状態**：全達成時は「本日のミッションは完了！」＋ 明日の予告（任意）
- **クイック操作**：パネル長押しで**理解度トグル**（入力のみ → できた → バッチリ）
- **アクセシビリティ**：色覚多様性対応（色＋ラベル表記）。全数値はテキスト併記
- **遷移**：各パネルの主要CTAは**該当タブへ深リンク**（授業/宿題入力、復習チェック）

---

## 7. データソース / モデル

- `study_inputs`
    - `student_id, date, subject, kind (class|homework), status (未入力|入力のみ|できた|バッチリ理解), memo, updated_at, updated_by`
- `week_meta`
    - `start_date (Mon), end_date (Sun)`
- `goals`（日曜用）、`reflections`（日曜用）

---

## 8. バリデーション / 例外

- **校舎設定で教科割が異なる**場合：当該日/教科が未設定なら**非表示**（欠番は出さない）
- **休講**（教務の休講フラグ）項目は**非表示**（スコア対象外）
- **重複入力**：同一 `date/subject/kind` は**最新のみ有効**（監査は保持）

---

## 9. 受け入れ基準（抜粋）

1. 曜日に応じ、教科割とモード（入力促進/復習促進/日曜特別）が**正しく切替**わること。
2. **入力促進**の日：6パネルすべてが**未入力でない**状態になれば「完了」になること。
3. **復習促進**の日：6パネルすべてが**「できた」以上**になれば「完了」になること。
4. **日曜**：ゴールナビ/リフレクトが**土曜または日曜に入力済み**なら完了バッジが表示され、未入力なら促しCTAが表示されること。
5. いずれの画面でも、各パネルから**1タップで該当入力画面に遷移**できること。
6. 欠講・教科未設定は**自動で非表示**になり、達成判定から除外されること。

---

## 10. 監査・ログ

- `study_inputs` の状態遷移（誰が/いつ/何を→何に）を履歴化。
- ミッション完了の判定は**都度計算**（派生値）とし、保存はしない。

# ・学習カレンダー

## 4.2.3.1 機能の目的と位置づけ

- 目的：スパーク機能で記録した「学習日・科目・理解度」を**GitHub風ヒートマップ**で可視化し、「やれている実感」を即時に与える。
- 役割：
    - 生徒…継続の手応えと“次の一歩”の動機づけ
    - 保護者/指導者…状況の早見・声かけのタイミング把握
- 連携：4.2.2 デイリーメッセージの横（PC）／直下（SP）に置き、**行動の呼び水**にする。

## 4.2.3.2 UI／配置（添付イメージ準拠）

- 位置：ホーム最上段ダッシュボード領域
    - PC：左＝AIメッセージカード、右＝学習カレンダー
    - SP：AIメッセージの**直下**に学習カレンダー
- スタイル：アプリ全体のトーンに合わせた**上品なブルー系**／角丸カード／淡いシャドウ
- 表示：当月＋次月の2ブロック。下部に凡例（「少ない ⇄ 多い」＋3段階スウォッチ）

## 4.2.3.3 表示データと理解度定義

- 使用データ（学習ログの要素）：
    - 学習日（学習を実施した日／TZ=Asia/Tokyo）
    - 科目（複数可／同一科目は同日1扱い）
    - 理解度（顔マーク）
- 理解度の語彙：
    - 😄 **バッチリ理解** / 😊 **できた** / 😐 **ふつう** / 😟 **ちょっと不安** / 😥 **むずかしかった**
- 集約語：
    - **ふつう以上**＝😐 or 😊 or 😄
    - **できた以上**＝😊 or 😄

## 4.2.3.4 色分けルール（3段階ブルー）

- 対象は**学習日**基準（入力時刻ではない）
- 同一日の**異なる科目数**を判定に使用（重複科目は1と数える）
- 判定順（上から適用）
    1. **濃ブルー**：
        - 条件：その日が**2科目以上** かつ **「できた以上」の記録が2件以上**
    2. **中ブルー**：
        - 条件：その日が**2科目以上** かつ **「ふつう以上」の記録が2件以上**
    3. **薄ブルー**：
        - 条件：その日に**1件以上**の記録がある
    4. **無色/枠のみ**：記録なし
- 凡例（カード下部）
    - 無色（なし）／薄（1件以上）／中（2科目＆ふつう以上×2）／濃（2科目＆できた以上×2）

## 4.2.3.5 インタラクション

- タップ/ホバー：**ツールチップ**表示
    - 表示内容：日付／総記録数／異科目数／理解度分布（😄😊😐😟😥 の件数）／科目上位（最大3）／「詳細を見る」リンク（学習ログ画面へ）
- 空マスのタップ：該当日を指定して**新規学習記録**へ
- 月移動：左右スワイプ（SP）／左右矢印（PC）
- フォーカス：キーボード操作でマスにフォーカスリング／SR読み上げ（例：「8月30日 濃 3件 2科目」）

## 4.2.3.6 表示範囲とナビ

- 初期：当月＋次月（添付の8月・9月例）
- ナビ：前後月へ移動可（プリフェッチは±1か月）

## 4.2.3.7 データ処理・日跨ぎ

- ログ登録UIで**学習日**を選択（既定＝当日、オプション＝昨日）
- 22:00以降の入力でも、学習日ベースで該当日マスを着色
- ホーム上の「直近の成果」表示期間との整合：直近カードは翌0:00まで残す（カレンダーは即反映）

## 4.2.3.8 アクセシビリティ／パフォーマンス

- 色依存回避：ツールチップに**数値と文言**を必ず併記
- コントラスト：各ブルーと背景の比率を**4.5:1**目安で調整
- 描画：CSS Grid（32px相当のタップ領域を確保）／月単位集計APIで軽量化（±1か月プリフェッチ）

## 今週の目標

### 1.1 目的

- 次回テストまでの**残日数**と、当該テストの**結果目標（偏差値）**をひと目で把握。
- 児童が入力した**今回の思い（意気込み）**があれば同時表示し、モチベーションに接続。

### 1.2 表示内容

- **次回テスト情報**
    - テスト名・実施日（yyyy/MM/dd（曜））
    - **カウントダウン**：「テストまで **D日**」
- **結果目標（偏差値）**
    - 次回が**合不合判定テスト**の場合：`コース（S/C/B/A）`・`組（1〜40）`
    - 次回が**週テスト**の場合：`算/国/理/社`の**目標偏差値**（科目カード4枚）
- **今回の思い**（任意）：入力済みならテキストを折りたたみ表示（最大200字）

> 備考：次回テストは、今日以降で最も近いテスト（合不合/週テストの両系統を横断）を自動選定。
> 

### 

### 1.4 挙動/UI

- **カウントダウン**：`days_until = max(0, floor((test_date - today)/1日))`
    - 当日：`本日！`
    - 終了後：次回テストへ自動切替
- **結果目標の解像度**
    - 合不合：`コースA〜S / 組1〜40` のチップ表示
    - 週テスト：科目カード4枚（数値バッジで偏差値）。タップで詳細（調整履歴/根拠）モーダル
- **今回の思い**：2行まで既定表示、展開で全文

### 1.5 バリデーション/例外

- **目標未設定**：
    - 合不合：`コース/組 未設定` バッジ（設定導線）
    - 週テスト：`科目別目標 未設定` バッジ（設定導線）
- **テスト不在**（当月に対象なし）：`今週は目標設定のみ表示` にフォールバック
- **複数同日テスト**：早期締切/高優先度（管理設定）で決定

### 1.6 受け入れ基準（抜粋）

- 最短の**未来日**テストが表示され、残日数が正しく計算されること
- 合不合は**コース/組**、週テストは**4科目の目標偏差値**が表示されること
- 「今回の思い」が入力済みなら折りたたみで表示されること
- 目標未設定時、**設定導線**が提示されること

# 

## 2. 学習ダッシュボード

### 2.1 目的

- 週内の**到達状況**を、児童にも直観的な**リング表現**で提示。
- **日々の入力行動**（授業/宿題・理解度）をスコア化し、**今週の累積**で俯瞰。

### 2.2 表示構成

- **リング3つ**：
    1. **月・火** / 2) **水・木** / 3) **金・土**
        
        各リングは0〜12点スケールで充填表示（詳細は 2.4）
        
- **今週の学習累積（横棒グラフ）**：0〜36点スケール
    - 目盛：0 / 12 / 24 / 36
    - しきい値（例）：12=合格ライン、24=Good、36=Excellent（色分け）
- **日曜カード（特別枠）**：
    - **リフレクト**・**ゴールナビ**の入力状況を表示
    - 土曜/日曜いずれかで入力済み→「**入力完了**」でリング風の完了バッジ
    - 未入力→促し文言＋導線

> 注：リング得点は月〜土の行動をスコア化。日曜はスコア対象外（完了/未完の状態提示のみ）。
> 

### 2.3 科目割と対象入力

| 曜日ブロック | 対象科目 | 入力単位 |
| --- | --- | --- |
| 月・火 | 算数 / 理科 / 社会 | 各科目「授業」「宿題」 |
| 水・木 | 算数 / 国語 / 社会 | 各科目「授業」「宿題」 |
| 金・土 | 算数 / 国語 / 理科 | 各科目「授業」「宿題」 |
- 各ブロックで **3科目 × 2（授業/宿題） = 6項目** を評価。

表示について

その日の曜日を取得して、該当するリングだけを表示すること。

今週の学習の累計は常に表示すること。

日曜日は、リングがない代わりに、振り返りを表示させること。

表示に関しては、全体のデザインと調和するようにすること。

- **カラースキーム**:
    - ベースカラー：ホワイト、ライトグレー、グレー
    - アクセントカラー：ブルー系

### 2.4 スコアリング（リング/累積）

### 2.4.1 入力1件ごとの採点

- **入力あり**：+1点（チェック/保存時）
- **理解度**：`できた` または `バッチリ理解` が選択されたら**追加+1点**
    - 1項目の**最大2点**
    - **項目不入力**は0点

### 2.4.2 日スコア（参考）

- 1日あたり **最大12点**（6項目 × 最大2点）

### 2.4.3 リングスコア（2日まとめ）

- 各リングは **2日分を集約** して **0〜12点** で表示（週合計36点に正規化）
- 集約ロジック（仕様決定）
    - `day_sum = min(24, day1 + day2)`
    - `ring_score = round(day_sum / 24 * 12)`（0〜12に正規化）
- **今週の学習累積**：`weekly_total = ring1 + ring2 + ring3`（**0〜36点**）

> 設計意図：日単位の細かな努力量は保持しつつ、週ビューでは3リング×12点=36点に正規化して比較しやすくする。
> 

### 2.5 UI/インタラクション

- **リング**：中心に得点、外周に充填率、タップで内訳（科目×授業/宿題×理解度）シート
- **横棒グラフ**：当週の累積値をアニメーション表示、閾値に応じて注釈（例：「合格ラインまであと3点」）
- **空状態**：未入力が多い場合、**最寄り未入力項目**へのショートカット提示
- **アクセシビリティ**：リング/棒の数値は常時テキストでも併記

### 2.6 データソース

- `study_inputs`：`student_id, date, subject, kind (class|homework), status (未|入力のみ|できた|バッチリ理解), timestamp`
- `week_meta`：`start_date (Mon), end_date (Sun)`

### 2.7 バリデーション/例外

- **入力重複**：同一`date/subject/kind`は最新1件に正規化（監査ログ保持）
- **科目割の揺れ**：校舎設定で科目が変動する場合、当該ブロックの非対象科目はUIから非表示
- **欠席日**：教務が「休講」フラグを付けた項目は採点対象外（UIは灰表示）

### 2.8 受け入れ基準（抜粋）

- 月〜土の入力に応じ、リングが**0〜12点**で正しく充填されること
- `weekly_total` が **0〜36点**の範囲で計算・表示されること
- 日曜カードで、リフレクト/ゴールナビが**土/日いずれか入力済み**なら「入力完了」となること
- 未入力時、「促す表示」から該当画面に**1タップで遷移**できること
- 空状態でも、**最寄り未入力項目**が提示されること

### 2.9 監査/ログ（要点）

- `study_inputs` 変更は **監査ログ**に記録（誰が・いつ・何を→何に）
- リング/累積は**再計算可能**な派生値として扱い、値自体は保存しない

---

### 付記（設計上の前提と判断）

- ユーザー要望にある「**合計点は36点満点**」に整合させるため、**リングは2日集約で0〜12点に正規化**（日スコア最大24→リング最大12）。
- 日曜はスコアには加点せず、**反省/目標更新の完了状態**を明確化する役割に特化。
- 週の**見通し/比較**を重視し、**情報量はリング内訳シート**で掘り下げ可能にした。

## 4.2.4 応援メッセージ表示機能

### 4.2.4.1 機能概要

生徒の学習記録に対して保護者や指導者から送られた応援メッセージをホーム画面に表示する。「見てもらえている実感」を提供し、学習モチベーションの向上と継続を支援する。

### 4.2.4.2 表示要件

### 表示対象期間

| 項目 | 仕様 | 具体例 |
| --- | --- | --- |
| **表示期間** | 送信後48時間 | 8/30送信 → 8/31 23:59まで |
| **対象メッセージ** | 直近48時間以内に送信された応援 | - |
| **表示切替** | 日付変更時（0:00）に自動更新 | - |
| **アーカイブ** | 期限後は「リフレクト」画面で確認可能 | - |

### 表示順序と件数

| 項目 | 仕様 | 理由 |
| --- | --- | --- |
| **ソート順** | 送信日時の降順 | 最新の応援を優先表示 |
| **最大表示件数** | 5件 | ホーム画面の情報過多防止 |
| **グループ化** | 学習記録単位でグループ化 | 文脈の把握しやすさ |
| **優先度** | 未読→既読の順 | 新着の認知向上 |

### 4.2.4.3 表示内容詳細

### メッセージカードの構成要素

| 要素 | 表示内容 | データソース | 表示形式 |
| --- | --- | --- | --- |
| **送信日時** | メッセージ送信時刻 | sent_at | [8/30 22:30] |
| **送信者情報** | 役割＋名前/関係 | sender_role, sender_name | 👩‍👦 保護者（お母さん） |
| **対象学習** | 科目・学習日 | subject, learning_date | 📚 算数（8/30の学習） |
| **元コメント** | 生徒の振り返り | student_reflection | 💬「計算は楽しかった！」 |
| **応援メッセージ** | 本文 | message_body | 📣 メッセージ本文 |
| **既読状態** | 未読/既読 | is_read | バッジ or 色の違い |

### 送信者の表示ルール

| 送信者役割 | アイコン | 表示名 | 色 |
| --- | --- | --- | --- |
| 保護者 | 👩‍👦/👨‍👦 | 関係性（お母さん等） | #10B981 |
| 指導者 | 👨‍🏫/👩‍🏫 | フルネーム | #3B82F6 |
| AIコーチ | 🤖 | AIコーチ | #8B5CF6 |

### インタラクション

| アクション | 動作 | フィードバック |
| --- | --- | --- |
| カードタップ | 全文表示/折りたたみ | スムーズアニメーション |
| 長押し | 既読/未読切替 | ハプティクス |
| 左スワイプ | アーカイブ | 一時的に非表示 |

### 4.2.4.5 権限管理

| ユーザー種別 | 閲覧 | 送信 | 編集 | 削除 |
| --- | --- | --- | --- | --- |
| 生徒（本人） | ⭕ | ❌ | ❌ | ❌ |
| 保護者 | ⭕ | ⭕ | ❌ | ❌ |
| 指導者 | ⭕ | ⭕ | ❌ | ❌ |
| 他の生徒 | ❌ | ❌ | ❌ | ❌ |

### 4.2.4.6 通知仕様

```yaml
通知タイミング:
  - 新規応援メッセージ受信時
  - 未読メッセージがある場合（1日1回リマインド）

通知内容:
  - タイトル: "新しい応援が届きました"
  - 本文: 送信者名＋メッセージ冒頭20字

通知設定:
  - ON/OFF切替可能
  - 時間帯設定（22:00-7:00は非通知等）

```

---

## 4.2.5 友だちの様子表示機能

### 4.2.5.1 機能概要

学習共有に同意した生徒同士で学習状況を共有し、仲間意識と健全な刺激を通じて学習モチベーションを向上させる。プライバシーに最大限配慮した設計とする。

### 4.2.5.2 同意管理

### 初期設定フロー

| Step | 画面/処理 | 選択肢 | デフォルト |
| --- | --- | --- | --- |
| 1 | 初回アクセス時モーダル | 共有する/しない | しない |
| 2 | 同意確認 | 利用規約確認 | - |
| 3 | 公開範囲設定 | 全体/相互承認のみ | 相互承認 |
| 4 | 設定完了 | - | - |

### 同意の管理

```yaml
同意状態:
  - 未設定: セクション非表示
  - 非同意: セクション非表示＋設定ボタン表示
  - 同意済み: 友だちの記録表示

変更方法:
  - 設定画面からいつでも変更可能
  - 変更は即時反映
  - 非同意に変更時は自分の記録も非公開化

```

### 4.2.5.3 表示要件

### 表示条件と範囲

| 項目 | 仕様 | 備考 |
| --- | --- | --- |
| **表示対象** | 相互に同意した生徒のみ | プライバシー保護 |
| **表示期間** | 直近48時間の記録 | リアルタイム性重視 |
| **表示件数** | 最大10件 | 情報過多防止 |
| **更新頻度** | 5分ごと | サーバー負荷考慮 |

### ソートとフィルター

| 機能 | オプション | デフォルト |
| --- | --- | --- |
| ソート | 時間順/友だち順 | 時間順（新しい順） |
| フィルター | 全科目/科目別 | 全科目 |
| 表示切替 | リスト/グリッド | リスト |

### 4.2.5.4 表示内容詳細

### 1件あたりの表示項目

| 項目 | 表示内容 | 公開/非公開 | 理由 |
| --- | --- | --- | --- |
| **アバター** | 選択アイコン | 公開 | 個人識別 |
| **ニックネーム** | 10文字以内 | 公開 | 匿名性確保 |
| **記録日時** | 相対時間表示 | 公開 | 「2時間前」等 |
| **学習日** | 日付のみ | 公開 | - |
| **科目** | 科目アイコン | 公開 | - |
| **気持ち** | 3-5段階 | 公開 | 共感ポイント |
| **振り返り** | 最大50字 | 選択的公開 | プライバシー配慮 |
| **本名** | - | 非公開 | 個人情報保護 |
| **詳細な成績** | - | 非公開 | 比較防止 |

### 4.2.5.5 UI仕様

### リスト表示形式

```yaml
友だちカード構造:
  左側:
    - アバターアイコン（40px）

  中央:
    - ニックネーム（太字）
    - 科目タグ + 気持ちアイコン
    - 振り返りコメント（1行、グレー文字）

  右側:
    - 相対時間（2時間前等）

スタイル:
  - 高さ: 72px
  - 区切り線: 1px solid #E5E7EB
  - タップ時: 背景色変更

```

### アニメーション

| 要素 | アニメーション | 時間 |
| --- | --- | --- |
| 新規表示 | フェードイン＋スライド | 0.3秒 |
| 更新時 | パルス効果 | 0.5秒 |
| 削除時 | フェードアウト | 0.2秒 |

### 4.2.5.6 プライバシー保護

### 情報の制限

| 制限項目 | 理由 | 代替表示 |
| --- | --- | --- |
| 本名非表示 | 個人情報保護 | ニックネームのみ |
| 成績詳細非公開 | 過度な競争防止 | 気持ちアイコンのみ |
| 学習時間非表示 | 比較ストレス軽減 | - |
| 連続記録非公開 | プレッシャー防止 | - |

### セキュリティ対策

```yaml
データ保護:
  - 友だちIDの暗号化
  - APIレート制限（1分10回）
  - 不正アクセス検知

表示制御:
  - スクリーンショット警告
  - 外部共有禁止
  - 定期的な同意確認（3ヶ月ごと）

```

### 4.2.5.7 相互作用機能

| 機能 | 内容 | 制限 |
| --- | --- | --- |
| **いいね** | ワンタップで反応 | 1記録1回まで |
| **スタンプ** | 定型スタンプ送信 | 1日10回まで |
| **コメント** | 実装しない | いじめ防止 |

### 4.2.5.8 空状態の表示

| 状態 | 表示内容 | アクション |
| --- | --- | --- |
| 未同意 | 「友だちと一緒に頑張ろう」 | 設定ボタン |
| 友だちなし | 「まだ友だちがいません」 | 招待ボタン |
| 記録なし | 「友だちの新しい記録を待っています」 | 更新ボタン |

### 4.2.5.9 効果測定

| 指標 | 目標値 | 測定方法 |
| --- | --- | --- |
| 同意率 | 40%以上 | 同意ユーザー/全ユーザー |
| 継続率向上 | +15% | 共有あり/なしの比較 |
| いいね率 | 30%以上 | いいね数/表示数 |

これらの仕様により、プライバシーを保護しながら、健全な仲間意識を醸成する友だち機能を実現する。

## 4.3 ゴールナビ機能

### 4.3.1 機能概要とコンセプト

### ミッション

中学受験という期間限定の挑戦を通じて、子どもが自分の意志で目標を立て、行動し、振り返り、また立ち上がれる力（主体性＋自己効力感）を育む。結果として志望校合格をめざし、「その人の可能性を最大限開花」させる。

### 価値観・設計信条

| 原則 | 内容 | 実装への反映 |
| --- | --- | --- |
| **主体性ファースト** | 主語は子ども。保護者・指導者は応援と環境づくりに徹する | 編集権限は生徒のみ |
| **目的論＆終わりを思い描く** | 合格はゴール、最終成果は自分で選び取り続ける力 | AIコーチによる目的の深掘り |
| **セルフコンパッション** | うまくいかない日も自分を責めず、前を向く言葉 | 肯定的なフィードバック設計 |
| **短サイクルPDCA** | 毎日の小さな行動→気づき→微調整 | 月次での目標見直し機能 |

### 4.3.2 タブ構成と基本設計

| タブ |  | 機能 |  |
| --- | --- | --- | --- |
|  |  |  |  |
| **目標タブ** |  | 目標設定・思いの入力 | デフォルトで表示 |
| **実績タブ** |  | テスト結果の記録・編集 |  |
| テスト結果 |  | テスト結果（目標・実績）の表示 |  |

# 4.3.3 目標入力機能（実績連動）

## 目的

- テスト実施前後で「実績（受験情報）」を正確に記録し、**科目別の目標偏差値設定**と連動させる。
- 既定値を自動提案し、子ども（と保護者・指導者）が微調整できるUIを提供する。

トップにAIコーチからのアドバイスを表示させるが、一度でも目標設定されている場合は非表示とする。この表示は全く記録したことのない場合のみ表示する。

## 目標入力対象テスト一覧

| テスト名 | 実施日 | 表示期間 |
| --- | --- | --- |
| 第3回合不合判定テスト | 9/7（日） | 8/1〜9/30 |
| 第4回合不合判定テスト | 10/5（日） | 9/1〜10/31 |
| 第5回合不合判定テスト | 11/16（日） | 10/1〜11/30 |
| 第6回合不合判定テスト | 12/7（日） | 11/1〜12/31 |
| 第2回週テスト | 9/13（土） | 8/1〜9/30 |
| 第3回週テスト | 9/20（土） | 8/1〜9/30 |
| 第4回週テスト | 9/27（土） | 8/1〜9/30 |
| 第5回週テスト | 10/11（土） | 9/1〜10/31 |
| 第6回週テスト | 10/18（土） | 9/1〜10/31 |
| 第7回週テスト | 10/25（土） | 9/1〜10/31 |
| 第8回週テスト | 11/8（土） | 10/1〜11/30 |
| 第9回週テスト | 11/22（土） | 10/1〜11/30 |
| 第10回週テスト | 11/29（土） | 10/1〜11/30 |

> 表示期間の仕様
> 
> - 期間内のみダッシュボード・目標設定画面に対象テストを表示。
> - 期間外は検索結果に表示しない（管理者のみ全件参照可）。

---

まずは、目標とするテスト日を選択する。

週テストか合不合判定テストによって、以降の目標入力内容が異なるので表示を変える。

## 入力項目詳細（合不合判定テスト）

| 項目 | 入力方式 | 選択肢/範囲 | バリデーション |
| --- | --- | --- | --- |
| **テスト日** | プルダウン | 上記テスト一覧から選択 | **必須**（表示期間内のみ選択可） |
| **コース** | ラジオボタン | S / C / B / A | **必須** |
| **組** | 数値入力/スライダー | 1〜40 | **必須**・整数・範囲内 |
| **今回の思い** | AIコーチ後に生成 | 最大300字 | 自動生成→編集可 |

### 

---

## 入力項目詳細（週テスト）

| 項目 | 入力方式 | 選択肢/範囲 | バリデーション |
| --- | --- | --- | --- |
| **テスト日** | プルダウン | 上記テスト一覧から選択 | **必須**（表示期間内のみ選択可） |
|  |  |  |  |
| **目標設定モード** | ラジオボタン | ①週テスト結果にもとづく / ②自分で決める | **必須** |
| **科目別目標偏差値** | スライダー | 科目ごと ±5 の微調整（1刻み） | **モードに応じて初期値付与**・整数 |
|  |  |  |  |
| **今回の思い** | AIコーチ後に生成 | 最大300字 | 自動生成→編集可 |

> 補足
> 
> - 週テストはコース・組の入力を不要とし、**科目別目標偏差値の設定が主**。
> - 「対象科目」は実施科目のみ選択可（学校・塾設定により事前フィルタ）。

---

# 目標設定（合不合判定テストの場合）

## フロー

1. **テスト日を選択**（プルダウン）
2. 目標の設定
    - S,C,B,Aから選択
3. 目標の組みを決める
4. *「今回の目標はこれにする！」**で確定

# 目標設定（週テストの場合）

## フロー

1. **テスト日を選択**（プルダウン）
2. **モード選択**
    - ① **週テスト結果にもとづく**（推奨）
    - ② **自分で決める**
3. **初期値の自動提案**（後述のアルゴリズム）
4. **科目ごとにスライダーで微調整**（±5、1刻み）
5. *「今週はこれで行く」**で確定（確定時にスナップショット保存）

---

## ① 週テスト結果にもとづく

- **基準データの取得**：選択したテスト日の**直近**（当該テスト日前、同一テスト体系）の**最新結果**を自動取得。
- **結果目標（偏差値）の自動提案**：取得した基準値に、以下いずれかのモードを適用。

### 自動提案モード

- **均等プラス**：全科目 **+1**
- **弱点底上げ（推奨・デフォルト）**：成績低い順に **+3 / +2 / +1 / +0** を割当
- **現状維持**：**±0**（自分の指針で上げる前提）

> UI：科目ごとスライダー（±5、1刻み）。モード選択後も手動調整可。
> 
- **境界条件**：偏差値は 20〜80 にクリップ（下限上限）。

---

## ② 自分で決める

- **初期値**：全科目 **50** を自動セット。
- **クイックボタン**：各科目に **40 / 50 / 60 / 70** のショートカットを配置。
- **微調整**：スライダーで **±5（1刻み）**。

---

## バリデーション & 例外

- **表示期間外**はテスト選択不可（管理者を除く）。
- **目標偏差値の範囲**：20〜80（スライダー・直接入力ともに適用）。
- **直近結果が存在しない**場合
    - モード①選択時：**現状維持（=50）**で初期化し、情報メッセージ表示。
- **未確定の警告**：画面遷移・閉じる時に未保存警告を表示。

---

---

## 画面要件（要点）

- **選択 → 自動提案 → 微調整 → 確定** の1画面完結。
- **アクセシビリティ**：スライダーに数値入力（±ボタン）を併設。
- **フィードバック**：確定時にトースト表示（成功/失敗）。

### 4.3.5 AIコーチ対話機能

### 起動条件とタイミング

| 条件 | 起動 | 備考 |
| --- | --- | --- |
| 目標初回保存後 | ⭕ | フル対話実行 |
| 「今回の思い」保存済み | ❌ | 手動編集のみ可能 |
| 目標更新時 | △ | 月1回を上限に起動可能 |
| 実績入力時 | ❌ | 起動しない |

### 対話フロー詳細

```yaml
Step1_目標確認:
  AI: "○○さん、次回は[コース][組]を目指すんだね！"

Step2_感情探索:
  AI: "それが達成できたら、どんな気持ちになる？"
  生徒: 自由記述（最大100字）

Step3_共同体感覚:
  AI: "誰が一番喜んでくれると思う？"
  生徒: 選択肢 + その他

Step4_自己認識:
  AI: "そのとき、自分は何を感じる？"
  生徒: 自由記述（最大100字）

Step5_予祝:
  AI: "達成した自分から今の自分へメッセージを送るとしたら？"
  生徒: 自由記述（最大150字）

Step6_まとめ生成:
  AI: 対話内容を統合して「今回の思い」を生成
  生徒: 確認 → OK/修正
  
 ターン数を表示する。step2以降では、’今回の思いを決定’というボタンをつけて、それを押すとその時点で「今回の思い」を生成できるようにする。

```

### AI生成の制約

| 項目 | 仕様 | 理由 |
| --- | --- | --- |
| **トークン上限** | 1対話500トークン | コスト管理 |
| **ターン数** | 最大6往復 | 集中力維持 |
| **生成時間** | 最大5秒/応答 | UX維持 |
| **再生成回数** | 3回まで | 無限ループ防止 |

### 4.3.6 「今回の思い」管理

### 編集権限と履歴

| 操作 | 生徒 | 保護者 | 指導者 |
| --- | --- | --- | --- |
| 閲覧 | ⭕ | ⭕ | ⭕ |
| 編集 | ⭕ | ❌ | ❌ |
| 削除 | ❌ | ❌ | ❌ |
| コメント | ❌ | ⭕ | ⭕ |

### 編集仕様

```yaml
編集可能タイミング:
  - AIコーチ完了後: いつでも可能
  - 文字数制限: 300字
  - 自動保存: 5秒後

履歴管理:
  - 編集履歴を保持（最大5件）
  - 編集日時を記録
  - 復元機能なし（シンプル性優先）

```

### 4.3.7 データ共有と権限

### 生徒の権限

| 対象 | 閲覧 | 編集 | 削除 |
| --- | --- | --- | --- |
| 自分の目標 | ⭕ | ⭕ | ❌ |
| 自分の実績 | ⭕ | ⭕ | ❌ |
| AIコーチログ | ⭕ | ❌ | ❌ |
| 今回の思い | ⭕ | ⭕ | ❌ |

### 保護者・指導者の権限

| 対象 | 閲覧 | 編集 | コメント |
| --- | --- | --- | --- |
| 生徒の目標 | ⭕ | ❌ | ⭕ |
| 生徒の実績 | ⭕ | ❌ | ⭕ |
| AIコーチログ | ❌ | ❌ | ❌ |
| 今回の思い | ⭕ | ❌ | ⭕ |

### 4.3.8 エラーハンドリング

| エラー種別 | 表示メッセージ | 対処 |
| --- | --- | --- |
| 未入力 | 「必須項目を入力してください」 | 該当箇所ハイライト |
| 通信エラー | 「一時的に保存しました」 | ローカル保存→自動再送 |
| AI生成失敗 | 「もう一度試してください」 | 再生成ボタン表示 |
| 権限エラー | 「編集権限がありません」 | 閲覧モードに切替 |

### 4.3.9 通知とリマインド

```yaml
通知タイミング:
  テスト1週間前:
    - 内容: "来週はテストです。目標を確認しよう"
    - アクション: ゴールナビへの導線

  テスト翌日:
    - 内容: "テストお疲れさま。結果を記録しよう"
    - アクション: 実績入力への導線

  目標未設定1ヶ月:
    - 内容: "新しい目標を立ててみよう"
    - アクション: 目標タブへの導線

```

### 4.3.10 効果測定指標

| 指標 | 目標値 | 測定方法 |
| --- | --- | --- |
| 目標設定率 | 80%以上 | 設定ユーザー/全ユーザー |
| AIコーチ完遂率 | 70%以上 | 完了/開始 |
| 思い編集率 | 30%以上 | 編集回数/生成数 |
| 実績入力率 | 90%以上 | 入力/テスト実施 |

この設計により、生徒の主体的な目標設定を支援し、内発的動機づけを高めながら、中学受験という挑戦を通じた人間的成長を実現する。

効果の狙い

- **生徒**：自分で立てた目標への主体性／ワクワク／継続意欲の向上
- **保護者**：子どもの目標と努力の方向性を把握し、適切に応援できる
- **指導者**：目的意識を理解したうえで的確な指導ができる

# 4.3.3 実績入力機能（実績連動）

## 対象テスト一覧

| テスト名 | 実施日 | 表示期間 |
| --- | --- | --- |
| 第3回合不合判定テスト | 9/7（日） | 9/7〜10/31 |
| 第4回合不合判定テスト | 10/5（日） | 10/5〜11/30 |
| 第5回合不合判定テスト | 11/16（日） | 11/16〜12/31 |
| 第6回合不合判定テスト | 12/7（日） | 12/7〜1/31 |
| 第2回週テスト | 9/13（土） | 9/13〜10/31 |
| 第3回週テスト | 9/20（土） | 9/20〜10/31 |
| 第4回週テスト | 9/27（土） | 9/27〜10/31 |
| 第5回週テスト | 10/11（土） | 10/11〜11/30 |
| 第6回週テスト | 10/18（土） | 10/18〜11/30 |
| 第7回週テスト | 10/25（土） | 10/25〜11/30 |
| 第8回週テスト | 11/8（土） | 11/8〜12/31 |
| 第9回週テスト | 11/22（土） | 11/22〜12/31 |
| 第10回週テスト | 11/29（土） | 11/29〜12/31 |

## 入力項目詳細（合不合判定テスト）

| 項目 | 入力方式 | 選択肢/範囲 | バリデーション |
| --- | --- | --- | --- |
| **テスト日** | プルダウン | 上記テスト一覧から選択 | **必須**（表示期間内のみ選択可） |
| **コース** | ラジオボタン | S / C / B / A | **必須** |
| **組** | 数値入力/スライダー | 1〜40 | **必須**・整数・範囲内 |
|  |  |  |  |

### 

---

## 入力項目詳細（週テスト）

| 項目 | 入力方式 | 選択肢/範囲 | バリデーション |
| --- | --- | --- | --- |
| **テスト日** | プルダウン | 上記テスト一覧から選択 | **必須**（表示期間内のみ選択可） |
| **対象科目** | チェックボックス | 算数 / 国語 / 理科 / 社会 | **必須**（1科目以上） |
|  |  |  |  |
| **科目別目標偏差値** | スライダー | 科目ごと ±5 の微調整（1刻み） | **モードに応じて初期値付与**・整数 |
|  |  |  |  |
|  |  |  |  |

> 
> 

---

- **初期値**：全科目 **50** を自動セット。
- **クイックボタン**：各科目に **40 / 50 / 60 / 70** のショートカットを配置。
- **微調整**：スライダーで **±5（1刻み）**。

# テストの表示

---

## 1. 目的

- 過去に**入力済みのテスト**について、**目標と実績を時系列で対比**し、学習の成果と傾向を可視化する。
- 生徒の**自己評価・内省**（何が上手くいったか／次週どう変えるか）を支援する。

---

## 2. 表示仕様

### 2.1 リスト表示（時系列）

- **並び順**：**新しい順（降順）**。
- **折りたたみ**：表示初期は**最新5件のみ展開**。
    - 6件目以降は「**もっと見る**」ボタンで**5件ずつ**段階展開。
    - 折りたたみ状態でも**件数サマリ**を表示（例：`全12件`）。

### 2.2 テストカード（1件分）

各テストを**カード**で表示。最低以下を含む：

- **ヘッダ**
    - テスト名（例：`第3回 合不合判定テスト` / `第6回 週テスト`）
    - 実施日（`yyyy/MM/dd（曜）`）
    - タイプチップ：`合不合` / `週テスト`
    - （合不合のみ）**コース・組**チップ：`Bコース / 12組`
- **目標 vs 実績（対比領域）**
    - **合不合**：
        - コース・組を**大きく**表示
    - **週テスト**：
        - **科目別4分割**（算/国/理/社）で**目標偏差値 / 実績偏差値**の**ペア表示**
        - 各科目に**Δ（実績−目標）**をチップで表示（色：上昇=緑 / 同等=灰 / 下降=赤）
- **達成判定**
    - 合不合：コースと組みが上回った場合
    - 週テスト：**科目別に判定**し、カード上部に**達成数**を集計表示（例：`3/4科目 達成`）
- **補助情報**（任意表示）
    - 当該週の学習累積点（0–36）
    - 前回比（コース・組/科目偏差値の推移矢印）
    - メモ / AIコーチ所見がある場合はアイコンで示しモーダルで展開

> 表示例（週テストの科目ボックス）
> 
> 
> `算：目標 55｜実績 57｜Δ +2`
> 

---

## 3. 操作・インタラクション

- **ソート切替**（任意）：`新しい順 / 古い順`
- **フィルタ**（任意）：`すべて / 合不合 / 週テスト`、`達成/未達`、`科目（週テストのみ）`
- **展開/折りたたみ**：
    - カードはデフォルト**コンパクト**（主要情報のみ）
    - `詳細を見る`で**詳細（科目内訳・推移・メモ）**を開閉
- **共有/コピー**（任意）：テキスト整形で**目標と実績の抜粋**をコピー（保護者共有向け）

## **4.4 スパーク機能**

### **1. 機能概要**

スパーク機能は、中学受験を目指す小学生の学習記録と振り返りを支援する段階的成長システムである。「Spark（楽しくスタート）」「Flame（成長ステップ）」「Blaze（最高にチャレンジ）」の3つのレベルを通じて、記録習慣の形成から深い自己内省まで、生徒の成長段階に応じた最適な学習支援を提供する。

### **2. 設計思想**

本機能の核心は、中学受験における学習の優先順位を明確化することにある。授業参加と宿題実施を最重要とし、それらの復習、週テスト対策、入試対策という順序で学習活動を構造化する。この優先順位を可視化することで、生徒が「何をすべきか」を迷わず判断できる環境を提供する。

### **3. レベル設計**

以下に記載する、理解度は次のように定義する。

理解度

- バッチリ理解
    - 解いた問題の正答率・・・90パーセント以上（90-100）
- できた
    - 解いた問題の正答率・・・80パーセント以上（80-89）
- ふつう
    - 解いた問題の正答率・・・70パーセント以上（70-79）
- ちょっと不安
    - 解いた問題の正答率・・・50パーセント以上（50-69）
- むずかしかった
    - 解いた問題の正答率・・・50パーセント未満（0-49）

### **3.1 Spark（楽しくスタート）**

### **目的**

記録習慣の形成に100%集中し、継続の基盤を作る。

### **機能仕様**

**入力項目**

| 項目 | 入力方法 | 必須/任意 | 備考 |
| --- | --- | --- | --- |
| 学習日 | 自動入力（今日） | 必須 | カレンダーから変更可能 |
| 学習科目 | タップ選択（複数可） | 必須 | 算数・国語・理科・社会から選択 |
| 今日の気持ち | 3段階選択 | 必須 | 😄バッチリ理解 / 😐ふつう / 😥むずかしかった |

**学習タイプ選択**: 表示されない
**想定入力時間**: 15秒以内

- 振り返り機能なし（挫折リスクの最小化）
- 週3回以上の記録で次レベル解放条件達成

### **解放条件**

- 新規ユーザーは全員このレベルからスタート
- Flameレベル以上のユーザーも選択可能

### **3.2 Flame（成長ステップ）**

### **目的**

学習内容の構造化と、振り返り習慣の導入。

### **機能仕様**

## Flameレベル 機能仕様表

### 入力項目一覧

| 項目 | 入力方法 | 必須/任意 | 備考 |
| --- | --- | --- | --- |
| 学習日 | 自動入力（今日） | 必須 | カレンダーから変更可能 |
| 学習科目 | タップ選択（複数可） | 必須 | 算数・国語・理科・社会から選択 |
| 科目別理解度 | 5段階選択 | 必須 | 😄バッチリ理解 / 😊できた / 😐ふつう / 😟ちょっと不安 / 😥むずかしかった |
| 科目別学習内容 | チェックボックス | 必須 | 下記4カテゴリーから複数選択可 |
| 今日の振り返り | 自由記述またはAI選択 | 任意 | 2つのボタンから選択して入力 |

科目別学習内容は入力必須とする。

学習した科目を選択すると、まずは学習内容を科目ごとに入力するようにする。デフォルトでは、学習内容の４つの項目だけが表示されている。

学習内容は複数選択可能であり、選択した項目ごとに、理解度を表示するようにする。

**学習内容カテゴリー**

| カテゴリー | 優先度 | 視覚表示 | 説明 |
| --- | --- | --- | --- |
| 授業 | 最重要 | 🔴 | 授業で解いた問題・解き直しの復習を含む |
| 宿題 | 最重要 | 🔴 | 宿題で出された問題・解き直しの復習を含む |
|  |  |  |  |
|  |  |  |  |
| 週テスト対策・復習ナビ | 標準 | 🔵 | 週テスト範囲の演習や復習・復習ナビでの実施 |
| 入試対策・過去問 | 補充 | ⚪️ | 過去問・入試レベル問題など |

**振り返り機能 (任意)**

| 選択ボタン | 動作 | 仕様 |
| --- | --- | --- |
| 今日の振り返りをする | 自由記述欄を表示 | 最大200字（目安80-120字） |
| 今日の振り返りを生成 | AI選択肢3つを生成 | Celebrate系 / Insight系 / Next step系 |

**振り返り機能：**

- AIが3つの選択肢を生成のポイント
    - Celebrate系（できたこと・セルフコンパッション）
    - Insight系（学び・気づき）
    - Next step系（If-Thenを含む・次への行動）
    → “選ぶだけ”で**自己効力×メタ認知×行動**が揃う。

### **解放条件**

- Sparkレベルで週3回以上の記録達成
- 達成時に「来週からFlameレベル！振り返り機能が使えるよ🔥」と予告表示

### **レベルダウン条件**

- 週2回以下の記録が2週連続した場合、翌週はSparkレベルのみ選択可能

### **3.3 Blaze（最高にチャレンジ）**

### **目的**

AIコーチとの対話を通じた深い自己内省の実現。

### **機能仕様**

**入力項目一覧**

| 項目 | 入力方法 | 必須/任意 | 備考 |
| --- | --- | --- | --- |
| 学習日 | 自動入力（今日） | 必須 | カレンダーから変更可能 |
| 学習科目 | タップ選択（複数可） | 必須 | 算数・国語・理科・社会から選択 |
| 科目別理解度 | 5段階選択 | 必須 | 😊バッチリ理解 / 😃できた / 😐ふつう / 😟ちょっと不安 / 😥むずかしかった |
| 科目別学習内容 | チェックボックス | 必須 | 下記４カテゴリーから複数選択可 |
| AIコーチとの振り返り | 選択式→記述/選択 | 任意 | 初期表示の2択から選んで進行 |

**学習内容カテゴリー**
Flameレベルと同様

**AIコーチ振り返り機能 (任意)**

| 選択ボタン | 選択後の動作 | 仕様 |
| --- | --- | --- |
| 1.今日の振り返りを私（AIコーチ）に生成してもらいたい | AI選択肢3つを生成 | Celebrate系 / Insight系 / Next step系から選択 |
| 2.今日の振り返りを私としたい | AIが個別最適化質問を表示→自由記述欄 | 最大400字（目安80-120字）
「質問と関係なく自由に書いてもOK」の注記付き |

**AIコーチ機能：**
初期表示で2つの選択肢を提示：

1. 「今日の振り返りを私（AIコーチ）に生成してもらいたい」
    - 選択するとFlame同様の3つの選択肢を生成
2. 「今日の振り返りを私としたい」
    - 選択するとAIが個別最適化された質問を表示
    - 最大400字の自由記述欄
    - 「この質問とは関係なく自由に振り返りを書いてもいいからね！」の注記付き

**AI応答：**

- 生徒の入力内容と分量に応じた返信
- 1ターンで完結（自己内省を主目的とするため）

### **解放条件**

- Flameレベルで科目別学習内容を週3回以上入力
- 達成時に「来週からBlazeレベル！AIコーチと会話できるようになるよ！」と予告表示

### **レベルダウン条件**

- 科目別内容入力が週2回以下を2週連続した場合、翌週はFlameとSparkのみ選択可能

### **4. 週管理システム**

### **週の定義**

- 月曜日開始、日曜日終了
- 土曜日の週テスト、日曜日の合不合テストのサイクルに対応

### **プログレスバー表示**

- Flame解放まで：■■■□□（あと2回記録でレベルアップ！）
- Blaze解放まで：■■□（学習内容をあと1回記録でレベルアップ！）

### **5. UI/UX設計方針**

### **視覚的優先度の表現**

学習内容の４カテゴリーを色分けして優先順位を明示：

- 赤（🔴）：最重要（授業・宿題）
- 青（🔵）：週テスト対策・復習ナビ
- 白（⚪）：入試対策・過去問

### **入力補助**

- 振り返り自由記述欄に「目安80-120字」のヒント表示
- 任意入力項目は全て「押さない選択」を明示的に設計

### **6. コスト最適化**

### **AI生成の効率化**

- ボタンを押した時のみAI生成（初期表示では生成しない）
- 生成待ち時間による離脱防止
- サーバーコストの削減
- 一度生成したものは記録しておき、ボタンを複数回クリックしても生成は一度だけにする。

### **7. 教育効果の設計**

### **段階的な成長支援**

1. **Spark**：習慣形成（認知負荷最小）
2. **Flame**：構造化と言語化（中程度の負荷）
3. **Blaze**：深い内省（主体的な取り組み）

### **主体性の確保**

- 全ての振り返りを任意入力
- レベル選択の自由度を保証
- AI質問に縛られない自由記述を明示的に許可

### **8. ゲーミフィケーション要素**

### **レベルアップシステム**

- 明確な解放条件と視覚的なプログレス表示
- 達成時の予告メッセージでモチベーション向上
- レベルダウンも「再挑戦」として前向きに設計

### **9. データ管理**

### **記録データ**

- 基本記録（日付、科目、気持ち）
- 詳細記録（理解度、学習内容）
- 振り返りデータ（選択肢、自由記述、AI応答）

### **分析用データ**

- 継続率、レベル移行率
- 学習内容の選択パターン
- 振り返りの質的変化

## Blazeレベル AIコーチ個別最適化質問生成 要件定義

### 1. 設計の核心理念

AIコーチは、全ての学習履歴を完全に記憶している「理想の伴走者」として、生徒一人ひとりの小さな変化も見逃さない。人間には不可能な完璧な記憶力を活かしつつ、人間らしい温かさと変化に富んだ対話を実現する。

### 2. 質問文の動的な長さ調整

| 状況カテゴリ | 文字数 | 構成 | 実例 |
| --- | --- | --- | --- |
| **通常時** | 30-50字 | シンプルな問いかけ | 「算数の復習、どの問題が一番スッキリした？」 |
| **変化察知時** | 60-80字 | 気づき＋共感＋問い | 「おっ、今日は理科もやったんだね！いつもは算数と国語が中心だったけど、何かきっかけがあった？」 |
| **困難察知時** | 70-100字 | 深い共感＋励まし＋小さな問い | 「算数、今週ずっと『むずかしい』が続いてるね。本当によく頑張ってる。正直、どの単元が一番の壁になってる？一緒に考えよう」 |
| **大躍進時** | 60-90字 | 驚き＋承認＋次への期待 | 「すごい！先週まで苦手だった速さの問題が『できた』になってる！何が変わった？この調子を他にも活かせそう？」 |

### 3. 記憶の完全性を活かした言及パターン

| 参照期間 | 言及の仕方 | 効果 |
| --- | --- | --- |
| **前日** | 「昨日○○って書いてたけど」 | 継続的な見守り |
| **3日前** | 「月曜日に悩んでた○○」 | 短期的な成長の可視化 |
| **1週間前** | 「先週の今頃は○○だったのに」 | 変化への気づき |
| **2週間前** | 「2週間前から比べると」 | 中期的な成長実感 |
| **1ヶ月前** | 「そういえば最初の頃は」 | 大きな成長の認識 |
| **初回** | 「初めて記録した日から数えて」 | 全体の歩みの価値 |

### 4. マンネリ防止のための多層的ランダム化

### 4.1 基本パターンプール（各カテゴリから動的選択）

| カテゴリ | バリエーション例 |
| --- | --- |
| **成果確認型** | 「今日の収穫は？」「一番の学びは？」「『できた！』と思えた瞬間は？」 |
| **過程重視型** | 「どんな風に取り組んだ？」「工夫したところは？」「集中できた理由は？」 |
| **感情探索型** | 「正直な気持ちは？」「やってみてどうだった？」「スッキリした？モヤモヤ残ってる？」 |
| **未来接続型** | 「次はどうしたい？」「明日につながることは？」「この経験を活かすなら？」 |
| **意味発見型** | 「なぜその順番で？」「それを選んだ理由は？」「自分にとっての意味は？」 |

### 4.2 文体のゆらぎ

```
同じ意図でも表現を変える：
- 「どうだった？」
- 「どんな感じ？」
- 「手応えは？」
- 「やってみて、どう？」
- 「率直な感想は？」

```

### 5. 状況認識の精度向上

| 検出パターン | 判定ロジック | 対応する質問の性質 |
| --- | --- | --- |
| **ブレイクスルー** | 理解度が2段階以上上昇 | 興奮と次への期待を共有 |
| **静かな継続** | 同じパターンが4日以上 | 継続の価値を別角度から照らす |
| **新しい挑戦** | 初めての学習タイプ or 久々の科目 | 挑戦への敬意と好奇心 |
| **目標との乖離** | 週目標と異なる学習が3日連続 | 判断を尊重しつつ意図を確認 |
| **疲労の兆候** | 理解度低下＋学習時間減少 | 休息の必要性も含めた共感 |

### 6. 週内変動アルゴリズム

```python
def 質問パターン選択(曜日, 週番号, 過去質問履歴):
    # 基本パターンを週番号でシフト
    base_pattern = (曜日 + 週番号) % 5

    # 過去3日の質問タイプと重複しないよう調整
    while base_pattern in 過去質問履歴[-3:]:
        base_pattern = (base_pattern + 1) % 5

    # 月曜は必ず「新しい週」を意識した質問
    if 曜日 == "月" and random() > 0.7:
        return "週末リセット型"

    # 金曜は「週の締め」を意識
    if 曜日 == "金" and random() > 0.6:
        return "週間統括型"

    return pattern_types[base_pattern]

```

### 7. 記憶参照の優先順位（改訂版）

| 優先度 | 参照内容 | 活用方法 |
| --- | --- | --- |
| 1 | 本日と昨日の差分 | 24時間の変化を敏感に察知 |
| 2 | 週目標との関連性 | 「君が決めた○○」として常に意識 |
| 3 | 過去の成功パターン | 「前に○○がうまくいった時と似てるね」 |
| 4 | 苦手克服の履歴 | 「○○は前も苦労したけど乗り越えたよね」 |
| 5 | 初めての経験 | 「○○は初めてだね」という特別感 |

### 8. 質問の品質保証チェックリスト

| チェック項目 | 基準 |
| --- | --- |
| **個別性** | その生徒の具体的なデータが2つ以上含まれているか |
| **新規性** | 過去5日間で使用していない表現が含まれているか |
| **共感性** | 感情や状況への理解が表現されているか |
| **発展性** | 答えが Yes/No で終わらない開かれた問いか |
| **記憶活用** | 過去の学習履歴への言及があるか |

### 9. 特殊ケースへの対応

| ケース | 質問例 | 意図 |
| --- | --- | --- |
| 初めてのBlaze利用 | 「ついにBlazeレベルだね！緊張する？それともワクワク？」 | 特別な瞬間の共有 |
| 1ヶ月連続記録 | 「1ヶ月毎日記録してる！自分でも驚いてる？当然だと思ってる？」 | 大きな達成の意識化 |
| 目標完全達成 | 「週目標、完璧に達成！正直、自分でもやれると思ってた？」 | 自己効力感の強化 |
| 体調不良後の復帰 | 「お帰り！休んでた間、何か勉強のこと考えてた？」 | 温かい迎え入れ |

### 10. 実装時の注意事項

- 同じフレーズは最低10日間は再利用しない
- 生徒の名前や愛称を知っている場合は、10回に1回程度自然に挿入
- 適宜、絵文字や「！」「？」の使い分けで感情を表現
- 時には質問ではなく純粋な承認だけで終わることも（5%程度）

この要件定義により、膨大な記憶を持ちながらも人間らしい温かさと変化に富んだ、真に個別最適化されたAIコーチを実現する。

# 4.5リフレクト機能

## 1. 機能概要

リフレクト機能は、生徒の主体的な成長を促す週次振り返りシステムである。AIコーチングを通じて、生徒自身が気づいていない成長を可視化し、次週への具体的な目標を自ら設定できるよう支援する。

## 2. 基本機能構成（画面イメージに準拠）

### 2.1 メイン画面構成

| セクション | 内容 | 備考 |
| --- | --- | --- |
| AIコーチング | 土曜12時限定表示 | 「週間振り返りを始める」ボタン |
| 学習履歴 | 自分の記録一覧 | 日付・科目・正答率表示 |
| 応援メッセージ | 保護者・指導者からの応援 | 時系列表示 |
| 友だち | 相互承認した友人の記録 | デフォルト非表示 |
| コーチング履歴 | コーチングの履歴 |  |
|  |  |  |

トップにAIコーチングが表示されている（表示期間であれば）。

その下に、次の順番でタブ表示されている。デフォルトだと学習履歴が表示されている。

タブの表示順・・・学習履歴、応援メッセージ、友達、テスト

---

---

### 2.1.1 学習履歴表示機能

### 表示項目

スパーク機能で記録したものを表示する

| 項目 | 内容 |
| --- | --- |
| 記録日時 | 記録を行った日時 |
| 学習日 | 実際に学習を行った日 |
| 科目 | 算数/国語/理科/社会 |
| 学習内容 | 4項目 |
| 気持ち | 5段階評価アイコン |
| 振り返り | 記入があった場合 |

### フィルター・ソート機能

| 機能 | 選択肢 | デフォルト |
| --- | --- | --- |
| 科目フィルター | 全科目/算数/国語/理科/社会 | 全科目 |
| 期間フィルター | 1週間/1ヶ月/3ヶ月/全て | 1ヶ月 |
| 並び替え | 記録日時/学習日/正答率 | 記録日時（降順） |

### 2.1.2 応援履歴機能

| 項目 | 仕様 |
| --- | --- |
| 表示内容 | 保護者・指導者からの応援メッセージ |
| 表示順 | 記録日時の降順（新しい順） |
| 初期表示 | 直近1ヶ月分 |
| 追加表示 | 「もっと見る」ボタンで全履歴表示 |

### 2.1.3 友人の学習履歴機能

| 項目 | 仕様 |
| --- | --- |
| デフォルト設定 | 非共有 |
| 共有方法 | 相互承認制（両者がボタンを押す） |
| 表示内容 | 友人の学習記録（個人情報保護に配慮） |
| 初期表示 | 直近1ヶ月分 |

### 2.1.4 コーチング履歴機能

過去のAIコーチングの会話記録を時系列で表示し、成長の軌跡を可視化する。

## 週次AIコーチング機能詳細

### 動的な対話設計

### **週ごとに変化する対話パターン**

| 週タイプ | 判定基準 | 対話の特徴 | ターン数 |
| --- | --- | --- | --- |
| **成長週** | 先週より正答率10%以上UP | 成功要因の深掘り中心 | 3-4往復 |
| **安定週** | 正答率変化±10%以内 | 新しい挑戦の提案 | 4-5往復 |
| **挑戦週** | 正答率10%以上DOWN | セルフコンパッション重視 | 5-6往復 |
| **特別週** | 月1テスト直前 | 具体的な対策立案 | 4往復 |

### 3.2 対話フローの動的生成

### **Phase 1: オープニング（1往復目）**

状況に応じた3パターンから自動選択：

```
パターンA（データ承認型）- 60%の確率
AI: 「今週は算数を5回も取り組んだね！特に水曜の正答率85%はすごい。どんな工夫をした？」

パターンB（感情確認型）- 30%の確率
AI: 「今週お疲れさま！率直に、今週の調子はどうだった？」

パターンC（目標確認型）- 10%の確率
AI: 「先週立てた『国語の読解強化』、やってみてどうだった？」

```

### **Phase 2: 深掘り（2-3往復目）**

生徒の回答内容によって分岐：

| 生徒の回答傾向 | AI応答方針 | 次の質問例 |
| --- | --- | --- |
| ポジティブ | 成功要因の言語化 | 「その調子を他の科目にも活かすなら？」 |
| ネガティブ | 小さな成功の発見 | 「大変だった中で、1つでも『できた』と思えることは？」 |
| 中立的 | 具体的な振り返り | 「一番時間をかけた科目の手応えは？」 |

### **Phase 3: 目標設定（ラスト2往復）**

**結果目標と行動目標の分離設定**：

```
AI: 「来週の週テスト、どんな結果を目指す？」
生徒: 「偏差値50超えたい」
AI: 「偏差値50超え、いいね！そのために今週特に力を入れることを1つ選ぶなら？
　　①苦手な理科を毎日15分
　　②得意な算数をさらに伸ばす
　　③全科目バランスよく」
生徒: 「①の理科」
AI: 「理科毎日15分、確実にできそう？それとも週4回の方が現実的？」

```

### 3.3 マンネリ防止の仕組み

### **質問バリエーションプール**

| カテゴリ | 質問例（10種類以上をランダム使用） |
| --- | --- |
| 振り返り導入 | 「今週の自分に点数つけるなら？」「今週一番印象に残った瞬間は？」「今週の学習を一言で表すと？」 |
| 成功確認 | 「できるようになったことは？」「前より楽になったことは？」「『分かった！』と思えた瞬間は？」 |
| 課題認識 | 「正直、苦戦したところは？」「もう少し時間が欲しかった科目は？」「来週に持ち越したい課題は？」 |

### **対話回数の変動**

- 最小3往復（調子が良く、目標が明確な場合）
- 最大6往復（じっくり振り返りが必要な場合）
- 生徒が「もう決まった」と言えば早期終了可能

### 3.4 目標設定の構造

| 目標タイプ | 設定内容 | 例 |
| --- | --- | --- |
| **結果目標** | 週テストで目指す数値 | 「偏差値52以上」「算数80点以上」 |
| **行動目標** | 具体的な学習行動 | 「理科を毎日20分」「漢字を50個覚える」 |
| **意気込み** | 一言宣言（任意） | 「今週は理科がんばる！」 |

## 4. UI/UX仕様

### 4.1 コーチング画面

- LINEライクなチャット形式
- AIコーチは親しみやすいアバター表示
- 選択肢はボタンで表示（タップしやすく）
- 入力中を示す「...」アニメーション

### 4.2 特別感の演出

| 要素 | 実装 |
| --- | --- |
| 限定感 | 「土曜日限定」のラベル表示 |
| 視覚効果 | ボタンの光るアニメーション |
| 音効果 | 完了時の達成音 |
| 報酬 | 振り返り完了バッジ |

## 5. セルフコンパッション実装

### 否定的発言への応答マトリクス

| 生徒の発言 | AI応答 | 次の展開 |
| --- | --- | --- |
| 「全然ダメだった」 | 「そう感じるんだね。でも記録を見ると○○は確実に進歩してるよ」 | 小さな成功を一緒に探す |
| 「友達はもっとできてる」 | 「他の人と比べなくて大丈夫。先週の自分より○○が向上してる」 | 自分の成長に焦点を当てる |
| 「やる気が出ない」 | 「そういう時もあるよね。今週○回も記録したことがすでにすごい」 | 継続自体を承認 |

## 6. データ活用と学習

### 6.1 コーチングの個別最適化

- 過去の対話履歴を参照し、同じ質問を避ける
- 生徒の回答傾向（簡潔/詳細）に合わせた質問量調整
- よく使う言葉を記憶し、生徒の表現を使用

### 6.2 成長の可視化

週次サマリーの自動生成：

```
「先月と比べて：
　✓ 算数の正答率が15%向上
　✓ 学習日数が週3→週5に増加
　✓ 苦手だった理科にも挑戦開始」

```

## 7. 成功指標

| 指標 | 目標値 | 測定方法 |
| --- | --- | --- |
| コーチング完遂率 | 70%以上 | 開始→目標設定完了の割合 |
| 継続利用率 | 4週連続60%以上 | 毎週実施する生徒の割合 |
| 目標達成実感 | 50%以上 | 翌週の振り返りでの自己評価 |
| 対話満足度 | 4/5以上 | 任意アンケート |

この設計により、毎週新鮮で、生徒の状況に応じた最適な振り返りを実現し、主体的な目標設定と成長実感を促進する。

# 保護者画面 要件定義書

## 1. 機能概要

保護者画面は、子どもの学習状況を適切に把握し、主体性を尊重した応援を通じて、子どもの可能性を最大限に開花させることを支援する機能である。「見守り」と「応援」を基本とし、過度な介入を防ぎながら、親子で中学受験に向き合える環境を提供する。

## 2. 画面構成

### 2.1 基本レイアウト

| 要素 | 内容 | 仕様 |
| --- | --- | --- |
| **上部タブ** | 子ども選択 | 複数の子どもがいる場合、タブで切り替え |
| **メインナビ** | 機能切り替え | 学習履歴/応援メッセージ/分析 |
| **フッターナビ** | 画面遷移 | ホーム/ゴールナビ/応援/リフレクト |

### 2.2 複数子ども対応

```yaml
表示仕様:
  - 子ども名でタブ表示（例：みかん/太郎）
  - アクティブな子どものタブをハイライト
  - 各子どもの未応援数をバッジ表示
  - タブ切り替えで即座にデータ更新

```

## 3. 主要機能詳細

# 保護者ホーム（Guardian Home）要件定義

前提：**生徒ホームを骨格共有**しつつ、保護者のJTBD（状況把握→声かけ→環境整備→必要時連携）に合わせ**約30%改変**する。週は**月曜開始〜日曜終了**、TZは**Asia/Tokyo**、カラースキームは**ベース：White/Gray、アクセント：Blue系**。

---

## 1. 情報設計 / レイアウト

### 1.1 目的

- **60秒以内**に「今の状況」「今日の支援ポイント」「次の一手」を判断可能にする。
- 生徒データは**参照のみ**、保護者は**応援・提案**に集中。

### 1.2 表示優先度（モバイル）

1. 学習ダッシュボード（解釈つき）
2. 今週の目標（到達見込み/リスク）
3. 「今日のミッション！」
4. AIコーチメッセージ（保護者向けTip）
5. 学習カレンダー（連続日数バッジ強調）

### 1.3 権限マトリクス

| 機能/データ | 生徒 | 保護者 |
| --- | --- | --- |
| 学習入力（授業/宿題/理解度） | 〇 | ×（閲覧のみ） |
| 目標編集 | 〇 | ×（提案のみ可） |
|  |  |  |
| 先生に相談（連絡起票） | ー | 〇 |
| 友達表示設定 | 〇 | 〇（子の同意要） |

---

## 2. 機能別要件

### 2.5 学習ダッシュボード（解釈つき）

**表示**：リング3（0–12）＋週累積（0–36）は生徒と同一。上部に**アラート**／右に**推奨アクション**。

- **アラート例**：`未入力が2日連続`／`テスト3日前：算数未達`
- **推奨アクション**：応援メッセージ送信（ワンタップで送信可能）
- 応援メッセージは学習ダッシュボードを分析の上、chat-gpt5-miniが一言応援を作成。即時生徒に送信。

### 2.4 今週の目標（到達見込み付き）

**表示**：次回テスト名/日付/残D日、**到達見込みラベル**（高/接戦/危険）、生徒の**今回の思い**（折りたたみ）。

- **合不合**：コース/組チップを表示
- **週テスト**：4科目の**目標偏差値**を数値バッジで表示

### 2.2 「今日のミッション！」

**目的**：6パネルの**要対応数**をひと目で把握する。

表示は生徒画面と一緒。

### 2.1 AIコーチメッセージ（保護者向けTip）

**目的**：その日の**具体的声かけ**を短文で提示。

**頻度**：1日1回生成（保護者用ロジック/キャッシュは生徒と別）。

- **構造（30–60字）**：状況認識（10–20字）＋提案（20–40字）
- **参照優先**：連続日数 ＞ 今週スコア推移 ＞ 残日数 ＞ ミッション未達 ＞ 直近リフレクト要約
- **禁止**：比較/プレッシャー/60字超
- **API 例**
    - `GET /api/guardian/daily-tip?guardian_id&student_id&date`
    - レスポンス：`{ message, intent("praise|nudge|plan"), cached, generated_at }`
- **受け入れ基準**：同日再訪で同一文／大きな進捗や目標達成で即更新

---

### 

---

### 2.3 学習カレンダー（連続日数重視）

**表示**：ヒートマップ＋**連続日数バッジ（大）**、当月/次月。

**追加**：`連続3日→短時間でもOKを承認` など**声かけ例チップ**表示。

---

### 

---

### 3.2 ゴールナビ（閲覧専用）

お子さんが複数いる時は、お子さんを上部のタブで選択できるようにします。

生徒のゴールナビのテスト結果だけをそのまま表示します。

| 項目 | 表示内容 | 制限事項 |
| --- | --- | --- |
|  |  |  |
|  |  |  |
| テスト結果 | 履歴一覧 | 閲覧のみ |

### 3.3 応援機能（スパーク機能の代替）

### 3.3.1 学習記録一覧

| 表示項目 | 内容 | 操作 |
| --- | --- | --- |
| **日付・時刻** | 学習実施日時 | タップで詳細 |
| **気持ちアイコン** | 5段階の顔文字 | - |
| **科目タグ** | 算数/国語/理科/社会 | フィルター可能 |
| 学習内容 | ６つのカテゴリー | - |
| **振り返り** | 子どものコメント | 全文表示 |
| **応援状態** | 未応援/応援済み | アイコンで表示 |

### 3.3.2 応援方法（3種類）

### A. クイック応援（1タップ・1秒）

| ボタン | アイコン | メッセージ |
| --- | --- | --- |
| がんばったね | ❤️ | 固定テキスト送信 |
| すごい！ | ⭐ | 固定テキスト送信 |
| よくできました | 👍 | 固定テキスト送信 |

### B. AI提案メッセージ（3秒選択）

```yaml
生成ロジック:
  入力データ:
    - 科目・正答率
    - 子どもの気持ち（5段階）
    - 振り返りコメント
    - 過去の応援パターン

  出力パターン（3種類）:
    1. 励まし型（40%）: 努力への承認
    2. 共感型（30%）: 感情への寄り添い
    3. 次への期待型（30%）: 前向きな展望
    保護者としての応援コメントとする

コスト最適化:
  - 1記録につき1回のみ生成
  - 生成済みはキャッシュから表示
  - 7日後に自動削除

```

### C. カスタムメッセージ（30秒入力）

| 仕様 | 内容 |
| --- | --- |
| 文字数 | 最大200文字 |
| 入力補助 | 予測変換・定型文 |
| 送信後 | 即座に子どもに通知 |

### 3.3.3 応援管理

| 機能 | 仕様 | 目的 |
| --- | --- | --- |
| **表示フィルター** | 未応援を優先表示 | 効率化 |
| **自動非表示** | 応援済みは折りたたみ | 見やすさ |
| **一括応援** | 複数選択して応援 | 時短 |
|  |  |  |

### 3.4 リフレクト機能

### 3.4.1 表示タブ構成

| タブ | 内容 | デフォルト表示 |
| --- | --- | --- |
| **学習履歴** | 子どもの全記録 | 直近1ヶ月 |
| **応援メッセージ** | 送信済み応援一覧 | 直近1ヶ月 |
| **分析** | 成長グラフ・傾向 | 週次サマリー |

### 3.4.2 学習履歴詳細

```yaml
フィルター機能:
  科目: 全科目/算数/国語/理科/社会
  期間: 1週間/1ヶ月/3ヶ月/全期間

ソート機能:
  - 記録日時（新しい順/古い順）
  - 気持ち（良い順/悪い順）
  - 科目別

表示項目:
  - 学習日時
  - 科目・単元
  - 気持ちアイコン
  - 子どもの振り返り
  - 送信した応援

```

### 3.4.3 応援メッセージ履歴

| 表示内容 | 仕様 |
| --- | --- |
| 送信日時 | タイムスタンプ表示 |
| 対象の学習 | 科目・日付を表示 |
| メッセージ内容 | 全文表示 |
| 子どもの反応 | 既読・リアクション |

## 4. 保護者の心理的配慮

### 4.1 プレッシャーを与えない工夫

| 設計要素 | 実装 | 効果 |
| --- | --- | --- |
| **中立的な表現** | 「新しい記録」表示 | 責任感の軽減 |
| **ポジティブフォーカス** | できたことを強調 | 前向きな関わり |
| **選択の自由** | 応援は任意 | 自然な動機づけ |

### 4.2 忙しい保護者への対応

```yaml
省力化機能:
  - デフォルト表示の最適化
  - ワンタップ操作
  - AI提案の活用

```

## 5. 子どもの主体性を守る制限

| 制限事項 | 理由 | 代替機能 |
| --- | --- | --- |
| 目標編集不可 | 自己決定権の尊重 | 閲覧のみ |
| 学習指示禁止 | 主体性の維持 | 応援のみ |
| 友人情報非表示 | 比較防止 | 自分の子のみ |
| 詳細介入防止 | 過干渉防止 | マクロ視点 |

## 6. データ分析機能

### 6.1 成長の可視化

| 分析項目 | 表示形式 | 更新頻度 |
| --- | --- | --- |
| **学習頻度** | 棒グラフ | 日次 |
| **科目バランス** | 円グラフ | 週次 |
|  |  |  |
| **応援効果** | 相関分析 | 週次 |

### 6.2 レポート機能

```yaml
週次レポート:
  - 学習日数
  - 科目別取り組み
  - 成長ポイント3つ
  - 来週への展望

月次レポート:
  - 目標達成率
  - 成長トレンド
  - 強み・課題分析
  - 応援の効果測定

```

# 保護者画面 要件定義書

## 1. 機能概要

保護者画面は、子どもの学習状況を適切に把握し、主体性を尊重した応援を通じて、子どもの可能性を最大限に開花させることを支援する機能である。「見守り」と「応援」を基本とし、過度な介入を防ぎながら、親子で中学受験に向き合える環境を提供する。

## 2. 画面構成

### 2.1 基本レイアウト

| 要素 | 内容 | 仕様 |
| --- | --- | --- |
| **上部タブ** | 子ども選択 | 複数の子どもがいる場合、タブで切り替え |
| **メインナビ** | 機能切り替え | 学習履歴/応援メッセージ/分析 |
| **フッターナビ** | 画面遷移 | ホーム/ゴールナビ/応援/リフレクト |

### 2.2 複数子ども対応

```yaml
表示仕様:
  - 子ども名でタブ表示（例：みかん/太郎）
  - アクティブな子どものタブをハイライト
  - 各子どもの未応援数をバッジ表示
  - タブ切り替えで即座にデータ更新

```

## 3. 主要機能詳細

### 3.1 ホーム画面

| セクション | 表示内容 | 更新頻度 |
| --- | --- | --- |
| **本日のサマリー** | 学習時間・科目・気持ち | リアルタイム |
| **週間トレンド** | 学習頻度・正答率推移 | 日次更新 |
| **直近の応援** | 最新の応援メッセージ | 即時反映 |
| **未応援通知** | 「新しい学習記録：○件」 | リアルタイム |

### 3.2 ゴールナビ（閲覧専用）

| 項目 | 表示内容 | 制限事項 |
| --- | --- | --- |
| **目標確認** | 子どもが設定した週次/月次目標 | 編集不可 |
| **達成状況** | 進捗バー・達成率 | 閲覧のみ |
| **過去の目標** | 履歴一覧 | 閲覧のみ |

### 3.3 応援機能（スパーク機能の代替）

### 3.3.1 学習記録一覧

| 表示項目 | 内容 | 操作 |
| --- | --- | --- |
| **日付・時刻** | 学習実施日時 | タップで詳細 |
| **気持ちアイコン** | 5段階の顔文字 | - |
| **科目タグ** | 算数/国語/理科/社会 | フィルター可能 |
| 学習内容 | ６つのカテゴリー | - |
| **振り返り** | 子どものコメント | 全文表示 |
| **応援状態** | 未応援/応援済み | アイコンで表示 |

### 3.3.2 応援方法（3種類）

### A. クイック応援（1タップ・1秒）

| ボタン | アイコン | メッセージ |
| --- | --- | --- |
| がんばったね | ❤️ | 固定テキスト送信 |
| すごい！ | ⭐ | 固定テキスト送信 |
| よくできました | 👍 | 固定テキスト送信 |

### B. AI提案メッセージ（3秒選択）

```yaml
生成ロジック:
  入力データ:
    - 科目・正答率
    - 子どもの気持ち（5段階）
    - 振り返りコメント
    - 過去の応援パターン

  出力パターン（3種類）:
    1. 励まし型（40%）: 努力への承認
    2. 共感型（30%）: 感情への寄り添い
    3. 次への期待型（30%）: 前向きな展望
    保護者としての応援コメントとする

コスト最適化:
  - 1記録につき1回のみ生成
  - 生成済みはキャッシュから表示
  - 7日後に自動削除

```

### C. カスタムメッセージ（30秒入力）

| 仕様 | 内容 |
| --- | --- |
| 文字数 | 最大200文字 |
| 入力補助 | 予測変換・定型文 |
| 送信後 | 即座に子どもに通知 |

### 3.3.3 応援管理

| 機能 | 仕様 | 目的 |
| --- | --- | --- |
| **表示フィルター** | 未応援を優先表示 | 効率化 |
| **自動非表示** | 応援済みは折りたたみ | 見やすさ |
| **一括応援** | 複数選択して応援 | 時短 |
|  |  |  |

### 3.4 リフレクト機能

### 3.4.1 表示タブ構成

| タブ | 内容 | デフォルト表示 |
| --- | --- | --- |
| **学習履歴** | 子どもの全記録 | 直近1ヶ月 |
| **応援メッセージ** | 送信済み応援一覧 | 直近1ヶ月 |
| **分析** | 成長グラフ・傾向 | 週次サマリー |

### 3.4.2 学習履歴詳細

```yaml
フィルター機能:
  科目: 全科目/算数/国語/理科/社会
  期間: 1週間/1ヶ月/3ヶ月/全期間

ソート機能:
  - 記録日時（新しい順/古い順）
  - 気持ち（良い順/悪い順）
  - 科目別

表示項目:
  - 学習日時
  - 科目・単元
  - 気持ちアイコン
  - 子どもの振り返り
  - 送信した応援

```

### 3.4.3 応援メッセージ履歴

| 表示内容 | 仕様 |
| --- | --- |
| 送信日時 | タイムスタンプ表示 |
| 対象の学習 | 科目・日付を表示 |
| メッセージ内容 | 全文表示 |
| 子どもの反応 | 既読・リアクション |

## 4. 保護者の心理的配慮

### 4.1 プレッシャーを与えない工夫

| 設計要素 | 実装 | 効果 |
| --- | --- | --- |
| **中立的な表現** | 「新しい記録」表示 | 責任感の軽減 |
| **ポジティブフォーカス** | できたことを強調 | 前向きな関わり |
| **選択の自由** | 応援は任意 | 自然な動機づけ |

### 4.2 忙しい保護者への対応

```yaml
省力化機能:
  - デフォルト表示の最適化
  - ワンタップ操作
  - AI提案の活用

```

## 5. 子どもの主体性を守る制限

| 制限事項 | 理由 | 代替機能 |
| --- | --- | --- |
| 目標編集不可 | 自己決定権の尊重 | 閲覧のみ |
| 学習指示禁止 | 主体性の維持 | 応援のみ |
| 友人情報非表示 | 比較防止 | 自分の子のみ |
| 詳細介入防止 | 過干渉防止 | マクロ視点 |

## 6. データ分析機能

### 6.1 成長の可視化

| 分析項目 | 表示形式 | 更新頻度 |
| --- | --- | --- |
| **学習頻度** | 棒グラフ | 日次 |
| **科目バランス** | 円グラフ | 週次 |
|  |  |  |
| **応援効果** | 相関分析 | 週次 |
|  |  |  |

### 6.2 レポート機能

```yaml
週次レポート:
  - 学習日数
  - 科目別取り組み
  - 成長ポイント3つ
  - 来週への展望

月次レポート:
  - 目標達成率
  - 成長トレンド
  - 強み・課題分析
  - 応援の効果測定

```

# 指導者画面 要件定義

## 1. 機能概要

指導者画面は、複数生徒の学習状況と保護者の関わりを総合的に把握し、各生徒の成長段階に応じた個別最適化された応援を提供する専門機能である。生徒の主体性を尊重しながら、専門的な視点から適切なタイミングで効果的な支援を行い、中学受験を通じた人間的成長を促進する。

## 2. ダッシュボード設計

### 2.1 メインダッシュボード

| セクション | 表示内容 | 更新頻度 |
| --- | --- | --- |
| **未応援アラート** | 全生徒の未応援件数と経過時間 | リアルタイム |
| **本日の活動サマリー** | 学習記録数・応援実施率・活動生徒数 | リアルタイム |
| **要注意生徒** | 3日以上未記録・理解度低下・目標乖離 | 1時間ごと |
| **保護者関与度** | 各生徒への保護者応援頻度一覧 | 日次更新 |

### 2.2 生徒一覧画面

```yaml
カード表示内容:
  基本情報:
    - 生徒名（フルネーム）
    - ニックネーム
    - 学年・クラス

  学習状況:
    - 最終記録: 日時と科目
    - 今週の記録回数
    - 直近の理解度傾向（↑→↓）
    - 未応援バッジ（赤数字）

  保護者関与度:
    - 今週の保護者応援回数
    - 最終応援日時
    - 関与度インジケーター（高/中/低）

ソート機能:
  - 未応援の古い順（デフォルト）
  - 保護者関与度の低い順
  - 最終学習日時順
  - 要注意度順

```

## 3. 応援機能詳細

### 3.1 未応援記録の表示

| 項目 | 仕様 | 目的 |
| --- | --- | --- |
| **時系列表示** | 日時順（古い順）に並べる | 公平な応援 |
| **生徒識別** | 各記録に生徒名・アイコン明記 | 即座の識別 |
| **学習内容表示** | 科目・正答率・振り返り全文 | 文脈理解 |
| **保護者応援状況** | 同記録への保護者応援有無 | 重複回避 |
| **経過時間表示** | 記録からの経過時間 | 優先度判断 |

### 3.2 応援パターン（3種類）

### A. AI提案選択型

```yaml
生成ロジック:
  参照データ:
    - 生徒プロフィール（名前・ニックネーム）
    - 直近2週間の学習履歴
    - 科目別の成長傾向
    - 保護者の応援内容（重複回避）
    - 過去の指導者応援への反応

  3パターンの生成:
    パターン1_専門的助言:
      特徴: 具体的な学習方法の提案
      例: "○○さん、分数の約分で時々つまずいね。まず分子と分母の共通因数を見つける練習を5問だけやってみよう"

    パターン2_メタ認知促進:
      特徴: 学習プロセスへの気づき
      例: "理科の暗記、3日連続で取り組んでるね。覚えやすい時間帯は見つかった？○○さんなりのコツがあれば教えて"

    パターン3_長期視点:
      特徴: 成長の軌跡と将来への接続
      例: "1ヶ月前は苦手だった速さの問題、今では7割解けるように。この成長曲線なら入試レベルも見えてきたよ"

```

### B. AI提案編集型

| 機能 | 仕様 | 配慮点 |
| --- | --- | --- |
| **編集範囲** | 全文編集可能 | 指導者の個性反映 |
| **編集ガイド** | 変更推奨箇所をハイライト | 効率化 |
| **差分表示** | 編集前後の比較表示 | 確認しやすさ |
| **履歴保存** | 編集パターンを学習 | 次回提案に反映 |

### C. 完全自由記述型

```yaml
入力仕様:
  文字数: 最大400文字
  入力補助:
    - 生徒別テンプレート
    - よく使うフレーズ辞書
    - 専門用語の予測変換

保存機能:
  - 下書き自動保存
  - 送信前プレビュー
  - 送信後30分は編集可能

```

### 3.3 応援の送信者情報

| 表示場所 | 表示内容 | 非表示設定 |
| --- | --- | --- |
| 生徒画面 | 指導者名（フルネーム）・アイコン | 応援タイプは非表示 |
| 保護者画面 | 指導者名（フルネーム）・送信時刻 | 応援タイプは非表示 |
| 指導者画面 | 全情報表示 | - |

## 4. ゴールナビ連携機能

### 4.1 月次目標へのコメント

```yaml
参照期間の拡張:
  - 過去3ヶ月の学習データ
  - 前回目標の達成状況
  - 長期的な成長トレンド
  - 季節要因（夏期講習等）

動的な文章調整:
  生徒の振り返り文章量:
    短い（50字以下）: コメントも100字程度
    標準（50-150字）: コメントは150-200字
    長い（150字以上）: コメントは200-300字

  語彙レベルの調整:
    小4レベル: 平易な表現、具体例中心
    小5レベル: 標準的な表現、抽象概念も使用
    小6レベル: やや高度な表現、論理的説明

  文体の適応:
    生徒が敬語使用: 丁寧な文体で応答
    生徒がカジュアル: 親しみやすい文体
    生徒が簡潔: ポイントを絞った応答

```

### 4.2 コメント生成パターン

| パターン | 特徴 | 使用場面 |
| --- | --- | --- |
| **目標達成支援型** | 具体的な方法論の提示 | 目標設定直後 |
| **軌道修正型** | 現実的な調整の提案 | 中間地点 |
| **総括評価型** | 成果と次への展望 | 期間終了時 |

## 5. リフレクト連携機能

### 5.1 週次振り返りへのコメント

```yaml
文脈理解の深化:
  参照データ:
    - 該当週の全学習記録
    - AIコーチングの対話内容
    - 生徒の感情推移
    - 保護者の応援頻度と内容

  文章レベルの動的調整:
    認知発達段階の推定:
      - 使用語彙の複雑さ
      - 文章構造の成熟度
      - 抽象概念の理解度

    それに応じた調整:
      - 専門用語の使用頻度
      - 例示の具体性
      - 説明の詳細度

```

### 5.2 効果的なコミュニケーション設計

| 要素 | 実装方法 | 期待効果 |
| --- | --- | --- |
| **ミラーリング** | 生徒の使用語彙を部分的に反映 | 親近感の醸成 |
| **段階的深化** | 徐々に高度な概念を導入 | 無理のない成長 |
| **個別最適化** | 各生徒の認知特性に合わせる | 理解度向上 |

## 6. 保護者連携の可視化

### 6.1 保護者関与度ダッシュボード

```yaml
表示項目:
  定量指標:
    - 応援回数/週
    - 応援率（応援数/記録数）
    - 平均応答時間

  定性指標:
    - 応援メッセージの傾向
    - AI提案vs自由記述の比率
    - 子どもの反応（既読率等）

アラート:
  - 保護者応援が3日間なし
  - 応援率が30%以下
  - 子どもが助けを求めている兆候

```

### 6.2 保護者サポート機能

| 機能 | 内容 | 目的 |
| --- | --- | --- |
| **状況共有** | 保護者応援が少ない場合の通知 | 協力要請 |
| **役割分担** | 保護者/指導者の応援バランス表示 | 最適化 |
| **効果分析** | 保護者応援と成績の相関表示 | 動機づけ |

## 7. 効率化とワークフロー

### 7.1 スマートナビゲーション

```yaml
連続応援モード:
  - 応援送信後、次の未応援へ自動遷移
  - スキップボタンで後回し可能
  - 完了時は完了通知

ショートカット:
  - Tab: 次の記録へ
  - 1,2,3: AI提案の選択
  - Enter: 送信
  - S: スキップ

```

### 7.2 優先度の可視化

| 優先度 | 表示 | 基準 |
| --- | --- | --- |
| **緊急** | 赤枠・上部固定 | 72時間以上未応援 |
| **重要** | オレンジ枠 | 理解度低下・保護者応援なし |
| **通常** | 通常表示 | 24時間以内 |

## 8. Chat-GPT活用仕様

### 8.1 API利用設定

```yaml
モデル: GPT-5-mini
トークン制限:
  - AI提案生成: 最大500トークン/回
  - コメント生成: 最大800トークン/回

コンテキスト設計:
  - システムプロンプト（役割定義）
  - 生徒プロフィール
  - 学習履歴データ
  - 指導方針

```

### 8.2 生成品質管理

| 項目 | 対策 |
| --- | --- |
| 一貫性 | 過去の応援履歴を参照 |
| 適切性 | 年齢・発達段階の考慮 |
| 安全性 | ネガティブ表現のフィルタリング |
| 独自性 | 定型文回避アルゴリズム |

## 9. 分析とレポート

### 9.1 指導効果分析

```yaml
個別生徒分析:
  - 応援前後の学習頻度変化
  - 理解度の推移
  - モチベーション指標

全体傾向分析:
  - クラス別の応援効果
  - 時間帯別の効果
  - 応援タイプ別の反応

```

### 9.2 月次レポート

| セクション | 内容 |
| --- | --- |
| サマリー | 全体的な指導成果 |
| 個別詳細 | 各生徒の成長記録 |
| 保護者連携 | 家庭との協力状況 |
| 改善提案 | 来月への提言 |

## 10. 成功指標

| KPI | 目標値 | 測定方法 |
| --- | --- | --- |
| 応援タイムラグ | 24時間以内95% | システムログ |
| 応援の質 | 生徒満足度4.3/5.0 | フィードバック |
| 保護者連携度 | 関与度「高」が60%以上 | 自動計測 |
| 学習継続率 | 前月比10%向上 | 統計分析 |
| コメント適合度 | 生徒反応率80%以上 | 既読・返信率 |

---