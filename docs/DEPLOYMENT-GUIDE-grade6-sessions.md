# æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼šå°å­¦6å¹´ç”Ÿã®å­¦ç¿’å›æœŸé–“ä¿®æ­£

**ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: `20251217000001_fix_grade6_study_sessions_periods`
**ä½œæˆæ—¥**: 2025-12-17
**å½±éŸ¿ç¯„å›²**: `study_sessions` ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆgrade=6ã®15ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼‰

---

## ğŸ“‹ æº–å‚™å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹å‰ã«ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- [ ] `docs/migration-log.md` ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] `docs/production-migration-step1-check.sql` ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] `docs/production-migration-step2-apply.sql` ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] æœ¬ç•ªSupabase Dashboardã«ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½
- [ ] GitHub ãƒªãƒã‚¸ãƒˆãƒªã¸ã®pushæ¨©é™ãŒã‚ã‚‹
- [ ] ä½œæ¥­æ™‚é–“ãŒç¢ºä¿ã•ã‚Œã¦ã„ã‚‹ï¼ˆç›®å®‰ï¼š30åˆ†ï¼‰

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### **ã‚¹ãƒ†ãƒƒãƒ—1: ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤**

#### 1-1. æœ€å°å·®åˆ†ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ

```bash
# mainãƒ–ãƒ©ãƒ³ãƒã«ç§»å‹•
git checkout main
git pull origin main

# æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
git checkout -b fix/grade6-session-periods

# å¿…è¦ãª3ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’wip/development-toolsã‹ã‚‰å–å¾—
git checkout wip/development-tools -- \
  app/student/spark/spark-client.tsx \
  supabase/seed.sql \
  supabase/migrations/20251217000001_fix_grade6_study_sessions_periods.sql

# æœªã‚¹ãƒ†ãƒ¼ã‚¸ã®å·®åˆ†ã‚’ç¢ºèªï¼ˆ3ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
git diff

# 3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ˜ç¤ºçš„ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°
git add \
  app/student/spark/spark-client.tsx \
  supabase/seed.sql \
  supabase/migrations/20251217000001_fix_grade6_study_sessions_periods.sql

# ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°æ¸ˆã¿å·®åˆ†ã‚’æœ€çµ‚ç¢ºèª
git diff --staged
```

#### 1-2. ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥

```bash
# ã‚³ãƒŸãƒƒãƒˆ
git commit -m "fix: å°å­¦6å¹´ç”Ÿã®å­¦ç¿’å›æœŸé–“ã‚’è¦ä»¶ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé€šã‚Šã«ä¿®æ­£

- app/student/spark/spark-client.tsx: UIè¡¨ç¤ºã®æœŸé–“ã‚’æ›´æ–°
- supabase/seed.sql: åˆæœŸãƒ‡ãƒ¼ã‚¿ã®æœŸé–“ã‚’æ›´æ–°
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ï¼ˆè¨˜éŒ²ç”¨ï¼‰

Refs: docs/03-Requirements-Student.md (line 815)"

# ãƒ—ãƒƒã‚·ãƒ¥
git push origin fix/grade6-session-periods
```

#### 1-3. PRä½œæˆï¼†ãƒãƒ¼ã‚¸

1. GitHubã§PRã‚’ä½œæˆ
2. ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆè‡ªåˆ†ã¾ãŸã¯åŒåƒšï¼‰
3. ãƒãƒ¼ã‚¸ â†’ æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

---

### **ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°ï¼ˆã‚ãªãŸãŒå®Ÿè¡Œï¼‰**

#### 2-1. Supabase Dashboardã«ãƒ­ã‚°ã‚¤ãƒ³

1. https://app.supabase.com ã«ã‚¢ã‚¯ã‚»ã‚¹
2. æœ¬ç•ªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ
3. **SQL Editor** ã‚’é–‹ã

#### 2-2. å®Ÿè¡Œ1å›ç›®ï¼šç¾çŠ¶ç¢ºèª

1. **New Query** ã‚’ã‚¯ãƒªãƒƒã‚¯
2. `docs/production-migration-step1-check.sql` ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒš
3. **Run** ã‚’ã‚¯ãƒªãƒƒã‚¯
4. çµæœã‚’ç¢ºèªï¼š
   - å¯¾è±¡ä»¶æ•°: `15`
   - 15è¡Œã®ç¾åœ¨ã®æœŸé–“ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - **rollback_sqlã‚«ãƒ©ãƒ ã®å†…å®¹ã‚’å…¨é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼**
5. `docs/migration-log.md` ã‚’é–‹ã„ã¦ã€ã‚³ãƒ”ãƒ¼ã—ãŸå†…å®¹ã‚’è²¼ã‚Šä»˜ã‘

**âœ… ã“ã®æ™‚ç‚¹ã§é©ç”¨å‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†**

#### 2-3. å®Ÿè¡Œ2å›ç›®ï¼šãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨

1. **New Query** ã‚’ã‚¯ãƒªãƒƒã‚¯
2. `docs/production-migration-step2-apply.sql` ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒš
3. **å®Ÿè¡Œå‰ã«æœ€çµ‚ãƒã‚§ãƒƒã‚¯**:
   - âœ… UPDATEå¯¾è±¡ã®æ—¥ä»˜ãŒæ­£ã—ã„ã‹
   - âœ… WHEREå¥ãŒ `grade = 6 AND session_number = N` ã§é™å®šã•ã‚Œã¦ã„ã‚‹ã‹
   - âœ… 15æœ¬ã®UPDATEæ–‡ãŒã™ã¹ã¦å«ã¾ã‚Œã¦ã„ã‚‹ã‹
   - âœ… `docs/migration-log.md` ã«rollback_sqlã‚’ä¿å­˜æ¸ˆã¿ã‹
4. **Run** ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆ**ã“ã®æ™‚ç‚¹ã§ç¢ºå®š**ï¼‰
5. çµæœã‚’ç¢ºèªï¼š
   - å¯¾è±¡ä»¶æ•°ï¼ˆä¿®æ­£å‰ï¼‰: `15`
   - 15è¡Œã® `UPDATE 1` ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   - å¯¾è±¡ä»¶æ•°ï¼ˆä¿®æ­£å¾Œï¼‰: `15`
   - SELECTçµæœãŒæœŸå¾…é€šã‚Šã®æœŸé–“ã«ãªã£ã¦ã„ã‚‹
6. çµæœã‚’ `docs/migration-log.md` ã«è¿½è¨˜

**âœ… é©ç”¨å®Œäº†**

---

### **ã‚¹ãƒ†ãƒƒãƒ—3: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´åŒæœŸï¼ˆä»»æ„ï¼‰**

ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Ÿè¡Œ:

```bash
# æœ¬ç•ªç’°å¢ƒã«ãƒªãƒ³ã‚¯ï¼ˆæœªãƒªãƒ³ã‚¯ã®å ´åˆï¼‰
npx supabase link --project-ref <YOUR_PROJECT_REF>

# æ‰‹å‹•é©ç”¨ã—ãŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã€Œé©ç”¨æ¸ˆã¿ã€ã¨ã—ã¦è¨˜éŒ²
npx supabase migration repair --status applied 20251217000001 --linked

# ç¢ºèª
npx supabase migration list --linked
```

**å®Ÿè¡Œã§ããªã„å ´åˆ**: ã‚¹ã‚­ãƒƒãƒ—ã—ã¦OKï¼ˆ`docs/migration-log.md` ã®è¨˜éŒ²ãŒã‚ã‚Œã°ååˆ†ï¼‰

---

### **ã‚¹ãƒ†ãƒƒãƒ—4: å‹•ä½œç¢ºèª**

1. æœ¬ç•ªã‚µã‚¤ãƒˆï¼ˆhttps://yourdomain.comï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ç”Ÿå¾’ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
3. **ã‚¹ãƒ‘ãƒ¼ã‚¯ï¼ˆå­¦ç¿’è¨˜éŒ²å…¥åŠ›ï¼‰** ã‚’é–‹ã
4. å­¦ç¿’å›ã®ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
5. æœŸé–“è¡¨ç¤ºã‚’ç¢ºèª

**æœŸå¾…ã•ã‚Œã‚‹è¡¨ç¤º**:
```
ç¬¬1å› (8/25ã€œ9/7)
ç¬¬2å› (9/8ã€œ9/14)
ç¬¬3å› (9/15ã€œ9/21)
...
ç¬¬15å› (1/12ã€œ1/18)
```

6. ç¢ºèªçµæœã‚’ `docs/migration-log.md` ã«è¨˜éŒ²

---

## ğŸ”„ ä¸‡ãŒä¸€ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå¿…è¦ãªå ´åˆ

`docs/migration-log.md` ã«ä¿å­˜ã—ãŸrollback_sqlã‚’ä½¿ç”¨:

1. Supabase Dashboard SQL Editor ã§ New Query
2. ä»¥ä¸‹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«rollback_sqlã‚’ã‚³ãƒ”ãƒš:

```sql
BEGIN;
SET LOCAL statement_timeout = '10s';

-- docs/migration-log.md ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸrollback_sql
[ã“ã“ã«è²¼ã‚Šä»˜ã‘]

-- çµæœç¢ºèª
SELECT session_number, start_date, end_date
FROM public.study_sessions
WHERE grade = 6
ORDER BY session_number;

COMMIT;
```

3. çµæœã‚’ç¢ºèªã—ã¦ã‹ã‚‰Run

---

## ğŸ“ ä½œæˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | ç”¨é€” |
|---------|------|
| `docs/migration-log.md` | é©ç”¨å±¥æ­´è¨˜éŒ²ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ |
| `docs/production-migration-step1-check.sql` | å®Ÿè¡Œ1å›ç›®: ç¾çŠ¶ç¢ºèª |
| `docs/production-migration-step2-apply.sql` | å®Ÿè¡Œ2å›ç›®: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨ |
| `docs/DEPLOYMENT-GUIDE-grade6-sessions.md` | ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ‰‹é †æ›¸ï¼‰ |

---

## âœ… å®Œäº†ç¢ºèª

ã™ã¹ã¦å®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ï¼š

- [ ] ã‚³ãƒ¼ãƒ‰ãŒmainãƒ–ãƒ©ãƒ³ãƒã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸ
- [ ] æœ¬ç•ªDBã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©ç”¨ã•ã‚ŒãŸ
- [ ] `docs/migration-log.md` ã«è¨˜éŒ²ã‚’è¿½è¨˜ã—ãŸ
- [ ] æœ¬ç•ªã‚µã‚¤ãƒˆã§æœŸé–“è¡¨ç¤ºã‚’ç¢ºèªã—ãŸ
- [ ] ï¼ˆä»»æ„ï¼‰migration repairã§å±¥æ­´ã‚’åŒæœŸã—ãŸ

---

**ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼** ğŸ‰
