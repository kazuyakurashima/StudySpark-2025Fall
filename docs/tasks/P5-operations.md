# Phase 5: 監査・運用機能

**期間:** 2週間
**進捗:** 0% (0/13タスク完了)
**状態:** ⏳ 未着手

---

## 概要

システムログ・監視・データ削除ポリシーの実装

**成果物:**
- 監査ログ
- データ削除ポリシー
- 管理者機能
- エラー追跡強化

---

## タスク一覧

### P5-1: 監査ログ実装 ⏳ 未着手

- [ ] 監査トリガー実装
  - 対応要件: 監査要件
  - 検証: INSERT/UPDATE/DELETE時に `audit_logs` テーブルへ自動記録

- [ ] 監査ログ閲覧UI実装
  - 対応要件: 監査要件
  - 検証: 管理者画面で全ログ閲覧、フィルター機能

- [ ] 重要操作の監査強化
  - 対応要件: セキュリティ要件
  - 検証: パスワード変更、招待コード発行、ロール変更などを記録

---

### P5-2: データ削除ポリシー実装 ⏳ 未着手

- [ ] 週次分析の自動削除ロジック実装
  - 対応要件: データ保持ポリシー
  - 検証: 6週間以上前のデータを自動削除

- [ ] AIキャッシュの自動削除ロジック実装
  - 対応要件: データ保持ポリシー
  - 検証: 30日以上前のキャッシュを自動削除

- [ ] 学習ログの保持ポリシー実装
  - 対応要件: データ保持ポリシー
  - 検証: 卒業生データを2年後に匿名化または削除

- [ ] 削除バッチ処理実装
  - 対応要件: 運用要件
  - 検証: 毎週日曜0時に自動実行、削除件数ログ記録

---

### P5-3: 管理者機能実装 ⏳ 未着手

- [ ] `/app/admin/page.tsx` 実装
  - 対応要件: 管理者要件
  - 検証: 管理者ダッシュボード、システムサマリー表示

- [ ] 招待コード管理UI実装
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: 新規発行、有効化・無効化、使用履歴確認

- [ ] ユーザー管理UI実装
  - 対応要件: 管理者要件
  - 検証: 全ユーザー一覧、検索、ロール変更、アカウント無効化

- [ ] システム設定UI実装
  - 対応要件: 管理者要件
  - 検証: 環境変数管理、機能フラグ、メンテナンスモード

---

### P5-4: エラー追跡強化 ⏳ 未着手

- [ ] Sentry統合強化
  - 対応要件: 監視要件
  - 検証: ユーザーコンテキスト付与、カスタムタグ設定

- [ ] エラーアラート設定
  - 対応要件: 監視要件
  - 検証: 重大エラー時にSlack/メール通知

---

### P5-5: Phase 5 総合テスト ⏳ 未着手

- [ ] 監査ログE2Eテスト
  - 対応要件: 監査要件
  - 検証: 各種操作でログ記録、管理者画面で閲覧可能

- [ ] データ削除バッチテスト
  - 対応要件: データ保持ポリシー
  - 検証: 古いデータ削除、保持期間内データは残存

- [ ] 管理者機能E2Eテスト
  - 対応要件: 管理者要件
  - 検証: 招待コード発行 → 新規ユーザー登録 → 管理画面で確認

---

## DoD (Definition of Done)

Phase 5完了の条件:

- [ ] 全ての重要操作が監査ログに記録される
- [ ] データ削除ポリシーが自動実行される
- [ ] 管理者が招待コード・ユーザー・システム設定を管理できる
- [ ] Sentryで全エラーが追跡され、重大エラー時にアラートが発火する
- [ ] 削除バッチが正常動作し、不要データが定期削除される

---

## リスク要因

| リスク | 発生確率 | 影響度 | 対策 | 状態 |
|--------|---------|--------|------|------|
| 削除バッチの誤動作 | 低 | 高 | テスト徹底、削除前バックアップ | ⏳ 未対応 |
| 監査ログのパフォーマンス影響 | 中 | 低 | 非同期処理、インデックス最適化 | ⏳ 未対応 |

---

## 次のマイルストーン

**現在:** ⏳ Phase 4完了待ち
**次:** P5-1 監査ログ実装開始

---

**最終更新:** 2025年10月4日 15:50
**更新者:** Claude Code
