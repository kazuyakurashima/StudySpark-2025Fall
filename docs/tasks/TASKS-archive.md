# StudySpark タスク管理 (WBS)

このファイルは、StudySparkプロジェクトのすべてのタスクをチェックリスト形式で管理します。

---

## P0: 基盤整備 (2週間)

### P0-1: 環境構築

- [ ] `.env.example` 整備（鍵名・用途・ダミー値）
  - 対応要件: `02-Requirements-Auth.md` 全般
  - 検証: ファイル存在確認、必須項目の網羅性

- [ ] 開発用Supabaseプロジェクト作成
  - 対応要件: 全般
  - 検証: プロジェクトURL・Anon Key取得、接続確認

- [ ] Supabase Local (Docker) セットアップ
  - 対応要件: 全般
  - 検証: `supabase start` でローカル環境起動、Studio アクセス確認

- [ ] Sentry プロジェクト作成・SDK統合
  - 対応要件: 運用要件
  - 検証: テストエラー送信、Sentryダッシュボードで確認

### P0-2: Supabase クライアント実装

- [ ] `lib/supabase/server.ts` 作成 (Server Components用)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: Server Component内でクライアント生成、データ取得成功

- [ ] `lib/supabase/client.ts` 作成 (Client Components用)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: Client Component内でクライアント生成、リアルタイム購読成功

- [ ] `lib/supabase/middleware.ts` 作成 (Middleware用)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: トークンリフレッシュ動作、認証状態維持

- [ ] `lib/supabase/route.ts` 作成 (Route Handlers用)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: API RouteでCookie操作成功

- [ ] `middleware.ts` 実装 (ルートレベル認証チェック)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: 未認証時のリダイレクト動作確認

### P0-3: DBスキーマ設計・実装

- [ ] ER図作成 (`docs/db/Schema-Proposal.md`)
  - 対応要件: 全要件定義
  - 検証: 主要テーブル・リレーション明記

- [ ] `db/schema/01-auth.sql` 作成 (プロフィール・ロール)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: `profiles` テーブル作成、ロール列追加

- [ ] `db/schema/02-relations.sql` 作成 (親子・指導者関係)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: `parent_student_relations`, `coach_student_relations` テーブル作成

- [ ] `db/schema/03-master-data.sql` 作成 (学習回・科目・問題数)
  - 対応要件: `03-Requirements-Student.md` (スパーク機能)
  - 検証: `learning_sessions`, `subjects`, `content_items` テーブル作成

- [ ] `db/schema/04-logs.sql` 作成 (学習ログ・応援ログ)
  - 対応要件: `03-Requirements-Student.md`, `04-Requirements-Parent.md`
  - 検証: `study_logs`, `encouragement_logs` テーブル作成

- [ ] `db/schema/05-goals.sql` 作成 (目標・実績)
  - 対応要件: `03-Requirements-Student.md` (ゴールナビ)
  - 検証: `test_goals`, `test_results` テーブル作成

- [ ] `db/schema/06-coaching.sql` 作成 (コーチングログ)
  - 対応要件: `03-Requirements-Student.md` (リフレクト)
  - 検証: `coaching_sessions`, `coaching_messages` テーブル作成

- [ ] `db/schema/07-notifications.sql` 作成 (アプリ内通知)
  - 対応要件: 通知要件
  - 検証: `notifications` テーブル作成、RLS設定

- [ ] `db/schema/08-audit.sql` 作成 (監査ログ)
  - 対応要件: 監査要件
  - 検証: `audit_logs` テーブル作成、トリガー設定

### P0-4: RLS (Row Level Security) ポリシー実装

- [ ] `db/policies/profiles.sql` 作成
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: ロール別アクセス制御 (student/parent/coach/admin)

- [ ] `db/policies/relations.sql` 作成 (親子・指導者関係)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: 保護者は自分の子どものみ、指導者は担当生徒のみアクセス可

- [ ] `db/policies/study_logs.sql` 作成
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 生徒は自分のログのみ編集、保護者・指導者は閲覧のみ

- [ ] `db/policies/encouragement_logs.sql` 作成
  - 対応要件: `04-Requirements-Parent.md`
  - 検証: 保護者・指導者は自分の応援のみ編集、生徒は閲覧のみ

- [ ] `db/policies/goals_results.sql` 作成
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 生徒は自分の目標のみ編集、保護者・指導者は閲覧のみ

- [ ] `db/policies/coaching.sql` 作成
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 生徒は自分のコーチングログのみアクセス

- [ ] `db/policies/notifications.sql` 作成
  - 対応要件: 通知要件
  - 検証: ユーザーは自分宛の通知のみ閲覧・更新

### P0-5: マスターデータ投入

- [ ] `db/seed/learning_sessions.sql` 作成 (学習回データ)
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 小5: 19回、小6: 15回のデータ投入、期間確認

- [ ] `db/seed/subjects.sql` 作成 (科目データ)
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 算数・国語・理科・社会の4科目投入

- [ ] `db/seed/content_items.sql` 作成 (学習内容・問題数)
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 学年・コース別学習内容データ投入、問題数確認

- [ ] `db/seed/test_schedule.sql` 作成 (テスト日程)
  - 対応要件: `03-Requirements-Student.md` (ゴールナビ)
  - 検証: 組分けテスト・合不合判定テストの日程投入、表示期間確認

- [ ] Supabase Studio でデータ投入実行
  - 対応要件: 全般
  - 検証: 全テーブルにデータ存在確認、件数チェック

### P0-6: 認証フロー実装

- [ ] 生徒ログイン (ID/パスワード認証) 実装
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: ログインID自動生成、認証成功、ダッシュボード遷移

- [ ] 保護者ログイン (メール/パスワード認証) 実装
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: メール確認 (開発:無効、本番:必須)、認証成功

- [ ] 指導者ログイン (招待コード + メール/パスワード) 実装
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: 招待コード検証 (UUID)、認証成功

- [ ] 管理者ログイン (招待のみ) 実装
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: 内部発行の招待コードで認証成功

- [ ] 初期セットアップフロー実装 (アバター・プロフィール)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: 初回ログイン時にセットアップ画面表示、スキップ可能、再登録可能

- [ ] パスワードリセット実装 (保護者・指導者)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: メール送信、リセット成功

- [ ] 生徒パスワードリセット (保護者専用画面) 実装
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: 保護者画面 → 設定 → 子ども管理 → パスワード変更

### P0-7: テストユーザー作成

- [ ] 生徒アカウント作成 (各学年1名以上)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: 小5・小6各1名、ログインID自動生成確認

- [ ] 保護者アカウント作成 (子ども複数パターン含む)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: 子ども1名・複数名パターン、親子関係登録確認

- [ ] 指導者アカウント作成 (招待コード使用)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: 招待コード生成、招待リンク経由で登録成功

- [ ] 管理者アカウント作成 (内部発行)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: 管理者権限で全��ータアクセス可能

### P0-8: Phase 0 総合テスト

- [ ] 4ロール全ての認証フロー動作確認
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: ログイン・ログアウト・セットアップ完了

- [ ] RLSポリシー動作確認 (権限テスト)
  - 対応要件: セキュリティ要件
  - 検証: 不正アクセス時403エラー、正規アクセス成功

- [ ] 環境別動作確認 (本番・開発・ローカル)
  - 対応要件: 環境分離方針
  - 検証: 各環境でDB接続・認証成功

- [ ] Sentry エラーログ確認
  - 対応要件: 監視要件
  - 検証: 意図的エラー発生、Sentryで捕捉確認

---

## P1: 学習記録機能 (3週間)

### P1-1: スパーク機能 (学習記録入力) 実装

- [ ] 学習回・科目選択UI実装
  - 対応要件: `03-Requirements-Student.md` (スパーク)
  - 検証: 学年別学習回表示、4科目選択可能

- [ ] コース別学習内容表示ロジック実装
  - 対応要件: `03-Requirements-Student.md` (スパーク)
  - 検証: A/B/C・Sコース別に適切な範囲表示

- [ ] 正答数入力UI実装 (スライダー + 数値入力)
  - 対応要件: `03-Requirements-Student.md` (スパーク)
  - 検証: 問題数範囲内で入力、バリデーション動作

- [ ] 振り返り機能実装 (自由記述 or AI生成3択)
  - 対応要件: `03-Requirements-Student.md` (スパーク)
  - 検証: AI生成 (Celebrate/Insight/Next step系)、選択・編集可能

- [ ] 再入力時の差分表示実装
  - 対応要件: `03-Requirements-Student.md` (スパーク)
  - 検証: 1回目の入力内容を引き継ぎ表示、変化を明示

- [ ] Server Action: 学習ログ保存処理
  - 対応要件: `03-Requirements-Student.md` (スパーク)
  - 検証: DB保存成功、正答率自動計算

### P1-2: ダッシュボード実装 (生徒)

- [ ] 学習カレンダー (GitHub風ヒートマップ) 実装
  - 対応要件: `03-Requirements-Student.md` (ホーム)
  - 検証: 先月・当月表示、3段階色分け (2判定基準の統合)

- [ ] カレンダー色分けロジック実装
  - 対応要件: `03-Requirements-Student.md` (ホーム)
  - 検証: 判定基準1 (入力科目数) + 判定基準2 (正答率80%達成科目数)、濃色優先

- [ ] 今週の科目別進捗バー実装
  - 対応要件: `03-Requirements-Student.md` (ホーム)
  - 検証: 科目ごとの正答率表示、詳細展開可能

- [ ] 直近の学習履歴表示実装 (24-48時間)
  - 対応要件: `03-Requirements-Student.md` (ホーム)
  - 検証: 昨日0:00〜今日23:59のログ表示、降順

- [ ] 今日のミッション実装 (曜日別ローテーション)
  - 対応要件: `03-Requirements-Student.md` (ホーム)
  - 検証: 月火水木金土日で正しい教科・モード表示

- [ ] ミッション入力促進モード実装 (月・水・金)
  - 対応要件: `03-Requirements-Student.md` (ホーム)
  - 検証: 未入力強調、入力後は正答率表示

- [ ] ミッション復習促進モード実装 (火・木・土)
  - 対応要件: `03-Requirements-Student.md` (ホーム)
  - 検証: 正答率80%未満を強調、再入力後の正答率向上判定

- [ ] ミッション特別モード実装 (土曜12:00以降)
  - 対応要件: `03-Requirements-Student.md` (ホーム)
  - 検証: リフレクト促進、正答率80%未満科目表示

### P1-3: ダッシュボード実装 (保護者)

- [ ] 子ども切り替えタブ実装
  - 対応要件: `04-Requirements-Parent.md` (ホーム)
  - 検証: 複数子ども登録時のみ表示、切替で表示内容変更

- [ ] 今日の様子 (AIメッセージ) 実装
  - 対応要件: `04-Requirements-Parent.md` (ホーム)
  - 検証: 1日1回更新、直近3日間の学習ログ参照

- [ ] 学習カレンダー・進捗バー表示 (生徒と同一)
  - 対応要件: `04-Requirements-Parent.md` (ホーム)
  - 検証: 生徒画面と同一データ表示

- [ ] 今日のミッション (応援促進版) 実装
  - 対応要件: `04-Requirements-Parent.md` (ホーム)
  - 検証: 未完了はグレーアウト、完了後は応援ボタン表示

### P1-4: データ永続化・計算ロジック

- [ ] 正答率計算ロジック実装
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 正答数/問題数で計算、パーセンテージ表示

- [ ] カレンダー集計クエリ最適化
  - 対応要件: `03-Requirements-Student.md` (ホーム)
  - 検証: 2判定基準を1クエリで取得、パフォーマンス確認

- [ ] 週単位集計ロジック実装 (月曜開始、Asia/Tokyo)
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 週の境界判定、タイムゾーン正確性

### P1-5: Phase 1 総合テスト

- [ ] 生徒: 学習記録入力 → ダッシュボード反映確認
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 即座に反映、カレンダー・進捗バー更新

- [ ] 保護者: 子どもの学習状況閲覧確認
  - 対応要件: `04-Requirements-Parent.md`
  - 検証: 子ども切替、リアルタイム更新

- [ ] コース別表示動作確認 (A/B/C・S)
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 各コースで適切な範囲表示

- [ ] 今日のミッション全モード動作確認
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 曜日・時間帯で正しいモード表示

---

## P2: 応援機能 (2週間)

### P2-1: ChatGPT API統合基盤

- [ ] `lib/ai/openai-client.ts` 作成
  - 対応要件: AI要件
  - 検証: API Key設定、gpt-4o-mini接続確認

- [ ] エラーハンドリング実装 (レート制限・タイムアウト)
  - 対応要件: API利用制限
  - 検証: 30秒タイムアウト、エラー時のフォールバック

- [ ] キャッシュ機能実装 (1記録1回生成)
  - 対応要件: コスト最適化
  - 検証: 2回目以降はキャッシュから取得

### P2-2: 応援機能実装 (保護者)

- [ ] クイック応援実装 (スタンプ3種)
  - 対応要件: `04-Requirements-Parent.md` (応援)
  - 検証: ❤️⭐👍のスタンプ送信、固定メッセージ

- [ ] AI応援メッセージ生成実装
  - 対応要件: `04-Requirements-Parent.md` (応援)
  - 検証: 3パターン生成 (励まし/共感/次への期待)、編集可能

- [ ] カスタムメッセージ実装
  - 対応要件: `04-Requirements-Parent.md` (応援)
  - 検証: 最大200字、送信成功

- [ ] 応援一覧・フィルター実装
  - 対応要件: `04-Requirements-Parent.md` (応援)
  - 検証: 未応援/応援済み/全表示、科目・期間フィルター

### P2-3: 応援機能実装 (指導者)

- [ ] ホーム画面: 学習記録への応援実装
  - 対応要件: `05-Requirements-Coach.md` (ホーム)
  - 検証: 保護者と同様の3方式で応援送信

- [ ] 未入力生徒一覧実装
  - 対応要件: `05-Requirements-Coach.md` (ホーム)
  - 検証: 7日/5日/3日基準でフィルター、警告表示

- [ ] 対応ボタン・対応メモ実装
  - 対応要件: `05-Requirements-Coach.md` (ホーム)
  - 検証: トグル動作、メモ保存・追記機能

- [ ] 応援一覧タブ実装 (指導者/保護者別)
  - 対応要件: `05-Requirements-Coach.md` (応援一覧)
  - 検証: 10件ずつ表示、フィルター機能

### P2-4: 応援受信実装 (生徒)

- [ ] ダッシュボード: 直近の応援メッセージ表示
  - 対応要件: `03-Requirements-Student.md` (ホーム)
  - 検証: 前日から今日までの応援表示、全表示/一部表示切替

- [ ] アプリ内通知実装
  - 対応要件: 通知要件
  - 検証: 未読バッジ・カウンタ表示、既読処理

- [ ] 通知テーブル自動削除 (90日)
  - 対応要件: 通知要件
  - 検証: 90日経過後の自動削除動作確認

### P2-5: Phase 2 総合テスト

- [ ] 保護者・指導者: 応援メッセージ���信確認
  - 対応要件: `04-Requirements-Parent.md`, `05-Requirements-Coach.md`
  - 検証: 3方式全て送信成功、生徒に即座に反映

- [ ] 生徒: 応援受信・通知確認
  - 対応要件: `03-Requirements-Student.md`
  - 検証: ダッシュボード表示、未読カウンタ更新

- [ ] AI応援メッセージ品質確認
  - 対応要件: AI要件
  - 検証: 3パターン生成、内容適切性チェック

- [ ] ChatGPT APIコスト確認
  - 対応要件: API利用制限
  - 検証: 月額5ドル以内、レート制限未達

---

## P3: 目標管理・週次振り返り (4週間)

### P3-1: ゴールナビ実装 (目標設定)

- [ ] テスト日選択UI実装 (プルダウン)
  - 対応要件: `03-Requirements-Student.md` (ゴールナビ)
  - 検証: 学年別テスト一覧、表示期間内のみ選択可

- [ ] コース・組選択UI実装
  - 対応要件: `03-Requirements-Student.md` (ゴールナビ)
  - 検証: S/C/B/A選択、組1〜40スライダー入力

- [ ] AI対話: 「今回の思い」生成 (6ステップ)
  - 対応要件: `03-Requirements-Student.md` (ゴールナビ)
  - 検証: Step1〜6のフロー、途中終了可能、最大6往復

- [ ] 「今回の思い」編集・履歴管理
  - 対応要件: `03-Requirements-Student.md` (ゴールナビ)
  - 検証: 生徒のみ編集可、最大5件履歴保持

### P3-2: ゴールナビ実装 (結果入力)

- [ ] テスト結果入力UI実装
  - 対応要件: `03-Requirements-Student.md` (ゴールナビ)
  - 検証: コース・組入力、テストの振り返り (最大300字)

- [ ] 組分け一覧実装
  - 対応要件: `03-Requirements-Student.md` (ゴールナビ)
  - 検証: 目標 vs 実績対比、達成判定表示、新しい順ソート

### P3-3: リフレクト実装 (週次コーチング)

- [ ] 週タイプ判定ロジック実装
  - 対応要件: `03-Requirements-Student.md` (リフレクト)
  - 検証: 成長週/安定週/挑戦週/特別週の自動判定

- [ ] AI週次コーチングフロー実装 (GROW モデル)
  - 対応要件: `03-Requirements-Student.md` (リフレクト)
  - 検証: Phase 1〜3 (オープニング/深掘り/目標設定)、3〜6往復

- [ ] セルフコンパッション実装
  - 対応要件: `03-Requirements-Student.md` (リフレクト)
  - 検証: 否定的発言への適切な応答、小さな成功の発見

- [ ] 質問バリエーションプール実装
  - 対応要件: `03-Requirements-Student.md` (リフレクト)
  - 検証: 10種類以上のランダム質問、マンネリ防止

- [ ] 時間制限ロジック実装 (土曜12:00〜水曜23:59)
  - 対応要件: `03-Requirements-Student.md` (リフレクト)
  - 検証: 期間内のみ表示、Asia/Tokyo基準

### P3-4: リフレクト実装 (達成マップ・履歴)

- [ ] 達成マップ実装 (科目別ヒートマップ)
  - 対応要件: `03-Requirements-Student.md` (リフレクト)
  - 検証: 科目ごとタブ切替、正答率ベース色分け (0-50-80-100%)

- [ ] 学習履歴表示実装 (フィルター・ソート)
  - 対応要件: `03-Requirements-Student.md` (リフレクト)
  - 検証: 科目・期間フィルター、並び替え機能

- [ ] 応援履歴表示実装
  - 対応要件: `03-Requirements-Student.md` (リフレクト)
  - 検証: デフォルト一部表示、詳細展開可能

- [ ] コーチング履歴表示実装
  - 対応要件: `03-Requirements-Student.md` (リフレクト)
  - 検証: GROWサマリー表示、過去履歴閲覧

### P3-5: 保護者・指導者閲覧機能

- [ ] 保護者: ゴールナビ閲覧実装
  - 対応要件: `04-Requirements-Parent.md`
  - 検証: 子どもの目標・結果確認、コメント可能

- [ ] 保護者: リフレクト閲覧実装 (AIコーチング除く)
  - 対応要件: `04-Requirements-Parent.md`
  - 検証: 達成マップ・履歴閲覧

- [ ] 指導者: 生徒一覧実装
  - 対応要件: `05-Requirements-Coach.md`
  - 検証: 各生徒のホーム/ゴールナビ/達成マップ等閲覧

### P3-6: Phase 3 総合テスト

- [ ] 生徒: 目標設定 → AI対話 → 「今回の思い」生成確認
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 6ステップ完了、編集可能

- [ ] 生徒: 週次コーチング動作確認 (全週タイプ)
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 成長/安定/挑戦/特別週で適切な対話

- [ ] 達成マップ色分け確認
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 科目別・正答率ベースで正しい色

- [ ] 保護者・指導者: 閲覧機能確認
  - 対応要件: `04-Requirements-Parent.md`, `05-Requirements-Coach.md`
  - 検証: 生徒の目標・振り返り閲覧可能

- [ ] ChatGPT APIコスト確認 (週次コーチング)
  - 対応要件: API利用制限
  - 検証: 月額5ドル以内、生徒10名想定

---

## P4: 指導者分析機能 (3週間)

### P4-1: 週次AI分析実装

- [ ] Supabase Edge Function: 中間分析 (月曜0:00) 作成
  - 対応要件: `05-Requirements-Coach.md` (分析)
  - 検証: Cron Job設定、月曜0:00自動実行

- [ ] Supabase Edge Function: 最終分析 (木曜0:00) 作成
  - 対応要件: `05-Requirements-Coach.md` (分析)
  - 検証: Cron Job設定、木曜0:00自動実行

- [ ] 分析項目1: ゴールナビ分析実装
  - 対応要件: `05-Requirements-Coach.md` (分析)
  - 検証: 目標 vs 実績比較、ChatGPT分析レポート生成

- [ ] 分析項目2: 達成マップ分析実装
  - 対応要件: `05-Requirements-Coach.md` (分析)
  - 検証: 達成状況傾向分析

- [ ] 分析項目3: 学習履歴分析実装
  - 対応要件: `05-Requirements-Coach.md` (分析)
  - 検証: 学習時間・頻度・科目バランス分析

- [ ] 分析項目4: 応援履歴分析実装
  - 対応要件: `05-Requirements-Coach.md` (分析)
  - 検証: 応援効果・行動変容分析

- [ ] 分析項目5: コーチング履歴分析 (SMART度判定)
  - 対応要件: `05-Requirements-Coach.md` (分析)
  - 検証: Willの品質評価、達成率分析

### P4-2: 分析結果表示実装

- [ ] 分析サマリー表示実装
  - 対応要件: `05-Requirements-Coach.md` (分析)
  - 検証: 重要ポイント簡潔表示

- [ ] 分析詳細表示実装
  - 対応要件: `05-Requirements-Coach.md` (分析)
  - 検証: 深掘り分析結果・示唆表示

- [ ] 分析履歴閲覧実装
  - 対応要件: `05-Requirements-Coach.md` (分析)
  - 検証: 過去分析選択、時系列変化確認

- [ ] 共通分析軸フィルター実装
  - 対応要件: `05-Requirements-Coach.md` (分析)
  - 検証: 学年別/生徒別/科目別/前週比較

### P4-3: Phase 4 総合テスト

- [ ] 週次分析自動実行確認 (月曜・木曜)
  - 対応要件: `05-Requirements-Coach.md`
  - 検証: Edge Functions 実行ログ確認、分析結果保存

- [ ] 指導者: 5項目分析結果確認
  - 対応要件: `05-Requirements-Coach.md`
  - 検証: サマリー・詳細表示、適切な分析内容

- [ ] 分析履歴閲覧確認
  - 対応要件: `05-Requirements-Coach.md`
  - 検証: 過去4週分の履歴閲覧可能

- [ ] ChatGPT APIコスト確認 (分析機能)
  - 対応要件: API利用制限
  - 検証: 月額5ドル以内、生徒10名×5項目×週2回想定

---

## P5: 監査・運用機能 (2週間)

### P5-1: 監査ログ実装

- [ ] 認証操作ログ実装
  - 対応要件: 監査要件
  - 検証: ログイン・ログアウト・認証失敗記録

- [ ] データ変更ログ実装
  - 対応要件: 監査要件
  - 検証: 学習ログ・応援ログ・目標等の作成・更新・削除記録

- [ ] API実行ログ実装 (ChatGPT呼び出し)
  - 対応要件: 監査要件
  - 検証: API実行日時・ユーザー・パラメータ記録

- [ ] 監査ログ保持期間設定 (3年間)
  - 対応要件: 監査要件
  - 検証: 3年経過後の自動削除動作確認

### P5-2: データ削除ポリシー実装

- [ ] 卒業後1年削除ロジック実装
  - 対応要件: データ保持・削除方針
  - 検証: 卒業日+1年経過で学習ログ自動削除

- [ ] 退会時個人情報保持 (1年間) 実装
  - 対応要件: データ保持・削除方針
  - 検証: 退会日+1年経過で個人情報削除

- [ ] 通知データ90日削除実装 (既読のみ)
  - 対応要件: 通知要件
  - 検証: 90日経過の既読通知自動削除、未読は保持

- [ ] データ削除Edge Function作成
  - 対応要件: データ保持・削除方針
  - 検証: 日次実行、削除ログ記録

### P5-3: 管理者機能実装

- [ ] 招待コード生成機能実装 (admin/coach向け)
  - 対応要件: `02-Requirements-Auth.md`
  - 検証: UUID生成、有効期限設定、使用済み管理

- [ ] ユーザー管理機能実装 (無効化・削除)
  - 対応要件: 管理者要件
  - 検証: アカウント無効化、論理削除、完全削除

- [ ] マスターデータ更新機能実装
  - 対応要件: マスターデータ投入
  - 検証: テスト日程・学習回データの手動更新

### P5-4: エラー追跡・監視強化

- [ ] Sentry詳細設定
  - 対応要件: 監視要件
  - 検証: ソースマップアップロード、リリース追跡、ユーザーコンテキスト

- [ ] Vercel Analytics統合
  - 対応要件: 監視要件
  - 検証: Core Web Vitals測定、ページビュー記録

- [ ] パフォーマンス最適化
  - 対応要件: 運用要件
  - 検証: LCP < 2.5s、FID < 100ms、CLS < 0.1

### P5-5: Phase 5 総合テスト

- [ ] 監査ログ記録確認 (全操作)
  - 対応要件: 監査要件
  - 検証: 認証・データ変更・API実行ログ記録

- [ ] データ削除ポリシー動作確認
  - 対応要件: データ保持・削除方針
  - 検証: テストデータで自動削除実行

- [ ] 管理者機能動作確認
  - 対応要件: 管理者要件
  - 検証: 招待コード生成・ユーザー管理・マスターデータ更新

- [ ] Sentry・Vercel Analytics確認
  - 対応要件: 監視要件
  - 検証: エラー収集、パフォーマンス測定

---

## 本番リリース準備

### リリース前チェックリスト

- [ ] 全機能の動作確認 (本番環境)
- [ ] RLSポリシー最終確認 (権限テスト)
- [ ] パフォーマンステスト (10ユーザー同時アクセス)
- [ ] セキュリティ監査 (OWASP Top 10チェック)
- [ ] データバックアップ設定確認
- [ ] 本番環境変数設定確認 (メール確認必須化等)
- [ ] Sentry・Vercel Analytics本番設定
- [ ] ユーザーマニュアル作成 (簡易版)
- [ ] リリースノート作成

### リリース後タスク

- [ ] ユーザー招待開始 (生徒10名想定)
- [ ] 初週の運用監視 (エラー・パフォーマンス)
- [ ] ChatGPT APIコスト監視 (月額5ドル上限)
- [ ] ユーザーフィードバック収集
- [ ] 改善タスク優先順位付け

---

**各タスク完了時にチェックボックスを更新してください。**
