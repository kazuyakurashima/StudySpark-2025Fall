# Phase 1: 学習記録機能

**期間:** 3週間
**進捗:** 0% (0/26タスク完了)
**状態:** ⏳ 未着手

---

## 概要

生徒の学習記録とダッシュボード表示 (MVP核心機能)

**成果物:**
- スパーク機能 (学習記録入力)
- 生徒ダッシュボード
- 保護者ダッシュボード
- データ永続化・計算ロジック

---

## タスク一覧

### P1-1: スパーク機能実装 (学習記録入力) ⏳ 未着手

- [ ] `/app/student/spark/page.tsx` 実装
  - 対応要件: `03-Requirements-Student.md` - スパーク機能
  - 検証: 学年・コース別に学習内容表示、入力フォーム動作

- [ ] 学習回選択UI実装
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 小5: 19回、小6: 15回のドロップダウン表示

- [ ] 科目選択UI実装 (4科目タブ)
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 算数・国語・理科・社会のタブ切り替え

- [ ] 学習内容チェックボックス実装
  - 対応要件: `03-Requirements-Student.md`
  - 検証: コース別学習内容表示、正答数入力

- [ ] 学習記録保存機能 (Server Action)
  - 対応要件: `03-Requirements-Student.md`
  - 検証: `study_logs` テーブルへ保存成功、楽観的ロック動作

---

### P1-2: 生徒ダッシュボード実装 ⏳ 未着手

- [ ] AIコーチメッセージ表示（テンプレート版）
  - 対応要件: `03-Requirements-Student.md` - ダッシュボード
  - 検証: 時間帯別テンプレートメッセージ表示（朝/昼/夕）
  - 実装方針: **静的テンプレートメッセージのみ実装（ChatGPT API 不使用）**
  - テンプレート例:
    - 朝（0:00-11:59）: "おはよう！今日も一緒に頑張ろう✨"
    - 昼（12:00-17:59）: "おかえり！今日も学習を続けよう！"
    - 夕（18:00-23:59）: "今日もお疲れさま！明日も一緒に頑張ろう！"
  - Phase 3 移行計画: Phase 3 完了後、GROW/Will データを参照する AI 生成メッセージに差し替え（BACKLOG に移行タスク追加）

- [ ] ヘッダーあいさつ・連続学習日数表示
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 初回/24時間以内/24時間以上の条件分岐、連続日数カウンタ

- [ ] 今日のミッション詳細実装
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 曜日別科目ローテーション (月火: A, 水木: B, 金土: C, 日: 振り返り)

- [ ] 今日のミッション完了判定ロジック実装
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 入力促進/復習促進モード切替、正答率80%閾値、未入力強調、完了バナー表示

- [ ] 今日のミッション特別モード (土曜12時以降)
  - 対応要件: `03-Requirements-Student.md`
  - 検証: リフレクト促進カード、低正答率科目表示、スパーク遷移導線

- [ ] 学習カレンダー実装 (GitHub風)
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 過去6週間表示、色の濃淡3段階、入力数または正答率反映

- [ ] 学習カレンダー操作機能
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 月移動ボタン、判定基準優先度 (入力数 vs 正答率)、凡例表示

- [ ] 今週の科目別進捗バー表示
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 4科目別に習得率 (0-50%薄、50-80%中、80-100%濃)

- [ ] 直近の応援メッセージ表示
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 最新3件表示、保護者・指導者別アイコン

- [ ] 直近の学習履歴表示
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 最新5件表示、日時・科目・正答率

- [ ] 応援・学習履歴詳細表示制御
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 「全表示/一部表示」トグル、カード毎の詳細開閉、非表示項目の遅延表示

---

### P1-3: 保護者ダッシュボード実装 ⏳ 未着手

- [ ] `/app/parent/page.tsx` 実装
  - 対応要件: `04-Requirements-Parent.md` - ダッシュボード
  - 検証: 子ども選択UI、学習状況サマリー表示

- [ ] 子ども選択ドロップダウン実装
  - 対応要件: `04-Requirements-Parent.md`
  - 検証: 複数子どもの場合に切り替え可能、データ更新

- [ ] 今日の様子カード実装（テンプレート版）
  - 対応要件: `04-Requirements-Parent.md`
  - 検証: 静的テンプレートメッセージ表示、子ども別表示
  - 実装方針: **静的テンプレートメッセージのみ実装（ChatGPT API 不使用）**
  - テンプレート例:
    - "今日も〇〇さん（子どものニックネーム）は頑張っています！"
    - "〇〇さんの学習を応援しましょう！"
  - Phase 3 移行計画: Phase 3 完了後、直近3日の学習ログ + GROW/Will データを参照する AI 生成メッセージに差し替え

- [ ] 保護者版 今日のミッション制御
  - 対応要件: `04-Requirements-Parent.md`
  - 検証: 未完了グレーアウト、完了後の応援ボタン解放、詳細ボタン表示

- [ ] 2列レイアウトとカード配置調整
  - 対応要件: `04-Requirements-Parent.md`
  - 検証: タブレット2列/スマホ1列切替、子どもタブ表示条件、学習カレンダー等の共通仕様反映

---

### P1-4: データロジック実装 ⏳ 未着手

- [ ] 正答率計算ロジック実装
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 正答数 / 問題数、80%を習得基準

- [ ] 週次集計ロジック実装
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 月曜開始・日曜終了、科目別正答率・入力数集計

- [ ] タイムゾーン・境界値共通処理
  - 対応要件: `03-Requirements-Student.md`
  - 検証: Asia/Tokyo基準の週判定、80%/50%の閾値処理、学習日選択の扱い

---

### P1-5: Phase 1 総合テスト ⏳ 未着手

- [ ] スパーク機能E2Eテスト
  - 対応要件: `03-Requirements-Student.md`
  - 検証: 記録入力 → DB保存 → ダッシュボード反映

- [ ] ダッシュボード表示テスト
  - 対応要件: `03-Requirements-Student.md`, `04-Requirements-Parent.md`
  - 検証: 生徒・保護者両方で正しくデータ表示
  - 備考: 曜日別ミッションモード/土曜特別モード/詳細表示トグルの分岐パターンを網羅

---

## DoD (Definition of Done)

Phase 1完了の条件:

- [ ] 生徒が学習記録を入力し、DBに保存できる
- [ ] 生徒ダッシュボードで学習状況を可視化できる
- [ ] 保護者ダッシュボードで子どもの学習状況を確認できる
- [ ] カレンダー・進捗バーが正しく計算・表示される
- [ ] RLSで生徒は自分のログのみ編集、保護者は子どものログを閲覧可能

---

## リスク要因

| リスク | 発生確率 | 影響度 | 対策 | 状態 |
|--------|---------|--------|------|------|
| 正答率計算ロジックの複雑性 | 中 | 中 | 段階的実装・単体テスト | ⏳ 未対応 |
| カレンダーUIのパフォーマンス | 低 | 低 | React.memo使用 | ⏳ 未対応 |

---

## 次のマイルストーン

**現在:** ⏳ Phase 0完了待ち
**次:** P1-1 スパーク機能実装開始

---

**最終更新:** 2025年10月6日 10:30
**更新者:** Claude Code / Codex
