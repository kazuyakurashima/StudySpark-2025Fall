# T-004: 学生の学習記録機能

**Based on:** US-001 学生の学習記録  
**Priority:** Must Have  
**User Story:** 学生が日々の学習内容を記録し、自分の学習進捗を確認できる  
**Assignee:** -  
**Status:** Planning

## 概要

学生が科目別に学習記録を入力し、理解度を5段階評価で記録できる機能を実装する。

## 要件

### AC基準
- **AC-001:** WHEN 学生が学習記録を入力 THEN 科目別に保存される
- **AC-002:** WHEN 理解度を選択 THEN 5段階評価で記録される
- **AC-003:** WHEN 学習記録保存 THEN 連続学習日数が自動更新される
- **AC-004:** WHEN 学習履歴表示 THEN カレンダー形式で視覚化

### 機能詳細
- 科目: 算数、国語、理科、社会
- 授業タイプ: 授業、宿題
- 理解度: 😥むずかしかった → 😄バッチリ理解 (5段階)
- 備考フィールド（任意）

## 技術仕様

### API Endpoints
- `POST /api/learning-records` - 学習記録作成
- `GET /api/learning-records` - 学習記録一覧取得
- `PUT /api/learning-records/:id` - 学習記録更新
- `DELETE /api/learning-records/:id` - 学習記録削除

### Database Tables
- `learning_records` - 学習記録メイン
- `learning_streaks` - 連続学習日数管理

### UI Routes
- `/student/spark` - 学習記録入力・一覧画面
- `/student` - ダッシュボード（学習履歴カレンダー）

## ToDo

### バックエンド実装
- [x] learning_recordsテーブル設計・作成
- [x] learning_streaksテーブル設計・作成
- [x] 連続学習日数更新トリガー
- [ ] 学習記録CRUD API実装
- [ ] バリデーションロジック
- [ ] RLSポリシー詳細化

### フロントエンド実装
- [ ] 学習記録入力フォーム
  - [ ] 科目選択UI
  - [ ] 授業タイプ選択
  - [ ] 理解度5段階評価UI
  - [ ] 備考入力欄
  - [ ] 日付選択（デフォルト今日）
- [ ] 学習記録一覧表示
  - [ ] 科目別フィルター
  - [ ] 理解度別フィルター
  - [ ] 期間指定検索
- [ ] 学習履歴カレンダー
  - [ ] 月間表示
  - [ ] 学習強度の視覚化
  - [ ] ツールチップ詳細表示

### データ管理
- [ ] ローカルストレージからのマイグレーション
- [ ] 学習記録の一括インポート機能
- [ ] データエクスポート機能

## 受入テスト

### テストケース
1. **学習記録入力テスト**
   - [ ] 全項目正常入力で保存成功
   - [ ] 必須項目未入力でエラー表示
   - [ ] 理解度レベルの正確な記録
   - [ ] 同一日の複数科目記録

2. **学習記録表示テスト**
   - [ ] 科目別での絞り込み表示
   - [ ] 理解度での絞り込み表示
   - [ ] カレンダー表示の正確性
   - [ ] 学習強度の視覚化

3. **連続学習日数テスト**
   - [ ] 初回記録で1日に設定
   - [ ] 連続記録で日数増加
   - [ ] 日を空けると1日にリセット
   - [ ] 最長記録の正確な保持

## 定義完了（DoD）

- [ ] 全受入テスト通過
- [ ] パフォーマンステスト（レコード表示 < 1秒）
- [ ] モバイル対応確認
- [ ] アクセシビリティ対応
- [ ] 単体テスト作成
- [ ] E2Eテスト作成

## UI/UX考慮事項

- 入力の簡易性を重視（少ないタップ数）
- 理解度は絵文字で直感的に
- カレンダーは GitHub contribution graph風
- 学習頻度に応じた色分け

## 関連チケット

- T-003: 認証システム実装（依存）
- T-008: 学習進捗ダッシュボード
- T-012: AIコーチメッセージ機能
- T-005: 保護者進捗確認機能

## 備考

- 現在のモックデータ構造を参考にAPI設計
- 学習記録は当日分のみ編集可能とする
- 過去30日分の履歴をカレンダー表示