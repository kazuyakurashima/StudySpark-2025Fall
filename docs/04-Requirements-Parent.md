## 画面構成

### 基本レイアウト

| 要素         | 内容    | 仕様                   |
| ---------- | ----- | -------------------- |
| **上部タブ**   | 子ども選択 | 複数の子どもがいる場合は、タブで切り替え |
| **フッターナビ** | 画面遷移  | ホーム/ゴールナビ/応援/リフレクト   |

# ナビゲーション構成

ボトムナビゲーションとする。

| タブ    | 機能      |
| ----- | ------- |
| ホーム   | ダッシュボード |
| ゴールナビ | 目標管理    |
| 応援    | 応援      |
| リフレクト | 振り返り    |

## 主要機能詳細

# ホーム機能

### 表示要素

| セクション          | 内容                 | タブレット・PCなど表示（２列表示） | スマホなどの表示（１列表示） |
| -------------- | ------------------ | ------------------ | -------------- |
| **ヘッダー**       | ニックネーム・アバター・累積学習日数 | ヘッダー               | ヘッダー           |
| 子ども切り替えタブ      | 子どもの選択（複数いた場合）     | ヘッダー               | ヘッダー           |
| 今日の様子          | 子どもの様子を表示          | 左1番上表示             | １番目に表示         |
| 今日のミッション！      | 科目ごとの優先事項を表示       | 左2番目表示             | 2番目に表示         |
| 学習カレンダー        | 先月・当月の学習記録表示       | 右1番上表示             | 3番目に表示         |
| 今週の科目別進捗バー     | 科目ごとの進捗表示          | 右2番目表示             | 4番目に表示         |
| **直近の応援メッセージ** | 保護者・指導者からの応援       | 左3番目に表示            | 5番目に表示         |
| 直近の学習履歴        | 24-48時間分の学習記録      | 左の4番目に表示           | 6番目に表示         |

子ども切り替えタブは、保護者１人に対して、複数の子どもが適用されているときだけ表示させる

２列表示の場合は、左がメインで表示面積が２、右がサブで表示面積が１とする

生徒画面を原則流用する。ただし、生徒画面との違いは、次の３点

* 保護者画面には子ども切り替えタブがあること
* 生徒画面のAIコーチからのメッセージが、保護者画面では今日の様子になっていること
* 今日のミッションの内容が、保護者画面では下記の要件定義に従っていること

## ヘッダー

* アバターとあいさつ（はじめまして〇〇さん/おかえりなさい〇〇さん/お久しぶり〇〇さん）
* 〇〇にはニックネーム表示
* 連続学習日数表示をヘッダー内の右に表示

## 今日の様子

### 目的

* 毎日ホーム到達時に**1メッセージ**で子どもの様子、変化を気づかせる（応援する動線）。

---

### 表示・配置

* 表示：AIコーチのアバター表示。AIコーチが保護者に告知するイメージ。今日〇〇さん（〇〇は子どものニックネーム）
* **場所**：ホーム最上段の「今日の〇〇さん」カード内。
* 内容：

  * 称賛、やれたところ、学習が進捗したところを記載してください。保護者が子どもを褒める
* 更新頻度：１日1回API利用で表示を更新する。その日の2回目以降は同一メッセージを表示する。

---

### 参照データと優先順位

* **参照データ**

  * 直近3日間の学習ログ（科目・内容・正答率）
  * 直近のコーチング履歴のGROWログ（特に**Will／Goal**）

---

### キャッシュとパフォーマンス最適化（実装済み）

* **キャッシュ戦略**：
  * AIメッセージはlocalStorageにキャッシュされ、以下の条件を全て満たす場合はキャッシュを使用（API呼び出しなし）
    * 同じ子ども（studentId）
    * 同じ日付（today）
    * 同じログ数（新しい学習記録が追加されていない）
  * キャッシュが無効になる条件：
    * 別の子どもを選択した時
    * 日付が変わった時（翌日）
    * 子どもが新しい学習記録を追加した時
* **実装ファイル**：
  * `app/actions/parent-dashboard.ts`: `getTodayLogCount()` - ログ数取得関数
  * `app/actions/parent-dashboard.ts`: `getTodayStatusMessageAI()` - AIメッセージ生成関数
  * `app/parent/page.tsx`: キャッシュロジックとlocalStorage連携
* **コスト削減効果**：API呼び出しを約80-90%削減（ページリロード時にキャッシュを使用）

# 今日のミッション！

前提: タイムゾーン **Asia/Tokyo**、週は **月曜開始〜日曜終了**。

---

## 目的

* 生徒がその日やるべきことが3**枚のパネル**で即把握し、**1タップ導線**で即応援。
* 保護者の安心を生み出す。即座の応援を促進する。ただし、やっていないことを催促しない設計にする。

## 表示

* 原則、生徒画面と連動し、同様の表示を行う。相違点は下記のとおり。
* 入力が終わってないところは、未完了、ボタンで統一表示。グレーアウトして押せない設計
* 入力が完了したところだけ、応援のボタンを表示する。
* 今日のミッション！の各パネルの入力が終わったら、パネルごとに次のように表示させる。これは、全てのモードで共通。

  * 生徒画面では、科目ごとに“今すぐ記録する”のボタンを配置するが、保護者画面では”未完了”とグレーアウトの表示にする。ボタンもクリックできない仕様。
  * 生徒が入力後は、そのパネルが完了したことをわかる表示にした上で、”応援のボタン”と、”AI応援ボタン”、”詳細を見る”を表示。

    * 応援ボタンは”頑張ったね！”という一言と、アイコンを表示させる
    * AI応援ボタンは、クリックした場合は、API経由でChatGPTが生成した、生徒が入力した学習内容に即した応援コメントを３つをボタン表示させる。**生成されたメッセージは選択後に編集可能**とする。編集後または選択したボタンが押されたら、生徒にそのメッセージが届く仕様。一度生成されたメッセージは記録しておき、2回目以降は記録されたメッセージを表示するようにする。
    * 詳細を見るボタンをクリックすると、生徒が入力した学習内容を表示するようにする。表示内容は下記の通り。

      ### 表示項目

      | 項目      | 内容                      |
      | ------- | ----------------------- |
      | 生徒記録日時  | 生徒がスパーク機能で登録した日時        |
      | 学習回     | スパーク機能で登録した内容           |
      | 科目      | 算数/国語/理科/社会             |
      | 学習内容    | スパーク機能で登録した内容           |
      | 正答率     | スパーク機能で入力した正答率から算出した正答率 |
      | 今日の振り返り | 記入があった場合                |
      | 変化      | 2回以上の記録であればその変化         |
  * 保護者の応援入力が終わったら、応援完了！の表示に切り替える。

### 教科割

| ブロック  | 対象曜日 | 教科           |
| ----- | ---- | ------------ |
| ブロックA | 月・火  | 算数 / 国語 / 社会 |
| ブロックB | 水・木  | 算数 / 国語 / 理科 |
| ブロックC | 金・土  | 算数 / 理科 / 社会 |

各ブロックは **3教科 = 3パネル** を表示。

### 行動モード（教科割 × 行動モード）**月から金**

* 以下、生徒の要件定義と同一（表示も下記に従う）
- パネル全体の右上に、入力状況を表示。例：2/3 入力完了、など
- 教科割にそって、曜日ごとに表示科目を変える
- 該当科目の記録されたらその科目は入力完了とする
- 正答率が 80%以上に到達している科目は未入力でも入力完了とする
- 科目ごとの 3 パネルで右上に状況を表示
  - 未入力の場合は、"未入力"と表示（未入力は赤）
  - 入力後は、その週のその科目の正答率を表示"進捗率 ⚪︎%"
  - 進捗率が 50%未満はオレンジ、50-80%未満は黄色、80%以上は青で表示
- 保護者画面では、生徒が入力していない科目は"未完了"ボタン（グレーアウト、押せない）を表示
- 生徒が入力した科目には、応援ボタン（クイック応援、AI応援、詳細を見る）を表示

* **特別モード**：土曜日12時以降

  * 今日のミッション！の表示のまま内容は以下の通りとする。
  * **リフレクト（週間振り返り）**の促すカード

    * 入力がされていない場合、生徒は**振り返る**というボタン表示だが、保護者画面では”未完了”のボタンにしてグレーアウトする。
    * 入力完了後、”詳細を見る”というボタンを表示。クリックするとリフレクトのコーチング履歴を表示するようにする。
  * その週の正答率が低い２つをカードに表示する（ただし、正答率が80%未満のものだけとする）。

## **学習カレンダー**

完全に生徒画面と同一とする。よって、詳細は生徒画面の要件定義を参照のこと。

## 今週の科目別進捗バー

完全に生徒画面と同一とする。よって、詳細は生徒画面の要件定義を参照のこと。

## 直近の応援履歴（前日から今日まで）

完全に生徒画面と同一とする。よって、詳細は生徒画面の要件定義を参照のこと。

## 直近の学習履歴（前日から今日まで）

完全に生徒画面と同一とする。よって、詳細は生徒画面の要件定義を参照のこと。

# ゴールナビ機能

子ども切り替えタブ以外は、生徒画面と同一とする。よって、詳細は生徒画面の要件定義を参照のこと。

# 応援機能

子ども切り替えタブ以外は、以下の要件定義に従う。

生徒画面では、スパーク機能になっているものが、保護者画面では応援機能として、下記の要件定義の通り。

## 表示内容

| 項目      | 内容                           | デフォルトの表示 |
| ------- | ---------------------------- | -------- |
| 生徒記録日時  | 生徒がスパーク機能で登録した日時             | 表示       |
| 学習回     | スパーク機能で登録した内容                | 表示       |
| 科目      | 算数/国語/理科/社会                  | 表示       |
| 学習内容    | スパーク機能で登録した内容                | 非表示      |
| 正答率     | スパーク機能で入力した正答率から算出した正答率      | 非表示      |
| 今日の振り返り | 記入があった場合                     | 非表示      |
| 変化      | 2回以上の記録であればその変化              | 非表示      |
| クイック応援  | ３つのアイコンからひとつ選び応援をする          | 表示       |
| AI応援    | このボタンを押すとAIがおすすめの３つのメッセージを表示 | 非表示      |
| カスタム応援  | このボタンを押すとカスタムメッセージが送れる       | 非表示      |

カードごとに、”クリックして詳細を表示””クリックして詳細を閉じる”をカード下に表示してこれによっても、デフォルトの表示が制御できるとする。

* 学習回、科目、学習内容の例（一部）は下記のとおり。全データは、スパーク機能に記載あり

  |     |             | 算数 | 算数   | 算数   | 算数          | 国語   | 理科          | 理科          | 理科          | 社会          | 社会               |
  | --- | ----------- | -- | ---- | ---- | ----------- | ---- | ----------- | ----------- | ----------- | ----------- | ---------------- |
  | 学習回 | 表示期間        | 類題 | 基本問題 | 練習問題 | 演習問題集（実戦演習） | 確認問題 | 演習問題集（基本問題） | 演習問題集（練習問題） | 演習問題集（発展問題） | 演習問題集（練習問題） | 演習問題集（発展問題・記述問題） |
  | 第1回 | **9/1〜9/7** | 7  | 22   | 12   | 10          | 40   | 17          | 19          | 5           | 13          | 11               |

### フィルター・ソート機能

| 機能      | 選択肢             | デフォルト    |
| ------- | --------------- | -------- |
| 応援の有無   | 未応援/応援済み/全表示    | 未応援      |
| 科目フィルター | 全科目/算数/国語/理科/社会 | 全科目      |
| 期間フィルター | 1週間/1ヶ月/全て      | 1ヶ月      |
| 並び替え    | 記録日時/学習回/正答率    | 記録日時（降順） |

なお、期間フィルターの１ヶ月の間に、記録が５件未満のときには全ての期間表示とする

## 応援方法（3種類）

### A. クイック応援（1タップ・1秒）

| ボタン     | アイコン | メッセージ    |
| ------- | ---- | -------- |
| がんばったね  | ❤️   | 固定テキスト送信 |
| すごい！    | ⭐    | 固定テキスト送信 |
| よくできました | 👍   | 固定テキスト送信 |

### B. AI応援メッセージ（3秒選択）

AI応援ボタンを押すと、ChatGPTで生成したメッセージが３つ表示される。なお、生成されたメッセージをワンタップで送信することもできるし、**メッセージを編集して送信することもできる**とする（編集可能）。

```yaml
生成ロジック:
  入力データ:
    - スパーク機能での入力内容

  出力パターン（3種類）:
    1. 励まし型: 努力への承認
    2. 共感型: 感情への寄り添い
    3. 次への期待型: 前向きな展望
    保護者としての応援コメントとする

コスト最適化:
  - 1記録につき1回のみ生成
  - 生成済みはキャッシュから表示
```

### C. カスタムメッセージ（30秒入力）

| 仕様  | 内容      |
| --- | ------- |
| 文字数 | 最大200文字 |

# リフレクト機能

子ども切り替えタブ以外は、以下の要件定義に従う。

生徒のリフレクト機能から、AIコーチングを機能を除いたものとする。

つまり、**土曜日12:00から水曜日23:59**に表示されるAIコーチング以外は、生徒画面と同一とする。よって、詳細は生徒画面の要件定義を参照のこと。

**注記**：AIコーチング機能の利用可能時間は生徒画面と同一（毎週土曜12:00〜水曜23:59）。
