# マイグレーション適用履歴

本番環境へのデータベースマイグレーション適用記録

---

## 2025-12-17: 小学6年生の学習回期間修正

### 基本情報
- **マイグレーションファイル**: `supabase/migrations/20251217000001_fix_grade6_study_sessions_periods.sql`
- **マイグレーションID**: `20251217000001`
- **適用日時**: 2025-12-17 [HH:MM] JST
- **適用方法**: Supabase Dashboard SQL Editor（手動実行）
- **適用者**: [担当者名]
- **影響範囲**: `study_sessions` テーブル（grade=6の15レコード）
- **変更内容**: 小学6年生の学習回の期間を要件ドキュメント（docs/03-Requirements-Student.md）通りに修正

---

### 修正前の状態（ロールバック用）

**実行日時**: 2025-12-17 [HH:MM] JST
**対象件数**: [SELECT count(*) の結果を記入]

```sql
-- ============================================================================
-- ロールバック用UPDATE（修正前の期間に戻す）
-- ============================================================================
-- 以下のSQLは、Supabase Dashboard「実行1回目」のrollback_sql結果をコピペしてください

[ここに rollback_sql カラムの結果を貼り付け]

-- 例:
-- UPDATE public.study_sessions SET start_date = '2025-08-25', end_date = '2025-08-31' WHERE grade = 6 AND session_number = 1;
-- UPDATE public.study_sessions SET start_date = '2025-09-01', end_date = '2025-09-07' WHERE grade = 6 AND session_number = 2;
-- ...
```

---

### 適用結果

**ステータス**: [✅ 成功 / ❌ 失敗 / ⏸️ ロールバック実施]

**実行ログ**:
- 対象件数（修正前）: [記入]
- UPDATE実行件数: [15件のはず]
- 対象件数（修正後）: [15件のはず]

**検証結果**:
```
[実行2回目のSELECT結果をコピペ]

期待される結果:
第1回: 2025-08-25〜2025-09-07
第2回: 2025-09-08〜2025-09-14
...
第15回: 2026-01-12〜2026-01-18
```

---

### マイグレーション履歴同期

**supabase migration repair 実行**: [✅ 完了 / ⏸️ 保留 / ❌ スキップ]

```bash
# 実行したコマンド（実行した場合のみ）
npx supabase migration repair --status applied 20251217000001 --linked

# 確認
npx supabase migration list --linked
```

---

### 動作確認

**本番サイト確認日時**: 2025-12-17 [HH:MM] JST

**確認内容**:
- ✅ 生徒ログイン → スパーク（学習記録入力）→ 学習回プルダウン
- ✅ 期間表示が要件ドキュメント通りになっている

**確認者**: [担当者名]

---

### 備考

[その他の注意事項や特記事項があれば記入]

---
