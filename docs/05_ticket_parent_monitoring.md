# T-005: 保護者の進捗確認機能

**Based on:** US-002 保護者の進捗確認  
**Priority:** Must Have  
**User Story:** 保護者が子供の学習状況を確認し、適切なサポートを提供できる  
**Assignee:** -  
**Status:** Planning

## 概要

保護者が子供の学習進捗を確認し、応援メッセージを送信できる機能を実装する。

## 要件

### AC基準
- **AC-003:** WHEN 保護者がログイン THEN 子供の週間サマリーが表示される
- **AC-004:** WHEN 応援メッセージ送信 THEN 学生画面に表示される
- **AC-005:** WHEN 学習履歴確認 THEN 子供のカレンダーが閲覧可能
- **AC-006:** WHEN 目標確認 THEN 子供の設定目標が表示される

### 機能詳細
- 子供の学習記録閲覧（読み取り専用）
- 週間・月間サマリー表示
- 応援メッセージ送信
- 目標達成状況確認
- 学習連続日数確認

## 技術仕様

### API Endpoints
- `GET /api/children/progress` - 子供の進捗情報取得
- `POST /api/messages` - 応援メッセージ送信
- `GET /api/children/learning-records` - 子供の学習記録取得
- `GET /api/children/goals` - 子供の目標一覧取得

### Database Tables
- `profiles` - 親子関係管理
- `learning_records` - 子供の学習記録（閲覧）
- `messages` - 応援メッセージ
- `goals` - 子供の目標（閲覧）

### UI Routes
- `/parent` - 保護者ダッシュボード
- `/parent/spark` - 子供の学習状況詳細
- `/parent/reflect` - 応援メッセージ送信
- `/parent/goal` - 子供の目標確認

## ToDo

### バックエンド実装
- [x] 親子関係のDB設計
- [x] messagesテーブル作成
- [x] 保護者用RLSポリシー
- [ ] 子供の進捗取得API
- [ ] 応援メッセージ送信API
- [ ] 週間/月間サマリー計算ロジック
- [ ] 通知機能（メッセージ送信時）

### フロントエンド実装
- [ ] 保護者ダッシュボード
  - [ ] 子供選択機能（複数子供対応）
  - [ ] 週間サマリーカード
  - [ ] 学習連続日数表示
  - [ ] 最新の学習状況
- [ ] 学習状況詳細画面
  - [ ] 子供の学習履歴カレンダー（読み取り専用）
  - [ ] 科目別進捗グラフ
  - [ ] 理解度推移チャート
- [ ] 応援メッセージ機能
  - [ ] メッセージ作成フォーム
  - [ ] 定型文テンプレート
  - [ ] 送信履歴表示
- [ ] 目標確認画面
  - [ ] 子供の設定目標表示
  - [ ] 達成状況の視覚化
  - [ ] テスト結果予測

### 親子関係管理
- [ ] 親子関係登録機能
- [ ] 招待コード/リンク機能
- [ ] 複数子供への対応
- [ ] 子供の承認機能

## 受入テスト

### テストケース
1. **進捗確認テスト**
   - [ ] 子供の週間サマリー正確表示
   - [ ] 学習履歴の正確な表示
   - [ ] 複数子供の切り替え
   - [ ] データの適切な権限制御

2. **応援メッセージテスト**
   - [ ] メッセージ送信成功
   - [ ] 学生側での受信確認
   - [ ] 長文メッセージの処理
   - [ ] 絵文字・特殊文字対応

3. **セキュリティテスト**
   - [ ] 他人の子供データにアクセス不可
   - [ ] RLSポリシーの適切な動作
   - [ ] データ改ざん不可の確認

## 定義完了（DoD）

- [ ] 全受入テスト通過
- [ ] セキュリティレビュー完了
- [ ] パフォーマンステスト（ダッシュボード読み込み < 2秒）
- [ ] モバイル対応確認
- [ ] プライバシー要件確認
- [ ] 単体テスト作成

## UI/UX考慮事項

- 分かりやすい進捗表示（グラフ・チャート活用）
- 応援メッセージの簡単送信
- 子供のプライバシーに配慮した設計
- 複数子供への対応（タブ切り替え）

## プライバシー考慮

- 子供の詳細な学習内容は必要最小限の表示
- メッセージ内容の適切性チェック
- 子供の承認なしでの情報閲覧範囲の制限

## 関連チケット

- T-003: 認証システム実装（依存）
- T-004: 学生の学習記録機能（依存）
- T-009: 目標設定機能（関連）
- T-010: メッセージ・通知システム

## 備考

- 保護者は複数の子供を管理可能
- 子供の同意に基づく情報共有
- 学習記録は読み取り専用（編集不可）
